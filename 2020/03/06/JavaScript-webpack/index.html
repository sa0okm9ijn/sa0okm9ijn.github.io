
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  
    <title>JavaScript-webpack | 110laile</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="110laile">
    

    
    <meta name="description" content="浏览器模块化带来的问题 效率问题：精细的模块划分带来了更多的JS文件，更多的JS文件带来了更多的请求，降低了页面访问效率 兼容性问题：浏览器目前仅支持ES6的模块化标准，并且还存在兼容性问题 工具问题：浏览器不支持npm下载的第三方包  这些仅仅是前端工程化的一个缩影 当开发一个具有规模的程序，你将遇到非常多的非业务问题，这些问题包括：执行效率、兼容性、代码的可维护性可扩展性、团队协作、测试等等等">
<meta name="keywords" content="JavaScript,webpack">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaScript-webpack">
<meta property="og:url" content="http://yoursite.com/2020/03/06/JavaScript-webpack/index.html">
<meta property="og:site_name" content="110laile">
<meta property="og:description" content="浏览器模块化带来的问题 效率问题：精细的模块划分带来了更多的JS文件，更多的JS文件带来了更多的请求，降低了页面访问效率 兼容性问题：浏览器目前仅支持ES6的模块化标准，并且还存在兼容性问题 工具问题：浏览器不支持npm下载的第三方包  这些仅仅是前端工程化的一个缩影 当开发一个具有规模的程序，你将遇到非常多的非业务问题，这些问题包括：执行效率、兼容性、代码的可维护性可扩展性、团队协作、测试等等等">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-07-05-06-11.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-07-07-50-09.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-07-07-53-45.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-07-07-54-25.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-07-07-55-54.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-09-10-26-15.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-09-10-53-28.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-09-11-54-08.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-09-12-32-38.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-09-12-35-05.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-09-12-39-16.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-09-12-43-52.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-09-12-47-43.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-09-12-54-34.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-09-15-51-07.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-09-12-32-38.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-08-16-38-26.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-08-16-58-06.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-08-17-01-13.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-09-15-51-07.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-10-12-00-28.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-10-12-38-03.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-10-12-44-13.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-13-10-39-24.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-13-09-28-52.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-13-09-29-08.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-13-09-35-44.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-13-10-29-54.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-15-12-45-16.png">
<meta property="og:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-15-12-49-26.png">
<meta property="og:updated_time" content="2020-03-13T03:02:34.952Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JavaScript-webpack">
<meta name="twitter:description" content="浏览器模块化带来的问题 效率问题：精细的模块划分带来了更多的JS文件，更多的JS文件带来了更多的请求，降低了页面访问效率 兼容性问题：浏览器目前仅支持ES6的模块化标准，并且还存在兼容性问题 工具问题：浏览器不支持npm下载的第三方包  这些仅仅是前端工程化的一个缩影 当开发一个具有规模的程序，你将遇到非常多的非业务问题，这些问题包括：执行效率、兼容性、代码的可维护性可扩展性、团队协作、测试等等等">
<meta name="twitter:image" content="http://yoursite.com/2020/03/06/JavaScript-webpack/2020-01-07-05-06-11.png">

    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="110laile" title="110laile"></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="110laile">110laile</a></h1>
				<h2 class="blog-motto">个人技术博客</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索">
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</ul></nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2020/03/06/JavaScript-webpack/" title="JavaScript-webpack" itemprop="url">JavaScript-webpack</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="110laile" target="_blank" itemprop="author">110laile</a>
		
  </p><p class="article-time">
    <time datetime="2020-03-06T02:19:44.000Z" itemprop="datePublished"> 发表于 2020-03-06</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#浏览器模块化带来的问题"><span class="toc-number">1.</span> <span class="toc-text">浏览器模块化带来的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#根本原因"><span class="toc-number">1.1.</span> <span class="toc-text">根本原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解决办法"><span class="toc-number">1.2.</span> <span class="toc-text">解决办法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常见的构建工具"><span class="toc-number">2.</span> <span class="toc-text">常见的构建工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#webpack"><span class="toc-number">3.</span> <span class="toc-text">webpack</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装"><span class="toc-number">3.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用"><span class="toc-number">3.2.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模块化兼容性"><span class="toc-number">3.3.</span> <span class="toc-text">模块化兼容性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编译结果分析"><span class="toc-number">3.4.</span> <span class="toc-text">编译结果分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编译过程"><span class="toc-number">3.5.</span> <span class="toc-text">编译过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#初始化"><span class="toc-number">3.5.1.</span> <span class="toc-text">初始化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#编译"><span class="toc-number">3.5.2.</span> <span class="toc-text">编译</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#输出"><span class="toc-number">3.5.3.</span> <span class="toc-text">输出</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#总过程"><span class="toc-number">3.5.4.</span> <span class="toc-text">总过程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置文件"><span class="toc-number">3.6.</span> <span class="toc-text">配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mode配置"><span class="toc-number">3.6.1.</span> <span class="toc-text">mode配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#devtool配置"><span class="toc-number">3.6.2.</span> <span class="toc-text">devtool配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#入口和出口"><span class="toc-number">3.6.3.</span> <span class="toc-text">入口和出口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#loader"><span class="toc-number">3.6.4.</span> <span class="toc-text">loader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#plugin"><span class="toc-number">3.6.5.</span> <span class="toc-text">plugin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#其他细节配置"><span class="toc-number">3.6.6.</span> <span class="toc-text">其他细节配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#常用扩展"><span class="toc-number">3.7.</span> <span class="toc-text">常用扩展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack内置插件"><span class="toc-number">3.8.</span> <span class="toc-text">webpack内置插件</span></a></li></ol></li></ol>
		
		</div>
		
		<h2 id="浏览器模块化带来的问题"><a href="#浏览器模块化带来的问题" class="headerlink" title="浏览器模块化带来的问题"></a>浏览器模块化带来的问题</h2><ul>
<li>效率问题：精细的模块划分带来了更多的JS文件，更多的JS文件带来了更多的请求，降低了页面访问效率</li>
<li>兼容性问题：浏览器目前仅支持ES6的模块化标准，并且还存在兼容性问题</li>
<li>工具问题：浏览器不支持npm下载的第三方包</li>
</ul>
<p>这些仅仅是前端工程化的一个缩影</p>
<p>当开发一个具有规模的程序，你将遇到非常多的非业务问题，这些问题包括：执行效率、兼容性、代码的可维护性可扩展性、团队协作、测试等等等等，我们将这些问题称之为工程问题。工程问题与业务无关，但它深刻的影响到开发进度，如果没有一个好的工具解决这些问题，将使得开发进度变得极其缓慢，同时也让开发者陷入技术的泥潭。</p>
<h3 id="根本原因"><a href="#根本原因" class="headerlink" title="根本原因"></a>根本原因</h3><p>思考：上面提到的问题，为什么在node端没有那么明显，反而到了浏览器端变得如此严重呢？</p>
<p>答：在node端，运行的JS文件在本地，因此可以本地读取文件，它的效率比浏览器远程传输文件高的多</p>
<p><strong>根本原因</strong>：在浏览器端，开发时态（devtime）和运行时态（runtime）的侧重点不一样</p>
<p><strong>开发时态，devtime：</strong></p>
<ol>
<li>模块划分越细越好</li>
<li>支持多种模块化标准</li>
<li>支持npm或其他包管理器下载的模块</li>
<li>能够解决其他工程化的问题</li>
</ol>
<p><strong>运行时态，runtime：</strong></p>
<ol>
<li>文件越少越好</li>
<li>文件体积越小越好</li>
<li>代码内容越乱越好</li>
<li>所有浏览器都要兼容</li>
<li>能够解决其他运行时的问题，主要是执行效率问题</li>
</ol>
<p>这种差异在小项目中表现的并不明显，可是一旦项目形成规模，就越来越明显，如果不解决这些问题，前端项目形成规模只能是空谈</p>
<h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><p>既然开发时态和运行时态面临的局面有巨大的差异，因此，我们需要有一个工具，这个工具能够让开发者专心的在开发时态写代码，然后利用这个工具将开发时态编写的代码转换为运行时态需要的东西。</p>
<p>这样的工具，叫做构建工具</p>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-07-05-06-11.png" alt></p>
<p>这样一来，开发者就可以专注于开发时态的代码结构，而不用担心运行时态遇到的问题了。</p>
<h2 id="常见的构建工具"><a href="#常见的构建工具" class="headerlink" title="常见的构建工具"></a>常见的构建工具</h2><ul>
<li>webpack</li>
<li>grunt</li>
<li>gulp</li>
<li>browserify</li>
<li>fis</li>
<li>其他</li>
</ul>
<h2 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h2><blockquote>
<p>webpack官网：<a href="https://www.webpackjs.com/" target="_blank" rel="noopener">https://www.webpackjs.com/</a></p>
</blockquote>
<p>webpack是基于模块化的打包（构建）工具，它把一切视为模块</p>
<p>它通过一个开发时态的入口模块为起点，分析出所有的依赖关系，然后经过一系列的过程（压缩、合并），最终生成运行时态的文件。</p>
<p>特点:</p>
<ul>
<li><strong>为前端工程化而生</strong>：webpack致力于解决前端工程化，特别是浏览器端工程化中遇到的问题，让开发者集中注意力编写业务代码，而把工程化过程中的问题全部交给webpack来处理</li>
<li><strong>简单易用</strong>：支持零配置，可以不用写任何一行额外的代码就使用webpack</li>
<li><strong>强大的生态</strong>：webpack是非常灵活、可以扩展的，webpack本身的功能并不多，但它提供了一些可以扩展其功能的机制，使得一些第三方库可以融于到webpack中</li>
<li><strong>基于nodejs</strong>：由于webpack在构建的过程中需要读取文件，因此它是运行在node环境中的</li>
<li><strong>基于模块化</strong>：webpack在构建过程中要分析依赖关系，方式是通过模块化导入语句进行分析的，它支持各种模块化标准，包括但不限于CommonJS、ES6 Module</li>
</ul>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>webpack通过npm安装，它提供了两个包：</p>
<ul>
<li>webpack：核心包，包含了webpack构建过程中要用到的所有api</li>
<li>webpack-cli：提供一个简单的cli命令，它调用了webpack核心包的api，来完成构建过程</li>
</ul>
<p>安装方式：</p>
<ul>
<li>全局安装：可以全局使用webpack命令，但是无法为不同项目对应不同的webpack版本</li>
<li><strong>本地安装</strong>：推荐，每个项目都使用自己的webpack版本进行构建</li>
</ul>
<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack</span><br></pre></td></tr></table></figure>
<p>默认情况下，webpack会以<code>./src/index.js</code>作为入口文件分析依赖关系，打包到<code>./dist/main.js</code>文件中</p>
<p>通过–mode选项可以控制webpack的打包结果的运行环境</p>
<h3 id="模块化兼容性"><a href="#模块化兼容性" class="headerlink" title="模块化兼容性"></a>模块化兼容性</h3><p>由于webpack同时支持CommonJS和ES6 module，因此需要理解它们互操作时webpack是如何处理的</p>
<ul>
<li>同模块化标准<br>如果导出和导入使用的是同一种模块化标准，打包后的效果和之前学习的模块化没有任何差异<br><img src="/2020/03/06/JavaScript-webpack/2020-01-07-07-50-09.png" alt></li>
</ul>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-07-07-53-45.png" alt></p>
<ul>
<li>不同模块化标准<br>不同的模块化标准，webpack按照如下的方式处理<br><img src="/2020/03/06/JavaScript-webpack/2020-01-07-07-54-25.png" alt></li>
</ul>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-07-07-55-54.png" alt></p>
<ul>
<li>最佳实践<br>代码编写最忌讳的是精神分裂，选择一个合适的模块化标准，然后贯彻整个开发阶段。</li>
</ul>
<h3 id="编译结果分析"><a href="#编译结果分析" class="headerlink" title="编译结果分析"></a>编译结果分析</h3><p>基本环境和目录已经建好.我们在src下面添加<code>a.js</code>和<code>index.js</code><br><code>a.js</code>内容<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">"module a"</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports=<span class="string">"a"</span>;</span><br></pre></td></tr></table></figure></p>
<p><code>index.js</code>内容<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">'index module'</span>);</span><br><span class="line"><span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">'./a'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br></pre></td></tr></table></figure></p>
<p><code>index.js</code>为我们的入口文件.我们就上面两个js进行构建打包.首先我们自己按照自己的想法合并上述两个文件.</p>
<ol>
<li><p>首先分析依赖项直到<code>index.js</code>依赖<code>a.js</code>,我们先用对象的方式列出所有依赖,导入模块其实就是执行,所以我们把我们的代码放到一个函数中.至于用到的对象和方法,我们先当参数传进来.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">module</span> = &#123;</span><br><span class="line">    <span class="string">"./src/a.js"</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module,exports</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"module a"</span>);</span><br><span class="line">        <span class="built_in">module</span>.exports = <span class="string">"a"</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"./src/index.js"</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module,exports,require</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'index module'</span>);</span><br><span class="line">        <span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">'./a'</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>模块化里是不能污染全局变量的,这里我们声明了module,换个思路,入口文件是直接执行的,我们这里直接用立即执行函数</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">modules</span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">""</span>)</span><br><span class="line">&#125;)(&#123;</span><br><span class="line">    <span class="string">"./src/a.js"</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module,exports</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"module a"</span>);</span><br><span class="line">        <span class="built_in">module</span>.exports = <span class="string">"a"</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"./src/index.js"</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module,exports,require</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'index module'</span>);</span><br><span class="line">        <span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">'./a'</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这样就不污染全局变量了</p>
<ol start="3">
<li>下面我们来实现合并的代码</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">modules</span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params">moduleId</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> func = modules[moduleId];</span><br><span class="line">        <span class="keyword">var</span> <span class="built_in">module</span> = &#123;</span><br><span class="line">            exports: &#123;&#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        func(<span class="built_in">module</span>, <span class="built_in">module</span>.exports, <span class="built_in">require</span>);</span><br><span class="line">        <span class="keyword">var</span> result = <span class="built_in">module</span>.exports;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">"./src/index.js"</span>); <span class="comment">//require函数相当于是运行一个模块，得到模块导出结果</span></span><br><span class="line">&#125;)(&#123;</span><br><span class="line">    <span class="string">"./src/a.js"</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"module a"</span>);</span><br><span class="line">        <span class="built_in">module</span>.exports = <span class="string">"a"</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"./src/index.js"</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module, exports, require</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'index module'</span>);</span><br><span class="line">        <span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">'./src/a.js'</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>引入到html中测试,没问题成功…</p>
<ol start="4">
<li>node中还有个缓存什么的机制,我们再来实现以下</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">modules</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> moduleExports = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">require</span>(<span class="params">moduleId</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (moduleExports[moduleId]) &#123;</span><br><span class="line">            <span class="keyword">return</span> moduleExports[moduleId];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">var</span> func = modules[moduleId];</span><br><span class="line">        <span class="keyword">var</span> <span class="built_in">module</span> = &#123;</span><br><span class="line">            exports: &#123;&#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        func(<span class="built_in">module</span>, <span class="built_in">module</span>.exports, <span class="built_in">require</span>);</span><br><span class="line">        <span class="keyword">var</span> result = <span class="built_in">module</span>.exports;</span><br><span class="line">        moduleExports[moduleId] = result;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">"./src/index.js"</span>); <span class="comment">//require函数相当于是运行一个模块，得到模块导出结果</span></span><br><span class="line">&#125;)(&#123;</span><br><span class="line">    <span class="string">"./src/a.js"</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"module a"</span>);</span><br><span class="line">        <span class="built_in">module</span>.exports = <span class="string">"a"</span>;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"./src/index.js"</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module, exports, require</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'index module'</span>);</span><br><span class="line">        <span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">'./src/a.js'</span>);</span><br><span class="line">        <span class="keyword">var</span> b = <span class="built_in">require</span>(<span class="string">'./src/a.js'</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>引入两次<code>a.js</code>,只执行了一次.</p>
<p>对<code>webpack</code>构建的代码进行整理如下<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">modules</span>) </span>&#123; <span class="comment">// webpackBootstrap</span></span><br><span class="line">  <span class="comment">// The module cache</span></span><br><span class="line">  <span class="keyword">var</span> installedModules = &#123;&#125;;</span><br><span class="line">  <span class="comment">// The require function</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">__webpack_require__</span>(<span class="params">moduleId</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// Check if module is in cache</span></span><br><span class="line">    <span class="keyword">if</span> (installedModules[moduleId]) &#123;</span><br><span class="line">      <span class="keyword">return</span> installedModules[moduleId].exports;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Create a new module (and put it into the cache)</span></span><br><span class="line">    <span class="keyword">var</span> <span class="built_in">module</span> = installedModules[moduleId] = &#123;</span><br><span class="line">      i: moduleId,</span><br><span class="line">      l: <span class="literal">false</span>,</span><br><span class="line">      exports: &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="comment">// Execute the module function</span></span><br><span class="line">    modules[moduleId].call(<span class="built_in">module</span>.exports, <span class="built_in">module</span>, <span class="built_in">module</span>.exports, __webpack_require__);</span><br><span class="line">    <span class="comment">// Flag the module as loaded</span></span><br><span class="line">    <span class="built_in">module</span>.l = <span class="literal">true</span>;</span><br><span class="line">    <span class="comment">// Return the exports of the module</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">module</span>.exports;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// Load entry module and return exports</span></span><br><span class="line">  <span class="keyword">return</span> __webpack_require__(__webpack_require__.s = <span class="string">"./src/index.js"</span>);</span><br><span class="line">&#125;)</span><br><span class="line">(&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/***/</span></span><br><span class="line">  <span class="string">"./src/a.js"</span>:</span><br><span class="line"></span><br><span class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">      <span class="built_in">eval</span>(<span class="string">"console.log(\"module a\");\r\n\r\nmodule.exports=\"a\";\n\n//# sourceURL=webpack:///./src/a.js?"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;),</span><br><span class="line"></span><br><span class="line">  <span class="string">"./src/index.js"</span>: (<span class="function"><span class="keyword">function</span> (<span class="params">module, exports, __webpack_require__</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">eval</span>(<span class="string">"console.log('index module');\r\nvar a = __webpack_require__(/*! ./a */ \"./src/a.js\");\r\nconsole.log(a);\r\n\n\n//# sourceURL=webpack:///./src/index.js?"</span>);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>对比看来思路完全没问题,不过源码的缓存存储方式有些不同,我们这里就不深挖了,我们这里说下源码中的eval,这里主要还是为了在浏览器调试方便.加上这个之后报错我们可以很好的定位问题所在。具体我们可以对比下用eval和不用eval报错的时候的浏览器的错误.我们也改成eval<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"./src/a.js"</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">eval</span>(<span class="string">"console.log(\"module a\");\nmodule.exports = \"a\";"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"./src/index.js"</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module, exports, require</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">eval</span>(<span class="string">" console.log('index module');\nvar a = require('./src/a.js');\nvar b = require('./src/a.js');b.func();\nconsole.log(a);"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>我们给b调用一个不存在的方法,看看报错信息,可是这时候还不能具体直到哪个模块报了错,我们在加<code>//# sourceURL=webpack:///./src/a.js&quot;</code> 就可以具体直到哪报错了<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">"./src/a.js"</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module, exports</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">eval</span>(<span class="string">"console.log(\"module a\");\nmodule.exports = \"a\";//# sourceURL=webpack:///./src/a.js"</span>);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"./src/index.js"</span>: <span class="function"><span class="keyword">function</span> (<span class="params">module, exports, require</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">eval</span>(<span class="string">" console.log('index module');\nvar a = require('./src/a.js');\nvar b = require('./src/a.js');b.func();\nconsole.log(a);//# sourceURL=webpack:///./src/index.js"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>搞定.</p>
<h3 id="编译过程"><a href="#编译过程" class="headerlink" title="编译过程"></a>编译过程</h3><p>webpack 的作用是将源代码编译（构建、打包）成最终代码<br><img src="/2020/03/06/JavaScript-webpack/2020-01-09-10-26-15.png" alt></p>
<p>整个过程大致分为三个步骤</p>
<ol>
<li>初始化</li>
<li>编译</li>
<li>输出</li>
</ol>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-09-10-53-28.png" alt></p>
<h4 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h4><p>此阶段，webpack会将<strong>CLI参数</strong>、<strong>配置文件</strong>、<strong>默认配置</strong>进行融合，形成一个最终的配置对象。</p>
<p>对配置的处理过程是依托一个第三方库<code>yargs</code>完成的</p>
<p>此阶段相对比较简单，主要是为接下来的编译阶段做必要的准备</p>
<p>目前，可以简单的理解为，初始化阶段主要用于产生一个最终的配置</p>
<h4 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h4><ol>
<li><strong>创建chunk</strong></li>
</ol>
<p>chunk是webpack在内部构建过程中的一个概念，译为<code>块</code>，它表示通过某个入口找到的所有依赖的统称。</p>
<p>根据入口模块（默认为<code>./src/index.js</code>）创建一个chunk</p>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-09-11-54-08.png" alt></p>
<p>每个chunk都有至少两个属性：</p>
<ul>
<li>name：默认为main</li>
<li>id：唯一编号，开发环境和name相同，生产环境是一个数字，从0开始</li>
</ul>
<ol start="2">
<li><strong>构建所有依赖模块</strong></li>
</ol>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-09-12-32-38.png" alt></p>
<blockquote>
<p>AST在线测试工具：<a href="https://astexplorer.net/" target="_blank" rel="noopener">https://astexplorer.net/</a></p>
</blockquote>
<p>简图</p>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-09-12-35-05.png" alt></p>
<ol start="3">
<li><strong>产生chunk assets</strong></li>
</ol>
<p>在第二步完成后，chunk中会产生一个模块列表，列表中包含了<strong>模块id</strong>和<strong>模块转换后的代码</strong></p>
<p>接下来，webpack会根据配置为chunk生成一个资源列表，即<code>chunk assets</code>，资源列表可以理解为是生成到最终文件的文件名和文件内容</p>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-09-12-39-16.png" alt></p>
<blockquote>
<p>chunk hash是根据所有chunk assets的内容生成的一个hash字符串<br>hash：一种算法，具体有很多分类，特点是将一个任意长度的字符串转换为一个固定长度的字符串，而且可以保证原始内容不变，产生的hash字符串就不变</p>
</blockquote>
<p>简图</p>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-09-12-43-52.png" alt></p>
<ol>
<li><strong>合并chunk assets</strong></li>
</ol>
<p>将多个chunk的assets合并到一起，并产生一个总的hash</p>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-09-12-47-43.png" alt></p>
<h4 id="输出"><a href="#输出" class="headerlink" title="输出"></a>输出</h4><p>此步骤非常简单，webpack将利用node中的fs模块（文件处理模块），根据编译产生的总的assets，生成相应的文件。</p>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-09-12-54-34.png" alt></p>
<h4 id="总过程"><a href="#总过程" class="headerlink" title="总过程"></a>总过程</h4><p><img src="/2020/03/06/JavaScript-webpack/2020-01-09-15-51-07.png" alt></p>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-09-12-32-38.png" alt></p>
<p><strong>涉及术语</strong></p>
<ol>
<li>module：模块，分割的代码单元，webpack中的模块可以是任何内容的文件，不仅限于JS</li>
<li>chunk：webpack内部构建模块的块，一个chunk中包含多个模块，这些模块是从入口模块通过依赖分析得来的</li>
<li>bundle：chunk构建好模块后会生成chunk的资源清单，清单中的每一项就是一个bundle，可以认为bundle就是最终生成的文件</li>
<li>hash：最终的资源清单所有内容联合生成的hash值</li>
<li>chunkhash：chunk生成的资源清单内容联合生成的hash值</li>
<li>chunkname：chunk的名称，如果没有配置则使用main</li>
<li>id：通常指chunk的唯一编号，如果在开发环境下构建，和chunkname相同；如果是生产环境下构建，则使用一个从0开始的数字进行编号</li>
</ol>
<h3 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h3><p>webpack提供的cli支持很多的参数，例如<code>--mode</code>，但更多的时候，我们会使用更加灵活的配置文件来控制webpack的行为</p>
<p>默认情况下，webpack会读取<code>webpack.config.js</code>文件作为配置文件，但也可以通过CLI参数<code>--config</code>来指定某个配置文件</p>
<p>配置文件中通过CommonJS模块导出一个对象，对象中的各种属性对应不同的webpack配置</p>
<p><strong>注意：配置文件中的代码，必须是有效的node代码</strong></p>
<p>当命令行参数与配置文件中的配置出现冲突时，以命令行参数为准。</p>
<p>有些时候，我们需要针对生产环境和开发环境分别书写webpack配置</p>
<p>为了更好的适应这种要求，webpack允许配置不仅可以是一个对象，还可以是一个<strong>函数</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="params">env</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="comment">//配置内容</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在开始构建时，webpack如果发现配置是一个函数，会调用该函数，将函数返回的对象作为配置内容，因此，开发者可以根据不同的环境返回不同的对象</p>
<p>在调用webpack函数时，webpack会向函数传入一个参数env，该参数的值来自于webpack命令中给env指定的值，例如</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">npx webpack --env abc # env: "abc"</span><br><span class="line"></span><br><span class="line">npx webpack --env.abc # env: &#123;abc:true&#125;</span><br><span class="line">npx webpack --env.abc=1  # env： &#123;abc:1&#125;</span><br><span class="line">npx webpack --env.abc=1 --env.bcd=2 # env: &#123;abc:1, bcd:2&#125;</span><br></pre></td></tr></table></figure>
<p>这样一来，我们就可以在命令中指定环境，在代码中进行判断，根据环境返回不同的配置结果。</p>
<h4 id="mode配置"><a href="#mode配置" class="headerlink" title="mode配置"></a>mode配置</h4><p>编译模式，字符串，取值为development或production，指定编译结果代码运行的环境，会影响webpack对编译结果代码格式的处理<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">"development"</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="devtool配置"><a href="#devtool配置" class="headerlink" title="devtool配置"></a>devtool配置</h4><p>前端发展到现阶段，很多时候都不会直接运行源代码，可能需要对源代码进行合并、压缩、转换等操作，真正运行的是转换后的代码<br><img src="/2020/03/06/JavaScript-webpack/2020-01-08-16-38-26.png" alt><br>这就给调试带来了困难，因为当运行发生错误的时候，我们更加希望能看到源代码中的错误，而不是转换后代码的错误</p>
<blockquote>
<p>jquery压缩后的代码：<a href="https://code.jquery.com/jquery-3.4.1.min.js" target="_blank" rel="noopener">https://code.jquery.com/jquery-3.4.1.min.js</a></p>
</blockquote>
<p>为了解决这一问题，chrome浏览器率先支持了source map，其他浏览器纷纷效仿，目前，几乎所有新版浏览器都支持了source map</p>
<p>source map实际上是一个配置，配置中不仅记录了所有源码内容，还记录了和转换后的代码的对应关系</p>
<p>下面是浏览器处理source map的原理</p>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-08-16-58-06.png" alt></p>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-08-17-01-13.png" alt></p>
<ol>
<li>source map 应在开发环境中使用，作为一种调试手段</li>
<li>source map 不应该在生产环境中使用，source map的文件一般较大，不仅会导致额外的网络传输，还容易暴露原始代码。即便要在生产环境中使用source map，用于调试真实的代码运行问题，也要做出一些处理规避网络传输和代码暴露的问题。</li>
</ol>
<p><strong>webpack中的source map</strong><br>使用 webpack 编译后的代码难以调试，可以通过 devtool 配置来<strong>优化调试体验</strong><br>具体的配置见文档：<a href="https://www.webpackjs.com/configuration/devtool/" target="_blank" rel="noopener">https://www.webpackjs.com/configuration/devtool/</a></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">"development"</span>,</span><br><span class="line">    devtool: <span class="string">"source-map"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="入口和出口"><a href="#入口和出口" class="headerlink" title="入口和出口"></a>入口和出口</h4><p><img src="/2020/03/06/JavaScript-webpack/2020-01-09-15-51-07.png" alt></p>
<blockquote>
<p>node内置模块 - path: <a href="https://nodejs.org/dist/latest-v12.x/docs/api/path.html" target="_blank" rel="noopener">https://nodejs.org/dist/latest-v12.x/docs/api/path.html</a></p>
</blockquote>
<p><strong>路径问题补充</strong></p>
<ol>
<li>模块化代码中，比如require(“./“)，表示当前js文件所在的目录</li>
<li>在路径处理中，”./“表示node运行目录</li>
<li>__dirname: 所有情况下，都表示当前运行的js文件所在的目录，它是一个绝对路径</li>
<li>node内中模块<code>path</code>该对象提供了大量路径处理的函数,其中resolve主要是用来组合路径的.</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//c:\WorkSpace\VsCode\webpack\4.配置文件\出口和入口\路径问题\index.js</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="keyword">var</span> result = path.resolve(<span class="string">"./"</span>, <span class="string">"child"</span>, <span class="string">"123"</span>);</span><br><span class="line"><span class="keyword">var</span> result1 = path.resolve(__dirname, <span class="string">"src"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(__dirname);<span class="comment">//c:\WorkSpace\VsCode\webpack\4.配置文件\出口和入口\路径问题</span></span><br><span class="line"><span class="built_in">console</span>.log(result);<span class="comment">//取决于在哪里运行js,然后拼接child和123</span></span><br><span class="line"><span class="built_in">console</span>.log(result1);<span class="comment">//c:\WorkSpace\VsCode\webpack\4.配置文件\出口和入口\路径问题\src</span></span><br></pre></td></tr></table></figure>
<p><strong>出口</strong><br>这里的出口是针对资源列表的文件名或路径的配置<br>出口通过output进行配置</p>
<p><strong>入口</strong><br><strong>入口真正配置的是chunk</strong><br>入口通过entry进行配置</p>
<p>规则：</p>
<ul>
<li>name：chunkname</li>
<li>hash: 总的资源hash，通常用于解决缓存问题</li>
<li>chunkhash: 使用chunkhash</li>
<li>id: 使用chunkid，不推荐</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">"development"</span>,</span><br><span class="line">    entry: &#123;</span><br><span class="line">        main: <span class="string">"./src/index.js"</span>, <span class="comment">//属性名：chunk的名称， 属性值：入口模块（启动模块）&lt;==&gt; entry:"./src/index.js"</span></span><br><span class="line">        a: [<span class="string">"./src/a.js"</span>, <span class="string">"./src/index.js"</span>] <span class="comment">//启动模块有两个</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//配置为固定名称</span></span><br><span class="line">    <span class="comment">// output: &#123;</span></span><br><span class="line">    <span class="comment">//     path: path.resolve(__dirname, "target"), //必须配置一个绝对路径，表示资源放置的文件夹，默认是dist</span></span><br><span class="line">    <span class="comment">//     filename: "bundle.js", //配置的合并的js文件的规则</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//name参数</span></span><br><span class="line">    <span class="comment">// output: &#123;</span></span><br><span class="line">    <span class="comment">//     path: path.resolve(__dirname, "target"), //必须配置一个绝对路径，表示资源放置的文件夹，默认是dist</span></span><br><span class="line">    <span class="comment">//     filename: "[name]bundle.js", //配置的合并的js文件的规则</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//hash参数</span></span><br><span class="line">    <span class="comment">// output: &#123;</span></span><br><span class="line">    <span class="comment">//     path: path.resolve(__dirname, "target"), //必须配置一个绝对路径，表示资源放置的文件夹，默认是dist</span></span><br><span class="line">    <span class="comment">//     filename: "[hash:5]bundle.js", //配置的合并的js文件的规则</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//chunkhash参数</span></span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">"target"</span>), <span class="comment">//必须配置一个绝对路径，表示资源放置的文件夹，默认是dist</span></span><br><span class="line">        filename: <span class="string">"[chunkhash:5][name].js"</span>, <span class="comment">//配置的合并的js文件的规则</span></span><br><span class="line">    &#125;,</span><br><span class="line">    devtool: <span class="string">"source-map"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最佳实践:</p>
<p>具体情况具体分析</p>
<p>下面是一些经典场景</p>
<ol>
<li>一个页面一个JS<br><img src="/2020/03/06/JavaScript-webpack/2020-01-10-12-00-28.png" alt></li>
</ol>
<p>源码结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">|—— src</span><br><span class="line">    |—— pageA   页面A的代码目录</span><br><span class="line">        |—— index.js 页面A的启动模块</span><br><span class="line">        |—— ...</span><br><span class="line">    |—— pageB   页面B的代码目录</span><br><span class="line">        |—— index.js 页面B的启动模块</span><br><span class="line">        |—— ...</span><br><span class="line">    |—— pageC   页面C的代码目录</span><br><span class="line">        |—— main1.js 页面C的启动模块1 例如：主功能</span><br><span class="line">        |—— main2.js 页面C的启动模块2 例如：实现访问统计的额外功能</span><br><span class="line">        |—— ...</span><br><span class="line">    |—— common  公共代码目录</span><br><span class="line">        |—— ...</span><br></pre></td></tr></table></figure>
<p>webpack配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry:&#123;</span><br><span class="line">        pageA: <span class="string">"./src/pageA/index.js"</span>,</span><br><span class="line">        pageB: <span class="string">"./src/pageB/index.js"</span>,</span><br><span class="line">        pageC: [<span class="string">"./src/pageC/main1.js"</span>, <span class="string">"./src/pageC/main2.js"</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    output:&#123;</span><br><span class="line">        filename:<span class="string">"[name].[chunkhash:5].js"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种方式适用于页面之间的功能差异巨大、公共代码较少的情况，这种情况下打包出来的最终代码不会有太多重复</p>
<ol start="2">
<li>一个页面多个JS<br><img src="/2020/03/06/JavaScript-webpack/2020-01-10-12-38-03.png" alt></li>
</ol>
<p>源码结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">|—— src</span><br><span class="line">    |—— pageA   页面A的代码目录</span><br><span class="line">        |—— index.js 页面A的启动模块</span><br><span class="line">        |—— ...</span><br><span class="line">    |—— pageB   页面B的代码目录</span><br><span class="line">        |—— index.js 页面B的启动模块</span><br><span class="line">        |—— ...</span><br><span class="line">    |—— statistics   用于统计访问人数功能目录</span><br><span class="line">        |—— index.js 启动模块</span><br><span class="line">        |—— ...</span><br><span class="line">    |—— common  公共代码目录</span><br><span class="line">        |—— ...</span><br></pre></td></tr></table></figure>
<p>webpack配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry:&#123;</span><br><span class="line">        pageA: <span class="string">"./src/pageA/index.js"</span>,</span><br><span class="line">        pageB: <span class="string">"./src/pageB/index.js"</span>,</span><br><span class="line">        statistics: <span class="string">"./src/statistics/index.js"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output:&#123;</span><br><span class="line">        filename:<span class="string">"[name].[chunkhash:5].js"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这种方式适用于页面之间有一些<strong>独立</strong>、相同的功能，专门使用一个chunk抽离这部分JS有利于浏览器更好的缓存这部分内容。</p>
<blockquote>
<p>思考：为什么不使用多启动模块的方式？</p>
</blockquote>
<ol start="3">
<li>单页应用<br>所谓单页应用，是指整个网站（或网站的某一个功能块）只有一个页面，页面中的内容全部靠JS创建和控制。 vue和react都是实现单页应用的利器。</li>
</ol>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-10-12-44-13.png" alt></p>
<p>源码结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">|—— src</span><br><span class="line">    |—— subFunc   子功能目录</span><br><span class="line">        |—— ...</span><br><span class="line">    |—— subFunc   子功能目录</span><br><span class="line">        |—— ...</span><br><span class="line">    |—— common  公共代码目录</span><br><span class="line">        |—— ...</span><br><span class="line">    |—— index.js</span><br></pre></td></tr></table></figure>
<p>webpack配置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">"./src/index.js"</span>,</span><br><span class="line">    output:&#123;</span><br><span class="line">        filename:<span class="string">"index.[hash:5].js"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="loader"><a href="#loader" class="headerlink" title="loader"></a>loader</h4><blockquote>
<p>webpack做的事情，仅仅是分析出各种模块的依赖关系，然后形成资源列表，最终打包生成到指定的文件中。<br>更多的功能需要借助webpack loaders和webpack plugins完成。</p>
</blockquote>
<p>webpack loader： loader本质上是一个函数，它的作用是将某个源码字符串转换成另一个源码字符串返回。</p>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-13-10-39-24.png" alt></p>
<p>loader函数的将在模块解析的过程中被调用，以得到最终的源码。</p>
<p><strong>全流程：</strong></p>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-13-09-28-52.png" alt></p>
<p><strong>chunk中解析模块的流程：</strong></p>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-13-09-29-08.png" alt></p>
<p><strong>chunk中解析模块的更详细流程：</strong></p>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-13-09-35-44.png" alt></p>
<p><strong>处理loaders流程：</strong></p>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-13-10-29-54.png" alt></p>
<p><strong>loader配置：</strong></p>
<p><strong>完整配置</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123; <span class="comment">//针对模块的配置，目前版本只有两个配置，rules、noParse(是否不要解析某个模块)</span></span><br><span class="line">        rules: [ <span class="comment">//模块匹配规则，可以存在多个规则</span></span><br><span class="line">            &#123; <span class="comment">//每个规则是一个对象</span></span><br><span class="line">                test: <span class="regexp">/\.js$/</span>, <span class="comment">//匹配的模块正则</span></span><br><span class="line">                use: [ <span class="comment">//匹配到后应用的规则模块</span></span><br><span class="line">                    &#123;  <span class="comment">//其中一个规则</span></span><br><span class="line">                        loader: <span class="string">"模块路径"</span>, <span class="comment">//loader模块的路径，该字符串会被放置到require中</span></span><br><span class="line">                        options: &#123; <span class="comment">//向对应loader传递的额外参数</span></span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>简化配置</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="built_in">module</span>: &#123; <span class="comment">//针对模块的配置，目前版本只有两个配置，rules、noParse</span></span><br><span class="line">        rules: [ <span class="comment">//模块匹配规则，可以存在多个规则</span></span><br><span class="line">            &#123; <span class="comment">//每个规则是一个对象</span></span><br><span class="line">                test: <span class="regexp">/\.js$/</span>, <span class="comment">//匹配的模块正则</span></span><br><span class="line">                use: [<span class="string">"模块路径1"</span>, <span class="string">"模块路径2"</span>]<span class="comment">//loader模块的路径，该字符串会被放置到require中,执行顺序会从后往前</span></span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>自己写的loader只能用Commonjs模块化规范</strong></p>
<h4 id="plugin"><a href="#plugin" class="headerlink" title="plugin"></a>plugin</h4><p>loader的功能定位是转换代码，而一些其他的操作难以使用loader完成，比如：</p>
<ul>
<li>当webpack生成文件时，顺便多生成一个说明描述文件</li>
<li>当webpack编译启动时，控制台输出一句话表示webpack启动了</li>
<li>当xxxx时，xxxx</li>
</ul>
<p>这种类似的功能需要把功能嵌入到webpack的编译流程中，而这种事情的实现是依托于plugin的</p>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-15-12-45-16.png" alt></p>
<p>plugin的<strong>本质</strong>是一个带有apply方法的对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> plugin = &#123;</span><br><span class="line">    apply: <span class="function"><span class="keyword">function</span>(<span class="params">compiler</span>)</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通常，习惯上，我们会将该对象写成构造函数的模式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPlugin</span></span>&#123;</span><br><span class="line">    apply(compiler)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> plugin = <span class="keyword">new</span> MyPlugin();</span><br></pre></td></tr></table></figure>
<p>要将插件应用到webpack，需要把插件对象配置到webpack的plugins数组中，如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    plugins:[</span><br><span class="line">        <span class="keyword">new</span> MyPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>apply函数会在初始化阶段，创建好Compiler对象后运行。</p>
<p>compiler对象是在初始化阶段构建的，整个webpack打包期间只有一个compiler对象，后续完成打包工作的是compiler对象内部创建的compilation</p>
<p>apply方法会在<strong>创建好compiler对象后调用</strong>，并向方法传入一个compiler对象</p>
<p><img src="/2020/03/06/JavaScript-webpack/2020-01-15-12-49-26.png" alt></p>
<p>compiler对象提供了大量的钩子函数（hooks，可以理解为事件），plugin的开发者可以注册这些钩子函数，参与webpack编译和生成。</p>
<p>你可以在apply方法中使用下面的代码注册钩子函数:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyPlugin</span></span>&#123;</span><br><span class="line">    apply(compiler)&#123;</span><br><span class="line">        <span class="comment">//在这里注册事件,类似与window.onload $(function()&#123;&#125;)</span></span><br><span class="line">        compiler.hooks.事件名称.事件类型(name, <span class="function"><span class="keyword">function</span>(<span class="params">compilation</span>)</span>&#123;</span><br><span class="line">            <span class="comment">//事件处理函数</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>事件名称</strong></p>
<p>即要监听的事件名，即钩子名，所有的钩子：<a href="https://www.webpackjs.com/api/compiler-hooks" target="_blank" rel="noopener">https://www.webpackjs.com/api/compiler-hooks</a></p>
<p><strong>事件类型</strong></p>
<p>这一部分使用的是 Tapable API，这个小型的库是一个专门用于钩子函数监听的库。</p>
<p>它提供了一些事件类型：</p>
<ul>
<li>tap：注册一个同步的钩子函数，函数运行完毕则表示事件处理结束</li>
<li>tapAsync：注册一个基于回调的异步的钩子函数，函数通过调用一个回调表示事件处理结束</li>
<li>tapPromise：注册一个基于Promise的异步的钩子函数，函数通过返回的Promise进入已决状态表示事件处理结束</li>
</ul>
<p><strong>处理函数</strong></p>
<p>处理函数有一个事件参数<code>compilation</code></p>
<h4 id="其他细节配置"><a href="#其他细节配置" class="headerlink" title="其他细节配置"></a>其他细节配置</h4><ul>
<li>context<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">context: path.resolve(__dirname, <span class="string">"app"</span>)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>该配置会影响入口和loaders的解析，入口和loaders的相对路径会以context的配置作为基准路径，这样，你的配置会独立于CWD（current working directory 当前执行路径）</p>
<ul>
<li><p>output</p>
<ul>
<li>library<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">library: <span class="string">"abc"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>这样一来，打包后的结果中，会将自执行函数的执行结果暴露给abc </p>
<ul>
<li>libraryTarget<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libraryTarget: <span class="string">"var"</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>该配置可以更加精细的控制如何暴露入口包的导出结果<br>其他可用的值有：</p>
<ol>
<li>var：默认值，暴露给一个普通变量</li>
<li>window：暴露给window对象的一个属性</li>
<li>this：暴露给this的一个属性</li>
<li>this：暴露给this的一个属性</li>
<li>global：暴露给global的一个属性</li>
<li>commonjs：暴露给exports的一个属性</li>
<li>其他：<a href="https://www.webpackjs.com/configuration/output/#output-librarytarget" target="_blank" rel="noopener">https://www.webpackjs.com/configuration/output/#output-librarytarget</a></li>
</ol>
</li>
<li>target<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">target:<span class="string">"web"</span> <span class="comment">//默认值</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>设置打包结果最终要运行的环境，常用值有</p>
<ol>
<li>web: 打包后的代码运行在web环境中</li>
<li>node：打包后的代码运行在node环境中</li>
<li>其他：<a href="https://www.webpackjs.com/configuration/target/" target="_blank" rel="noopener">https://www.webpackjs.com/configuration/target/</a></li>
</ol>
<ul>
<li>module.noParse<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">noParse: <span class="regexp">/jquery/</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>不解析正则表达式匹配的模块，通常用它来忽略那些大型的单模块库，以提高<strong>构建性能</strong></p>
<ul>
<li><p>resolve<br>resolve的相关配置主要用于控制模块解析过程</p>
<ul>
<li>modules<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modules: [<span class="string">"node_modules"</span>]  <span class="comment">//默认值</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>当解析模块时，如果遇到导入语句，<code>require(&quot;test&quot;)</code>，webpack会从下面的位置寻找依赖的模块</p>
<ol>
<li>当前目录下的<code>node_modules</code>目录</li>
<li>上级目录下的<code>node_modules</code>目录</li>
<li>…</li>
</ol>
<ul>
<li>extensions<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">extensions: [<span class="string">".js"</span>, <span class="string">".json"</span>]  <span class="comment">//默认值</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>当解析模块时，遇到无具体后缀的导入语句，例如<code>require(&quot;test&quot;)</code>，会依次测试它的后缀名</p>
<ul>
<li>alias<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">alias: &#123;</span><br><span class="line">  <span class="string">"@"</span>: path.resolve(__dirname, <span class="string">'src'</span>),</span><br><span class="line">  <span class="string">"_"</span>: __dirname</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>有了alias（别名）后，导入语句中可以加入配置的键名，例如<code>require(&quot;@/abc.js&quot;)</code>，webpack会将其看作是<code>require(src的绝对路径+&quot;/abc.js&quot;)</code>。<br>在大型系统中，源码结构往往比较深和复杂，别名配置可以让我们更加方便的导入依赖</p>
</li>
<li>externals</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">externals: &#123;</span><br><span class="line">    jquery: <span class="string">"$"</span>,</span><br><span class="line">    lodash: <span class="string">"_"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从最终的bundle中排除掉配置的配置的源码，例如，入口模块是</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//index.js</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">"jquery"</span>)</span><br><span class="line"><span class="built_in">require</span>(<span class="string">"lodash"</span>)</span><br></pre></td></tr></table></figure>
<p>生成的bundle是：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;)(&#123;</span><br><span class="line">    <span class="string">"./src/index.js"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">module, exports, __webpack_require__</span>)</span>&#123;</span><br><span class="line">        __webpack_require__(<span class="string">"jquery"</span>)</span><br><span class="line">        __webpack_require__(<span class="string">"lodash"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"jquery"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">module, exports</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//jquery的大量源码</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"lodash"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">module, exports</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//lodash的大量源码</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>但有了上面的配置后，则变成了</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;)(&#123;</span><br><span class="line">    <span class="string">"./src/index.js"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">module, exports, __webpack_require__</span>)</span>&#123;</span><br><span class="line">        __webpack_require__(<span class="string">"jquery"</span>)</span><br><span class="line">        __webpack_require__(<span class="string">"lodash"</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"jquery"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">module, exports</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">module</span>.exports = $;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">"lodash"</span>: <span class="function"><span class="keyword">function</span>(<span class="params">module, exports</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">module</span>.exports = _;</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这比较适用于一些第三方库来自于外部CDN的情况，这样一来，即可以在页面中使用CDN，又让bundle的体积变得更小，还不影响源码的编写</p>
<ul>
<li>stats</li>
</ul>
<p>stats控制的是构建过程中控制台的输出内容</p>
<h3 id="常用扩展"><a href="#常用扩展" class="headerlink" title="常用扩展"></a>常用扩展</h3><ol>
<li>清除输出目录</li>
</ol>
<p><code>clean-webpack-plugin</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> &#123;CleanWebpackPlugin&#125; = <span class="built_in">require</span>(<span class="string">"clean-webpack-plugin"</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'development'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">'[name].[chunkhash:5].js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin()</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>自动生成页面<br><code>html-webpack-plugin</code></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'development'</span>,</span><br><span class="line">    devtool: <span class="string">'source-map'</span>,</span><br><span class="line">    entry: &#123;</span><br><span class="line">        home: <span class="string">'./src/index.js'</span>,</span><br><span class="line">        a: <span class="string">'./src/a.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">'scripts/[name].[chunkhash:5].js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">'./public/index.html'</span>,</span><br><span class="line">            filename: <span class="string">'home.html'</span>,</span><br><span class="line">            chunks: [<span class="string">"home"</span>]</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">'./public/index.html'</span>,</span><br><span class="line">            filename: <span class="string">'a.html'</span>,</span><br><span class="line">            chunks: [<span class="string">"a"</span>]</span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>复制静态资源<br><code>copy-webpack-plugin</code></li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;</span><br><span class="line">    CleanWebpackPlugin</span><br><span class="line">&#125; = <span class="built_in">require</span>(<span class="string">'clean-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>);</span><br><span class="line"><span class="keyword">const</span> CopyPlugin = <span class="built_in">require</span>(<span class="string">'copy-webpack-plugin'</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'development'</span>,</span><br><span class="line">    devtool: <span class="string">'source-map'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">'scripts/[name].[chunkhash:5].js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> CleanWebpackPlugin(),</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: <span class="string">"./public/index.html"</span></span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// new CopyPlugin([&#123;</span></span><br><span class="line">        <span class="comment">//     from: "./public",</span></span><br><span class="line">        <span class="comment">//     to: "./"</span></span><br><span class="line">        <span class="comment">// &#125;,]) //必须加,不然会报错</span></span><br><span class="line">        <span class="keyword">new</span> CopyPlugin([&#123;</span><br><span class="line">            <span class="keyword">from</span>: <span class="string">"./public"</span>,</span><br><span class="line">            to: <span class="string">"./"</span></span><br><span class="line">        &#125;])</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>开发服务器</li>
</ol>
<p>在<strong>开发阶段</strong>，目前遇到的问题是打包、运行、调试过程过于繁琐，回顾一下我们的操作流程：</p>
<ol>
<li>编写代码</li>
<li>控制台运行命令完成打包</li>
<li>打开页面查看效果</li>
<li>继续编写代码，回到步骤2</li>
</ol>
<p>并且，我们往往希望把最终生成的代码和页面部署到服务器上，来模拟真实环境</p>
<p>为了解决这些问题，webpack官方制作了一个单独的库：<strong>webpack-dev-server</strong></p>
<p>它<strong>既不是plugin也不是loader</strong></p>
<p>先来看看它怎么用</p>
<ol>
<li>安装</li>
<li>执行<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```webpack-dev-server```命令几乎支持所有的webpack命令参数，如```--config```、```-env```等等，你可以把它当作webpack命令使用</span><br><span class="line"></span><br><span class="line">这个命令是专门为开发阶段服务的，真正部署的时候还是得使用webpack命令</span><br><span class="line"></span><br><span class="line">当我们执行```webpack-dev-server```命令后，它做了以下操作：</span><br><span class="line">   1. 内部执行webpack命令，传递命令参数</span><br><span class="line">   2. 开启watch</span><br><span class="line">   3. 注册hooks：类似于plugin，webpack-dev-server会向webpack中注册一些钩子函数，主要功能如下：</span><br><span class="line">      1. 将资源列表（aseets）保存起来</span><br><span class="line">      2. 禁止webpack输出文件</span><br><span class="line">   4. 用express开启一个服务器，监听某个端口，当请求到达后，根据请求的路径，给予相应的资源内容</span><br><span class="line">**配置**</span><br><span class="line"></span><br><span class="line">针对webpack-dev-server的配置，参考：https://www.webpackjs.com/configuration/dev-server/</span><br><span class="line"></span><br><span class="line">常见配置有：</span><br><span class="line"></span><br><span class="line">- port：配置监听端口</span><br><span class="line">- proxy：配置代理，常用于跨域访问</span><br><span class="line">- stats：配置控制台输出内容</span><br><span class="line"></span><br><span class="line">5. 普通文件处理</span><br><span class="line"></span><br><span class="line">file-loader: 生成依赖的文件到输出目录，然后将模块文件设置为：导出一个路径\</span><br><span class="line"></span><br><span class="line">```js</span><br><span class="line">function loader(source)&#123;</span><br><span class="line">	// source：文件内容（图片内容 buffer）</span><br><span class="line">	// 1. 生成一个具有相同文件内容的文件到输出目录</span><br><span class="line">	// 2. 返回一段代码   export default &quot;文件名&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p>url-loader：将依赖的文件转换为：导出一个base64格式的字符串,设置了limit属性,符合条件转base64,不符合条件则交给file-loader,包括参数也会提交过去.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">loader</span>(<span class="params">source</span>)</span>&#123;</span><br><span class="line">	<span class="comment">// source：文件内容（图片内容 buffer）</span></span><br><span class="line">	<span class="comment">// 1. 根据buffer生成一个base64编码</span></span><br><span class="line">	<span class="comment">// 2. 返回一段代码   export default "base64编码"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>解决路径问题</li>
</ol>
<p>在使用file-loader或url-loader时，可能会遇到一个非常有趣的问题</p>
<p>比如，通过webpack打包的目录结构如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">dist</span></span><br><span class="line">    <span class="string">|——</span> <span class="string">img</span></span><br><span class="line">        <span class="string">|——</span> <span class="string">a.png</span>  <span class="comment">#file-loader生成的文件</span></span><br><span class="line">    <span class="string">|——</span> <span class="string">scripts</span></span><br><span class="line">        <span class="string">|——</span> <span class="string">main.js</span>  <span class="comment">#export default "img/a.png"</span></span><br><span class="line">    <span class="string">|——</span> <span class="string">html</span></span><br><span class="line">        <span class="string">|——</span> <span class="string">index.html</span> <span class="comment">#&lt;script src="../scripts/main.js" &gt;&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<p>这种问题发生的根本原因：模块中的路径来自于某个loader或plugin，当产生路径时，loader或plugin只有相对于dist目录的路径，并不知道该路径将在哪个资源中使用，从而无法确定最终正确的路径</p>
<p>面对这种情况，需要依靠webpack的配置publicPath解决</p>
<h3 id="webpack内置插件"><a href="#webpack内置插件" class="headerlink" title="webpack内置插件"></a>webpack内置插件</h3><p>所有的webpack内置插件都作为webpack的静态属性存在的，使用下面的方式即可创建一个插件对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">"webpack"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> webpack.插件名(options)</span><br></pre></td></tr></table></figure>
<ol>
<li>DefinePlugin</li>
</ol>
<p>全局常量定义插件，使用该插件通常定义一些常量值，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.DefinePlugin(&#123;</span><br><span class="line">    PI: <span class="string">`Math.PI`</span>, <span class="comment">// PI = Math.PI</span></span><br><span class="line">    VERSION: <span class="string">`"1.0.0"`</span>, <span class="comment">// VERSION = "1.0.0"</span></span><br><span class="line">    DOMAIN: <span class="built_in">JSON</span>.stringify(<span class="string">"duyi.com"</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>这样一来，在源码中，我们可以直接使用插件中提供的常量，当webpack编译完成后，会自动替换为常量的值</p>
<ol start="2">
<li>BannerPlugin</li>
</ol>
<p>它可以为每个chunk生成的文件头部添加一行注释，一般用于添加作者、公司、版权等信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.BannerPlugin(&#123;</span><br><span class="line">  banner: <span class="string">`</span></span><br><span class="line"><span class="string">  hash:[hash]</span></span><br><span class="line"><span class="string">  chunkhash:[chunkhash]</span></span><br><span class="line"><span class="string">  name:[name]</span></span><br><span class="line"><span class="string">  author:yuanjin</span></span><br><span class="line"><span class="string">  corporation:duyi</span></span><br><span class="line"><span class="string">  `</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>ProvidePlugin</li>
</ol>
<p>自动加载模块，而不必到处 import 或 require </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">  $: <span class="string">'jquery'</span>,</span><br><span class="line">  _: <span class="string">'lodash'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>然后在我们任意源码中：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="string">'#item'</span>); <span class="comment">// &lt;= 起作用</span></span><br><span class="line">_.drop([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="number">2</span>); <span class="comment">// &lt;= 起作用</span></span><br></pre></td></tr></table></figure>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/JavaScript/">JavaScript</a><a href="/tags/webpack/">webpack</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2020/03/06/JavaScript-webpack/" data-title="JavaScript-webpack | 110laile" data-tsina class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/2020/03/03/JavaScript-包管理/" title="JavaScript-包管理">
 <strong>下一篇：</strong><br> 
 <span>JavaScript-包管理
</span>
</a>
</div>

</nav>

	



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#浏览器模块化带来的问题"><span class="toc-number">1.</span> <span class="toc-text">浏览器模块化带来的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#根本原因"><span class="toc-number">1.1.</span> <span class="toc-text">根本原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解决办法"><span class="toc-number">1.2.</span> <span class="toc-text">解决办法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#常见的构建工具"><span class="toc-number">2.</span> <span class="toc-text">常见的构建工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#webpack"><span class="toc-number">3.</span> <span class="toc-text">webpack</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装"><span class="toc-number">3.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用"><span class="toc-number">3.2.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#模块化兼容性"><span class="toc-number">3.3.</span> <span class="toc-text">模块化兼容性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编译结果分析"><span class="toc-number">3.4.</span> <span class="toc-text">编译结果分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#编译过程"><span class="toc-number">3.5.</span> <span class="toc-text">编译过程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#初始化"><span class="toc-number">3.5.1.</span> <span class="toc-text">初始化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#编译"><span class="toc-number">3.5.2.</span> <span class="toc-text">编译</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#输出"><span class="toc-number">3.5.3.</span> <span class="toc-text">输出</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#总过程"><span class="toc-number">3.5.4.</span> <span class="toc-text">总过程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#配置文件"><span class="toc-number">3.6.</span> <span class="toc-text">配置文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#mode配置"><span class="toc-number">3.6.1.</span> <span class="toc-text">mode配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#devtool配置"><span class="toc-number">3.6.2.</span> <span class="toc-text">devtool配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#入口和出口"><span class="toc-number">3.6.3.</span> <span class="toc-text">入口和出口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#loader"><span class="toc-number">3.6.4.</span> <span class="toc-text">loader</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#plugin"><span class="toc-number">3.6.5.</span> <span class="toc-text">plugin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#其他细节配置"><span class="toc-number">3.6.6.</span> <span class="toc-text">其他细节配置</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#常用扩展"><span class="toc-number">3.7.</span> <span class="toc-text">常用扩展</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#webpack内置插件"><span class="toc-number">3.8.</span> <span class="toc-text">webpack内置插件</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/NET/" title=".NET">.NET<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/Cmd/" title="Cmd">Cmd<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Css/" title="Css">Css<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Docker/" title="Docker">Docker<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Emmet/" title="Emmet">Emmet<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Git/" title="Git">Git<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/HTML/" title="HTML">HTML<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/JQuery/" title="JQuery">JQuery<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/JavaScript/" title="JavaScript">JavaScript<sup>41</sup></a></li>
		  
		
		  
			<li><a href="/categories/Linux/" title="Linux">Linux<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/MongoDB/" title="MongoDB">MongoDB<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Mysql/" title="Mysql">Mysql<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Python/" title="Python">Python<sup>13</sup></a></li>
		  
		
		  
			<li><a href="/categories/Regex/" title="Regex">Regex<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/VisualStudio2017/" title="VisualStudio2017">VisualStudio2017<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Vmware/" title="Vmware">Vmware<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Wpf/" title="Wpf">Wpf<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/css/" title="css">css<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/前端框架/" title="前端框架">前端框架<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/算法/" title="算法">算法<sup>2</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/JavaScript/" title="JavaScript">JavaScript<sup>41</sup></a></li>
			
		
			
				<li><a href="/tags/Python-django/" title="Python django">Python django<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/Html/" title="Html">Html<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Python/" title="Python">Python<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/NET-Core简易入门/" title=".NET Core简易入门">.NET Core简易入门<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/C/" title="C#">C#<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Mysql/" title="Mysql">Mysql<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Git/" title="Git">Git<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/DevExpress/" title="DevExpress">DevExpress<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Css/" title="Css">Css<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/算法/" title="算法">算法<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Docker/" title="Docker">Docker<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Vue/" title="Vue">Vue<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Html5/" title="Html5">Html5<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/webpack/" title="webpack">webpack<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/包管理/" title="包管理">包管理<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/JQuery/" title="JQuery">JQuery<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/模块化/" title="模块化">模块化<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/MongoDB/" title="MongoDB">MongoDB<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/VisualStudio2017/" title="VisualStudio2017">VisualStudio2017<sup>1</sup></a></li>
			
		
		</ul>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer">
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,110laile. <br>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2020 
		
		<a href="/about" target="_blank" title="110laile">110laile</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>











<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
