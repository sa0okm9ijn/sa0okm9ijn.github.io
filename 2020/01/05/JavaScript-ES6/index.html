
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  
    <title>JavaScript-ES6 | 110laile</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="110laile">
    

    
    <meta name="description" content="JavaScript ( JS ) 是一种具有函数优先的轻量级，解释型或即时编译型的编程语言。虽然它是作为开发Web 页面的脚本语言而出名的，但是它也被用到了很多非浏览器环境中，例如 Node.js、 Apache CouchDB 和 Adobe Acrobat。JavaScript 是一种基于原型编程、多范式的动态脚本语言，并且支持面向对象、命令式和声明式（如函数式编程）风格。">
<meta name="keywords" content="JavaScript">
<meta property="og:type" content="article">
<meta property="og:title" content="JavaScript-ES6">
<meta property="og:url" content="http://yoursite.com/2020/01/05/JavaScript-ES6/index.html">
<meta property="og:site_name" content="110laile">
<meta property="og:description" content="JavaScript ( JS ) 是一种具有函数优先的轻量级，解释型或即时编译型的编程语言。虽然它是作为开发Web 页面的脚本语言而出名的，但是它也被用到了很多非浏览器环境中，例如 Node.js、 Apache CouchDB 和 Adobe Acrobat。JavaScript 是一种基于原型编程、多范式的动态脚本语言，并且支持面向对象、命令式和声明式（如函数式编程）风格。">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/2020/01/05/JavaScript-ES6/2019-10-18-17-28-30.png">
<meta property="og:image" content="http://yoursite.com/2020/01/05/JavaScript-ES6/2019-10-18-18-10-18.png">
<meta property="og:image" content="http://yoursite.com/2020/01/05/JavaScript-ES6/2019-10-18-18-10-38.png">
<meta property="og:image" content="http://yoursite.com/2020/01/05/JavaScript-ES6/2019-10-18-18-15-52.png">
<meta property="og:updated_time" content="2020-03-08T07:13:23.121Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="JavaScript-ES6">
<meta name="twitter:description" content="JavaScript ( JS ) 是一种具有函数优先的轻量级，解释型或即时编译型的编程语言。虽然它是作为开发Web 页面的脚本语言而出名的，但是它也被用到了很多非浏览器环境中，例如 Node.js、 Apache CouchDB 和 Adobe Acrobat。JavaScript 是一种基于原型编程、多范式的动态脚本语言，并且支持面向对象、命令式和声明式（如函数式编程）风格。">
<meta name="twitter:image" content="http://yoursite.com/2020/01/05/JavaScript-ES6/2019-10-18-17-28-30.png">

    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>
</html>
  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="110laile" title="110laile"></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="110laile">110laile</a></h1>
				<h2 class="blog-motto">个人技术博客</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索">
						<input type="hidden" name="q" value="site:yoursite.com">
					</form>
					
					</li>
				</ul>
			</ul></nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2020/01/05/JavaScript-ES6/" title="JavaScript-ES6" itemprop="url">JavaScript-ES6</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="110laile" target="_blank" itemprop="author">110laile</a>
		
  </p><p class="article-time">
    <time datetime="2020-01-05T01:25:53.000Z" itemprop="datePublished"> 发表于 2020-01-05</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ES6-课程概述"><span class="toc-number">1.</span> <span class="toc-text">ES6 课程概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#块级绑定"><span class="toc-number">2.</span> <span class="toc-text">块级绑定</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#申明变量的问题"><span class="toc-number">2.1.</span> <span class="toc-text">申明变量的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用let申明变量"><span class="toc-number">2.1.1.</span> <span class="toc-text">使用let申明变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用const申明变量"><span class="toc-number">2.1.2.</span> <span class="toc-text">使用const申明变量</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#字符串和正则表达式"><span class="toc-number">3.</span> <span class="toc-text">字符串和正则表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#更好的unicode支持"><span class="toc-number">3.1.</span> <span class="toc-text">更好的unicode支持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#更多的字符串API"><span class="toc-number">3.2.</span> <span class="toc-text">更多的字符串API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#正则中的粘连标记"><span class="toc-number">3.3.</span> <span class="toc-text">正则中的粘连标记</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模板字符串"><span class="toc-number">3.4.</span> <span class="toc-text">模板字符串</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模板字符串标记"><span class="toc-number">3.5.</span> <span class="toc-text">模板字符串标记</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#函数"><span class="toc-number">4.</span> <span class="toc-text">函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#参数默认值"><span class="toc-number">4.1.</span> <span class="toc-text">参数默认值</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用"><span class="toc-number">4.1.1.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对arguments的影响"><span class="toc-number">4.1.2.</span> <span class="toc-text">对arguments的影响</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#留意暂时性死区"><span class="toc-number">4.1.3.</span> <span class="toc-text">留意暂时性死区</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#剩余参数"><span class="toc-number">4.2.</span> <span class="toc-text">剩余参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#展开运算符"><span class="toc-number">4.3.</span> <span class="toc-text">展开运算符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#对对象展开-ES7"><span class="toc-number">4.3.1.</span> <span class="toc-text">对对象展开 ES7</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#剩余参数和展开运算符练习"><span class="toc-number">4.4.</span> <span class="toc-text">剩余参数和展开运算符练习</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#明确函数的双重用途"><span class="toc-number">4.5.</span> <span class="toc-text">明确函数的双重用途</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#箭头函数"><span class="toc-number">4.6.</span> <span class="toc-text">箭头函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用语法"><span class="toc-number">4.6.1.</span> <span class="toc-text">使用语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注意细节"><span class="toc-number">4.6.2.</span> <span class="toc-text">注意细节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#应用场景"><span class="toc-number">4.6.3.</span> <span class="toc-text">应用场景</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#对象"><span class="toc-number">5.</span> <span class="toc-text">对象</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#对象字面量写法"><span class="toc-number">5.1.</span> <span class="toc-text">对象字面量写法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Object新增的API"><span class="toc-number">5.2.</span> <span class="toc-text">Object新增的API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#面向对象简介"><span class="toc-number">5.3.</span> <span class="toc-text">面向对象简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#类"><span class="toc-number">5.4.</span> <span class="toc-text">类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#传统的构造函数的问题"><span class="toc-number">5.4.1.</span> <span class="toc-text">传统的构造函数的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#类的特点"><span class="toc-number">5.4.2.</span> <span class="toc-text">类的特点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#类的其他书写方式"><span class="toc-number">5.5.</span> <span class="toc-text">类的其他书写方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#类的继承"><span class="toc-number">5.6.</span> <span class="toc-text">类的继承</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#解构"><span class="toc-number">6.</span> <span class="toc-text">解构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#对象解构"><span class="toc-number">6.1.</span> <span class="toc-text">对象解构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在解构中使用默认值"><span class="toc-number">6.1.1.</span> <span class="toc-text">在解构中使用默认值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#非同名属性解构"><span class="toc-number">6.1.2.</span> <span class="toc-text">非同名属性解构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#深层次解构"><span class="toc-number">6.1.3.</span> <span class="toc-text">深层次解构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#剩余项解构"><span class="toc-number">6.1.4.</span> <span class="toc-text">剩余项解构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数组解构"><span class="toc-number">6.2.</span> <span class="toc-text">数组解构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参数解构"><span class="toc-number">6.3.</span> <span class="toc-text">参数解构</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#符号"><span class="toc-number">7.</span> <span class="toc-text">符号</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#共享符号"><span class="toc-number">7.1.</span> <span class="toc-text">共享符号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#知名符号"><span class="toc-number">7.2.</span> <span class="toc-text">知名符号</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#异步处理"><span class="toc-number">8.</span> <span class="toc-text">异步处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#回顾-事件循环"><span class="toc-number">8.1.</span> <span class="toc-text">[回顾]事件循环</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#事件和回调函数的缺陷"><span class="toc-number">8.2.</span> <span class="toc-text">事件和回调函数的缺陷</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#异步处理的通用模型"><span class="toc-number">8.3.</span> <span class="toc-text">异步处理的通用模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Promise的基本使用"><span class="toc-number">8.4.</span> <span class="toc-text">Promise的基本使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Promise的串联"><span class="toc-number">8.5.</span> <span class="toc-text">Promise的串联</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Promise的其他api"><span class="toc-number">8.6.</span> <span class="toc-text">Promise的其他api</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原型成员-实例成员"><span class="toc-number">8.6.1.</span> <span class="toc-text">原型成员 (实例成员)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#构造函数成员-（静态成员）"><span class="toc-number">8.6.2.</span> <span class="toc-text">构造函数成员 （静态成员）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#手写Promise"><span class="toc-number">8.7.</span> <span class="toc-text">手写Promise</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#async-和-await"><span class="toc-number">9.</span> <span class="toc-text">async 和 await</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#async"><span class="toc-number">9.1.</span> <span class="toc-text">async</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#awaits"><span class="toc-number">9.2.</span> <span class="toc-text">awaits</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例demo"><span class="toc-number">9.3.</span> <span class="toc-text">示例demo</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#FetchApi"><span class="toc-number">10.</span> <span class="toc-text">FetchApi</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Fetch-Api-概述"><span class="toc-number">10.1.</span> <span class="toc-text">Fetch Api 概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基本使用"><span class="toc-number">10.2.</span> <span class="toc-text">基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#参数"><span class="toc-number">10.2.1.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#返回值"><span class="toc-number">10.2.2.</span> <span class="toc-text">返回值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Request对象"><span class="toc-number">10.3.</span> <span class="toc-text">Request对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Response对象"><span class="toc-number">10.4.</span> <span class="toc-text">Response对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Headers-对象"><span class="toc-number">10.5.</span> <span class="toc-text">Headers 对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例文件上传"><span class="toc-number">10.6.</span> <span class="toc-text">示例文件上传</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#迭代器和生成器"><span class="toc-number">11.</span> <span class="toc-text">迭代器和生成器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#迭代器"><span class="toc-number">11.1.</span> <span class="toc-text">迭代器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JS中的迭代器"><span class="toc-number">11.2.</span> <span class="toc-text">JS中的迭代器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#可迭代协议与for-of循环"><span class="toc-number">11.3.</span> <span class="toc-text">可迭代协议与for-of循环</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#可迭代协议"><span class="toc-number">11.3.1.</span> <span class="toc-text">可迭代协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#展开运算符与可迭代对象"><span class="toc-number">11.3.2.</span> <span class="toc-text">展开运算符与可迭代对象</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#生成器"><span class="toc-number">11.4.</span> <span class="toc-text">生成器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#生成器应用-异步任务控制"><span class="toc-number">11.5.</span> <span class="toc-text">生成器应用-异步任务控制</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#更多的集合类型"><span class="toc-number">12.</span> <span class="toc-text">更多的集合类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#set集合"><span class="toc-number">12.1.</span> <span class="toc-text">set集合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#set应用"><span class="toc-number">12.2.</span> <span class="toc-text">set应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#手写set"><span class="toc-number">12.3.</span> <span class="toc-text">手写set</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#map集合"><span class="toc-number">12.4.</span> <span class="toc-text">map集合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#手写map"><span class="toc-number">12.5.</span> <span class="toc-text">手写map</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WeakSet和WeakMap"><span class="toc-number">12.6.</span> <span class="toc-text">WeakSet和WeakMap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WeakSet"><span class="toc-number">12.6.1.</span> <span class="toc-text">WeakSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WeakMap"><span class="toc-number">12.6.2.</span> <span class="toc-text">WeakMap</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#代理与反射"><span class="toc-number">13.</span> <span class="toc-text">代理与反射</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#回顾属性描述符"><span class="toc-number">13.1.</span> <span class="toc-text">回顾属性描述符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#存取器属性"><span class="toc-number">13.1.1.</span> <span class="toc-text">存取器属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reflect"><span class="toc-number">13.2.</span> <span class="toc-text">Reflect</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Proxy-代理"><span class="toc-number">13.3.</span> <span class="toc-text">Proxy 代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#应用-观察者模式"><span class="toc-number">13.4.</span> <span class="toc-text">应用-观察者模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#应用-偷懒的构造函数"><span class="toc-number">13.5.</span> <span class="toc-text">应用-偷懒的构造函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#应用-可验证的函数参数"><span class="toc-number">13.6.</span> <span class="toc-text">应用-可验证的函数参数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#增强的数组功能"><span class="toc-number">14.</span> <span class="toc-text">增强的数组功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#静态方法"><span class="toc-number">14.1.</span> <span class="toc-text">静态方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实例方法"><span class="toc-number">14.2.</span> <span class="toc-text">实例方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#扩展-类型化数组"><span class="toc-number">14.3.</span> <span class="toc-text">[扩展]类型化数组</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#数字存储的前置知识"><span class="toc-number">14.3.1.</span> <span class="toc-text">数字存储的前置知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#类型化数组"><span class="toc-number">14.3.2.</span> <span class="toc-text">类型化数组</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ArrayBuffer"><span class="toc-number">14.4.</span> <span class="toc-text">ArrayBuffer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#读写ArrayBuffer"><span class="toc-number">14.4.1.</span> <span class="toc-text">读写ArrayBuffer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#制作黑白图片"><span class="toc-number">14.5.</span> <span class="toc-text">制作黑白图片</span></a></li></ol></li></ol>
		
		</div>
		
		<h1 id="ES6-课程概述"><a href="#ES6-课程概述" class="headerlink" title="ES6 课程概述"></a>ES6 课程概述</h1><ol>
<li>ECMAScript、JavaScript、NodeJs，它们的区别是什么？</li>
</ol>
<p>ECMAScript：简称ES，是一个语言标准（循环、判断、变量、数组等数据类型）</p>
<p>JavaScript：运行在浏览器端的语言，该语言使用ES标准。 ES + web api = JavaScript</p>
<p>NodeJs：运行在服务器端的语言，该语言使用ES标准。 ES + node api = NodeJs</p>
<p>无论JavaScript，还是NodeJs，它们都是ES的超集（super set）</p>
<ol start="2">
<li>ECMAScript有哪些关键的版本？</li>
</ol>
<p>ES3.0： 1999</p>
<p>ES5.0:  2009</p>
<p>ES6.0:  2015, 从该版本开始，不再使用数字作为编号，而使用年份</p>
<p>ES7.0:  2016</p>
<ol start="3">
<li>为什么ES6如此重要？</li>
</ol>
<p>ES6解决JS无法开发大型应用的语言层面的问题。</p>
<h1 id="块级绑定"><a href="#块级绑定" class="headerlink" title="块级绑定"></a>块级绑定</h1><h2 id="申明变量的问题"><a href="#申明变量的问题" class="headerlink" title="申明变量的问题"></a>申明变量的问题</h2><p>使用var声明变量</p>
<ol>
<li><p>允许重复的变量声明：导致数据被覆盖</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//假设这里有一千行代码</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">print();</span><br></pre></td></tr></table></figure>
</li>
<li><p>变量提升：怪异的数据访问、闭包问题</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//怪异数据访问</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">Math</span>.random() &lt; <span class="number">0.5</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="string">"abc"</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="comment">//变量提升：闭包问题</span></span><br><span class="line"><span class="keyword">var</span> div = <span class="built_in">document</span>.getElementById(<span class="string">"divButtons"</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> btn = <span class="built_in">document</span>.createElement(<span class="string">"button"</span>);</span><br><span class="line">    btn.innerHTML = <span class="string">"按钮"</span> + i;</span><br><span class="line">    div.appendChild(btn);</span><br><span class="line">    btn.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i); <span class="comment">//输出11</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>全局变量挂载到全局对象：全局对象成员污染问题</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">console</span> = <span class="string">"abc"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">console</span>)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="使用let申明变量"><a href="#使用let申明变量" class="headerlink" title="使用let申明变量"></a>使用let申明变量</h3><p>ES6不仅引入let关键字用于解决变量声明的问题，同时引入了块级作用域的概念</p>
<p>块级作用域：代码执行时遇到花括号，会创建一个块级作用域，花括号结束，销毁块级作用域</p>
<p>声明变量的问题</p>
<ol>
<li><p>允许重复的变量声明：导致数据被覆盖 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">123</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">456</span>; <span class="comment">// 检查到，当前作用域（全局作用域）已声明了变量a</span></span><br></pre></td></tr></table></figure>
<p> let声明的变量，不允许当前作用域范围内重复声明</p>
</li>
<li><p>变量提升：怪异的数据访问、闭包问题</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//怪异数据访问</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">Math</span>.random() &lt; <span class="number">0.5</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> a = <span class="number">123</span>; <span class="comment">//定义在当前块级作用域</span></span><br><span class="line">    <span class="built_in">console</span>.log(a) <span class="comment">//当前块级作用域中的a</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">//这是另外一个块级作用域，该作用域中找不到a</span></span><br><span class="line">    <span class="built_in">console</span>.log(a)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//变量提升：闭包问题</span></span><br><span class="line"><span class="keyword">let</span> div = <span class="built_in">document</span>.getElementById(<span class="string">"divButtons"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">1</span>; i &lt;= <span class="number">10</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">let</span> button = <span class="built_in">document</span>.createElement(<span class="string">"button"</span>)</span><br><span class="line">    button.innerHTML = <span class="string">"按钮"</span> + i;</span><br><span class="line">    button.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i) <span class="comment">//使用的是当前作用域中的i</span></span><br><span class="line">    &#125;</span><br><span class="line">    div.appendChild(button)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 底层实现上，let声明的变量实际上也会有提升，但是，提升后会将其放入到“暂时性死区”，如果访问的变量位于暂时性死区，则会报错：<code>Cannot access &#39;a&#39; before initialization</code>。当代码运行到该变量的声明语句时，会将其从暂时性死区中移除。</p>
<p> 在循环中，用let声明的循环变量，会特殊处理，每次进入循环体，都会开启一个新的作用域，并且将循环变量绑定到该作用域（每次循环，使用的是一个全新的循环变量）<br> 在循环中使用let声明的循环变量，在循环结束后会销毁</p>
</li>
<li>全局变量挂载到全局对象：全局对象成员污染问题<br> let声明的变量不会挂载到全局对象</li>
</ol>
<h3 id="使用const申明变量"><a href="#使用const申明变量" class="headerlink" title="使用const申明变量"></a>使用const申明变量</h3><p>const和let完全相同，仅在于用const声明的变量，必须在声明时赋值，而且不可以重新赋值。<br>实际上，在开发中，应该尽量使用const来声明变量，以保证变量的值不会随意篡改，原因如下：</p>
<ol>
<li>根据经验，开发中的很多变量，都是不会更改，也不应该更改的。</li>
<li>后续的很多框架或者是第三方JS库，都要求数据不可变，使用常量可以一定程度上保证这一点。</li>
</ol>
<p>注意的细节：</p>
<ol>
<li><p>常量不可变，是指声明的常量的内存空间不可变，并不保证内存空间中的地址指向的其他空间不可变。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = &#123;</span><br><span class="line">    name: <span class="string">"kevin"</span>,</span><br><span class="line">    age: <span class="number">123</span></span><br><span class="line">&#125;;</span><br><span class="line">a.name = <span class="string">"abc"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a)</span><br></pre></td></tr></table></figure>
</li>
<li><p>常量的命名</p>
<ol>
<li>特殊的常量：该常量从字面意义上，一定是不可变的，比如圆周率、月地距地或其他一些绝不可能变化的配置。通常，<strong>该常量的名称全部使用大写，多个单词之间用下划线分割</strong></li>
<li>普通的常量：使用和之前一样的命名即可</li>
</ol>
</li>
<li>在for循环中，循环变量不可以使用常量(<code>for in</code> 可以)</li>
</ol>
<h1 id="字符串和正则表达式"><a href="#字符串和正则表达式" class="headerlink" title="字符串和正则表达式"></a>字符串和正则表达式</h1><h2 id="更好的unicode支持"><a href="#更好的unicode支持" class="headerlink" title="更好的unicode支持"></a>更好的unicode支持</h2><p>早期，由于存储空间宝贵，Unicode使用16位二进制来存储文字。我们将一个16位的二进制编码叫做一个码元（Code Unit）。<br>后来，由于技术的发展，Unicode对文字编码进行了扩展，将某些文字扩展到了32位（占用两个码元），并且，将某个文字对应的二进制数字叫做码点（Code Point）。</p>
<p>由于js长时间没有更新,es6之前js认为一个码点就是一个码元,因此取字符串长度是按照码元来取的,在正则表达式也是按照码元来匹配的.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> text=<span class="string">'𠮷'</span><span class="comment">//占用2个码元</span></span><br><span class="line"><span class="built_in">console</span>.log(text.length);<span class="comment">//输出长度为2</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="regexp">/^.$/</span>.test(text));<span class="comment">//输出为false</span></span><br><span class="line"><span class="comment">//==&gt;2</span></span><br></pre></td></tr></table></figure>
<p>ES6为了解决这个困扰，为字符串提供了方法：codePointAt，根据字符串码元的位置得到其码点。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(test.codePointAt(<span class="number">0</span>))<span class="comment">//获取第一个码点,如果该字符串由2个码元组成,则返回2个码元的组成.</span></span><br><span class="line"><span class="built_in">console</span>.log(text.codePointAt(<span class="number">0</span>))<span class="comment">//正常返回第二个码点</span></span><br></pre></td></tr></table></figure>
<p>同时，ES6为正则表达式添加了一个flag: u，如果添加了该配置，则匹配时，使用码点匹配<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">`使用正则测试:`</span>,/^.$/u.test(test))</span><br></pre></td></tr></table></figure></p>
<p><strong>应用</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">is32Bit</span>(<span class="params">char,i</span>)</span>&#123;</span><br><span class="line"> 	<span class="keyword">return</span> char.codePointAt(i) &gt; <span class="number">0xffff</span>; </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getLengthOfCodePoint</span>(<span class="params">str</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> len = <span class="number">0</span>;</span><br><span class="line">  	<span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>;i&lt;str.length;i++)&#123;</span><br><span class="line">        <span class="comment">//碰到𠮷是32位置的多加一位置,下一次循环就到a了</span></span><br><span class="line">    	<span class="keyword">if</span>(is32Bit(str,i))&#123;</span><br><span class="line">        	i++;</span><br><span class="line">        &#125;</span><br><span class="line">      	len++;</span><br><span class="line">    &#125;</span><br><span class="line">  	<span class="keyword">return</span> len;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'𠮷是否是32位的:'</span>,is32Bit(<span class="string">'𠮷'</span>,<span class="number">0</span>))</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"ab𠮷ab的码点长度："</span>, getLengthOfCodePoint(<span class="string">"ab𠮷ab"</span>))</span><br></pre></td></tr></table></figure>
<h2 id="更多的字符串API"><a href="#更多的字符串API" class="headerlink" title="更多的字符串API"></a>更多的字符串API</h2><p>以下均为字符串的实例（原型）方法</p>
<ul>
<li>includes</li>
</ul>
<p>判断字符串中是否包含指定的子字符串</p>
<ul>
<li>startsWith</li>
</ul>
<p>判断字符串中是否以指定的字符串开始</p>
<ul>
<li>endsWith</li>
</ul>
<p>判断字符串中是否以指定的字符串结尾</p>
<ul>
<li>repeat</li>
</ul>
<p>将字符串重复指定的次数，然后返回一个新字符串。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> text=<span class="string">"挺简单的哦"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"是否包含`哦`："</span>, text.includes(<span class="string">"哦"</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"是否以“挺简”开头："</span>, text.startsWith(<span class="string">"挺简"</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"是否以“哦”结尾："</span>, text.endsWith(<span class="string">"哦"</span>));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"重复4次："</span>, text.repeat(<span class="number">4</span>));</span><br></pre></td></tr></table></figure>
<h2 id="正则中的粘连标记"><a href="#正则中的粘连标记" class="headerlink" title="正则中的粘连标记"></a>正则中的粘连标记</h2><p>标记名：y</p>
<p>含义：匹配时，完全按照正则对象中的lastIndex位置开始匹配，并且匹配的位置必须在lastIndex位置。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> text=<span class="string">'Hello World'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reg=<span class="regexp">/W\w+/y</span>;</span><br><span class="line">reg.lastIndex = <span class="number">6</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"reg.lastIndex:"</span>, reg.lastIndex)</span><br><span class="line"><span class="built_in">console</span>.log(reg.test(text))</span><br></pre></td></tr></table></figure>
<h2 id="模板字符串"><a href="#模板字符串" class="headerlink" title="模板字符串"></a>模板字符串</h2><p>S6之前处理字符串繁琐的两个方面：</p>
<ol>
<li>多行字符串</li>
<li>字符串拼接</li>
</ol>
<p>在ES6中，提供了模板字符串的书写，可以非常方便的换行和拼接，要做的，仅仅是将字符串的开始或结尾改为 ` 符号</p>
<p>如果要在字符串中拼接js表达式，只需要在模板字符串中使用<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```js</span><br><span class="line">var love1 = &quot;秋葵&quot;;</span><br><span class="line">var love2 = &quot;香菜&quot;;</span><br><span class="line"></span><br><span class="line">var text = `邓哥喜欢$&#123;love1&#125;</span><br><span class="line">邓哥也喜欢$&#123;love2&#125;</span><br><span class="line">表达式可以是任何有意义的数据$&#123;1 + 3 * 2 / 0.5&#125;</span><br><span class="line">表达式是可以嵌套的：$&#123;`表达式中的模板字符串$&#123;love1 + love2&#125;`&#125;</span><br><span class="line">\n\n</span><br><span class="line">奥布瓦的发顺丰</span><br><span class="line">在模板字符串中使用\$&#123;JS表达式&#125;可以进行插值</span><br><span class="line">`;</span><br><span class="line"></span><br><span class="line">console.log(text);</span><br></pre></td></tr></table></figure></p>
<h2 id="模板字符串标记"><a href="#模板字符串标记" class="headerlink" title="模板字符串标记"></a>模板字符串标记</h2><p>在模板字符串书写之前，可以加上标记:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">标记名<span class="string">`模板字符串`</span></span><br></pre></td></tr></table></figure>
<p>标记是一个函数，函数参数如下：</p>
<ol>
<li>参数1：被插值分割的字符串数组</li>
<li>后续参数：所有的插值</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> love1 = <span class="string">"秋葵"</span>;</span><br><span class="line"><span class="keyword">var</span> love2 = <span class="string">"香菜"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> text = myTag<span class="string">`邓哥喜欢<span class="subst">$&#123;love1&#125;</span>，邓哥也喜欢<span class="subst">$&#123;love2&#125;</span>。`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//相当于： </span></span><br><span class="line"><span class="comment">// text = myTag(["邓哥喜欢", "，邓哥也喜欢", "。"], "秋葵", "香菜")</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myTag</span>(<span class="params">parts</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> values = <span class="built_in">Array</span>.prototype.slice.apply(<span class="built_in">arguments</span>).slice(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">let</span> str = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; values.length; i++) &#123;</span><br><span class="line">        str += <span class="string">`<span class="subst">$&#123;parts[i]&#125;</span>：<span class="subst">$&#123;values[i]&#125;</span>`</span>;</span><br><span class="line">        <span class="keyword">if</span> (i === values.length - <span class="number">1</span>) &#123;</span><br><span class="line">            str += parts[i + <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(text);</span><br></pre></td></tr></table></figure>
<p>输出转义标记<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> text = <span class="built_in">String</span>.raw<span class="string">`abc\t\nbcd`</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(text);</span><br></pre></td></tr></table></figure></p>
<p><strong>示例</strong><br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//html</span></span><br><span class="line">&lt;p&gt;</span><br><span class="line">    &lt;textarea name=<span class="string">""</span> id=<span class="string">"txt"</span> cols=<span class="string">"30"</span> rows=<span class="string">"10"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">textarea</span>&gt;</span></span></span><br><span class="line">    &lt;button id=<span class="string">"btn"</span>&gt;设置div内容&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">&lt;/</span>p&gt;</span><br><span class="line">&lt;div id=<span class="string">"container"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/js</span></span><br><span class="line"><span class="regexp">const container = document.getElementById("container");</span></span><br><span class="line"><span class="regexp">const txt = document.getElementById("txt");</span></span><br><span class="line"><span class="regexp">const btn = document.getElementById("btn");</span></span><br><span class="line"><span class="regexp">btn.onclick = function () &#123;</span></span><br><span class="line"><span class="regexp">    container.innerHTML = safe`&lt;p&gt;$&#123;txt.value&#125;&lt;/</span>p&gt;<span class="xml"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>$&#123;txt.value&#125;<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><span class="string">`;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">function safe(parts) &#123;</span></span><br><span class="line"><span class="string">    const values = Array.prototype.slice.apply(arguments).slice(1);</span></span><br><span class="line"><span class="string">    let str = "";</span></span><br><span class="line"><span class="string">    for (let i = 0; i &lt; values.length; i++) &#123;</span></span><br><span class="line"><span class="string">        const v = values[i].replace(/&lt;/g, "&amp;lt;").replace(/&gt;/g, "&amp;gt;");</span></span><br><span class="line"><span class="string">        str += parts[i] + v;</span></span><br><span class="line"><span class="string">        if (i == values.length - 1) &#123;</span></span><br><span class="line"><span class="string">            str += parts[i + 1];</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">    return str;</span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure></p>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><h2 id="参数默认值"><a href="#参数默认值" class="headerlink" title="参数默认值"></a>参数默认值</h2><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>在书写形参时，直接给形参赋值，附的值即为默认值</p>
<p>这样一来，当调用函数时，如果没有给对应的参数赋值（给它的值是undefined），则会自动使用默认值。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">a, b = <span class="number">1</span>, c = <span class="number">2</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b + c;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">10</span>, <span class="literal">undefined</span>, <span class="literal">undefined</span>))</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">11</span>))</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>, <span class="literal">undefined</span>, <span class="number">5</span>))</span><br></pre></td></tr></table></figure>
<h3 id="对arguments的影响"><a href="#对arguments的影响" class="headerlink" title="对arguments的影响"></a>对arguments的影响</h3><p>只要给函数加上参数默认值，该函数会自动变量严格模式下的规则：arguments和形参脱离<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a,b=<span class="number">1</span></span>)</span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">"arugments"</span>, <span class="built_in">arguments</span>[<span class="number">0</span>], <span class="built_in">arguments</span>[<span class="number">1</span>]);</span><br><span class="line">  	<span class="built_in">console</span>.log(<span class="string">"a:"</span>, a, <span class="string">"b:"</span>, b);</span><br><span class="line">  	a=<span class="number">3</span>;</span><br><span class="line">  	<span class="built_in">console</span>.log(<span class="string">"arugments"</span>, <span class="built_in">arguments</span>[<span class="number">0</span>], <span class="built_in">arguments</span>[<span class="number">1</span>]);</span><br><span class="line">  	<span class="built_in">console</span>.log(<span class="string">"a:"</span>, a, <span class="string">"b:"</span>, b);</span><br><span class="line">&#125;</span><br><span class="line">test(<span class="number">2</span>);</span><br></pre></td></tr></table></figure></p>
<h3 id="留意暂时性死区"><a href="#留意暂时性死区" class="headerlink" title="留意暂时性死区"></a>留意暂时性死区</h3><p>形参和ES6中的let或const声明一样，具有作用域，并且根据参数的声明顺序，存在暂时性死区。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a,b=a</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a,b)</span><br><span class="line">&#125;</span><br><span class="line">test(<span class="number">1</span>)</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">a=b,b</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a,b)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//如果第一个a=b,则会出现错误</span></span><br></pre></td></tr></table></figure>
<h2 id="剩余参数"><a href="#剩余参数" class="headerlink" title="剩余参数"></a>剩余参数</h2><p>arguments的缺陷：</p>
<ol>
<li>如果和形参配合使用，容易导致混乱</li>
<li>从语义上，使用arguments获取参数，由于形参缺失，无法从函数定义上理解函数的真实意图</li>
</ol>
<p>ES6的剩余参数专门用于收集末尾的所有参数，将其放置到一个形参数组中。</p>
<p>语法:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> (<span class="params">...形参名</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>细节：</strong></p>
<ol>
<li>一个函数，仅能出现一个剩余参数</li>
<li>一个函数，如果有剩余参数，剩余参数必须是最后一个参数</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//args收集了所有的参数，形成的一个数组</span></span><br><span class="line">    <span class="keyword">let</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; args.length; i++) &#123;</span><br><span class="line">        sum += args[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(sum())</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>))</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>, <span class="number">2</span>))</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>))</span><br><span class="line"><span class="built_in">console</span>.log(sum(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>))</span><br></pre></td></tr></table></figure>
<h2 id="展开运算符"><a href="#展开运算符" class="headerlink" title="展开运算符"></a>展开运算符</h2><p>使用方式：<figure class="highlight plain"><figcaption><span>```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 对数组展开 ES6</span><br><span class="line"></span><br><span class="line">对于剩余参数的展开</span><br><span class="line">```js</span><br><span class="line">const arr=[1,2,3,4,5,6];</span><br><span class="line"></span><br><span class="line">function sum(...args)&#123;</span><br><span class="line">	let sum=0;</span><br><span class="line">  	for(let i = 0 ; i &lt; args.length;i++)&#123;</span><br><span class="line">    	sum+=args[i];</span><br><span class="line">    &#125;</span><br><span class="line">  	return sum;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">console.log(sum(...arr));</span><br><span class="line">console.log(sum(1,2,3,...arr,4,5,6))</span><br></pre></td></tr></table></figure></p>
<p>克隆数组<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr1=[<span class="number">3</span>,<span class="number">67</span>,<span class="number">8</span>,<span class="number">5</span>];</span><br><span class="line"><span class="keyword">const</span> arr2=[<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,...arr1,<span class="number">4</span>];</span><br><span class="line"><span class="built_in">console</span>.log(arr2,arr1===arr2)</span><br></pre></td></tr></table></figure></p>
<h3 id="对对象展开-ES7"><a href="#对对象展开-ES7" class="headerlink" title="对对象展开 ES7"></a>对对象展开 ES7</h3><p>对象克隆</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj1=&#123;</span><br><span class="line">	name:<span class="string">"ggbond"</span>,</span><br><span class="line">  	age:<span class="number">12</span>,</span><br><span class="line">  	address:&#123;</span><br><span class="line">    	country:<span class="string">"中国"</span>,</span><br><span class="line">      	province:<span class="string">"陕西"</span>,</span><br><span class="line">      	city:<span class="string">"西安"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj2=&#123;</span><br><span class="line">	...obj1,</span><br><span class="line">  	name:<span class="string">'ge'</span>,</span><br><span class="line">  	address:&#123;</span><br><span class="line">		...obj1.address</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj2,obj1.address===obj2.address);</span><br></pre></td></tr></table></figure>
<h2 id="剩余参数和展开运算符练习"><a href="#剩余参数和展开运算符练习" class="headerlink" title="剩余参数和展开运算符练习"></a>剩余参数和展开运算符练习</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//函数柯里化</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cal</span>(<span class="params">a,b,c,d</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a+b*c-d;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">curry</span>(<span class="params">func,...args</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">...subargs</span>)</span>&#123;</span><br><span class="line">    	<span class="keyword">const</span> allArgs = [...args,...subargs];</span><br><span class="line">      	<span class="keyword">if</span>(allArgs.length &gt;= func.length)&#123;</span><br><span class="line">        	<span class="keyword">return</span> func(...allArgs);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        	<span class="keyword">return</span> curry(func,...allArgs);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> newCal = curry(cal, <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(newCal(<span class="number">3</span>, <span class="number">4</span>)) <span class="comment">// 1+2*3-4</span></span><br><span class="line"><span class="keyword">const</span> newCal2 = newCal(<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(newCal2(<span class="number">9</span>)); <span class="comment">// 1+2*8-9</span></span><br></pre></td></tr></table></figure>
<h2 id="明确函数的双重用途"><a href="#明确函数的双重用途" class="headerlink" title="明确函数的双重用途"></a>明确函数的双重用途</h2><p>ES6提供了一个特殊的API，可以使用该API在函数内部，判断该函数是否使用了new来调用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span>.target </span><br><span class="line"><span class="comment">//该表达式，得到的是：如果没有使用new来调用函数，则返回undefined</span></span><br><span class="line"><span class="comment">//如果使用new调用函数，则得到的是new关键字后面的函数本身</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">firstName,lastName</span>)</span>&#123;</span><br><span class="line">    <span class="comment">// //过去的判断方式</span></span><br><span class="line">    <span class="comment">// if (!(this instanceof Person)) &#123;</span></span><br><span class="line">    <span class="comment">//     throw new Error("该函数没有使用new来调用")</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">new</span>.target === <span class="literal">undefined</span>)&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'该函数没有使用new来调用'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">this</span>.firstName=firstName;</span><br><span class="line">    <span class="keyword">this</span>.lastName=lastName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="箭头函数"><a href="#箭头函数" class="headerlink" title="箭头函数"></a>箭头函数</h2><p>回顾：this指向</p>
<ol>
<li>通过对象调用函数，this指向对象</li>
<li>直接调用函数，this指向全局对象</li>
<li>如果通过new调用函数，this指向新创建的对象</li>
<li>如果通过apply、call、bind调用函数，this指向指定的数据</li>
<li>如果是DOM事件函数，this指向事件源</li>
</ol>
<h3 id="使用语法"><a href="#使用语法" class="headerlink" title="使用语法"></a>使用语法</h3><p>箭头函数是一个函数表达式，理论上，任何使用函数表达式的场景都可以使用箭头函数</p>
<ul>
<li><p>完整语法：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    count: <span class="number">0</span>,</span><br><span class="line">    start: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>.count++;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.count);</span><br><span class="line">        &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    regEvent: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">window</span>.onclick = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.count);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    print: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.count)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// obj.start();</span></span><br><span class="line"><span class="comment">// obj.regEvent();</span></span><br><span class="line">obj.print();</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果参数只有一个，可以省略小括号</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> print = <span class="function"><span class="params">num</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"给我的数字是："</span>, num)</span><br><span class="line">&#125;</span><br><span class="line">print(<span class="number">2</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果箭头函数只有一条返回语句，可以省略大括号，和return关键字</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> isOdd = <span class="function"><span class="params">num</span> =&gt;</span> num % <span class="number">2</span> !== <span class="number">0</span>;</span><br></pre></td></tr></table></figure>
</li>
<li><p>返回对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> sum = <span class="function">(<span class="params">a, b</span>) =&gt;</span> (&#123;</span><br><span class="line">    a: a,</span><br><span class="line">    b: b,</span><br><span class="line">    sum: a + b</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="注意细节"><a href="#注意细节" class="headerlink" title="注意细节"></a>注意细节</h3><ul>
<li><p>箭头函数中，不存在this、arguments、new.target，如果使用了，则使用的是函数外层的对应的this、arguments、new.target</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> func = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    method: <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> func = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">arguments</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        func()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.method(<span class="number">234</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//指向obj和method方法里的arguments</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> func = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//指向window</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>箭头函数没有原型</p>
</li>
<li>箭头函数不能作用构造函数使用</li>
</ul>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ol>
<li>临时性使用的函数，并不会刻意调用它，比如：<ol>
<li>事件处理函数</li>
<li>异步处理函数</li>
<li>其他临时性的函数</li>
</ol>
</li>
<li>为了绑定外层this的函数</li>
<li>在不影响其他代码的情况下，保持代码的简洁，最常见的，数组方法中的回调函数</li>
</ol>
<h1 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h1><h2 id="对象字面量写法"><a href="#对象字面量写法" class="headerlink" title="对象字面量写法"></a>对象字面量写法</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">    name: <span class="string">"姬成"</span>,</span><br><span class="line">    age: <span class="number">100</span>,</span><br><span class="line">    sayHello()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name, <span class="keyword">this</span>.age)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">user.sayHello();</span><br></pre></td></tr></table></figure>
<ol>
<li><p>成员速写<br>如果对象字面量初始化时，成员的名称来自于一个变量，并且和变量的名称相同，则可以进行简写</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createUser</span>(<span class="params">loginId, loginPwd, nickName</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> sayHello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"loginId"</span>, <span class="keyword">this</span>.loginId, <span class="string">"nickname"</span>, <span class="keyword">this</span>.nickName)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        loginId,</span><br><span class="line">        loginPwd,</span><br><span class="line">        nickName,</span><br><span class="line">        sayHello,</span><br><span class="line">        id: <span class="built_in">Math</span>.random()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> u = createUser(<span class="string">"abc"</span>, <span class="string">"123"</span>, <span class="string">"aaa"</span>);</span><br><span class="line">u.sayHello();</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法速写<br>对象字面初始化时，方法可以省略冒号和function关键字</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">	print()&#123;</span><br><span class="line">    	<span class="built_in">console</span>.log(<span class="string">'123'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.print()</span><br></pre></td></tr></table></figure>
</li>
<li><p>计算属性名<br>有的时候，初始化对象时，某些属性名可能来自于某个表达式的值，在ES6，可以使用中括号来表示该属性名是通过计算得到的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> prop1 = <span class="string">"name2"</span>;</span><br><span class="line"><span class="keyword">const</span> prop2 = <span class="string">"age2"</span>;</span><br><span class="line"><span class="keyword">const</span> prop3 = <span class="string">"sayHello2"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">    [prop1]: <span class="string">"姬成"</span>,</span><br><span class="line">    [prop2]: <span class="number">100</span>,</span><br><span class="line">    [prop3]()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>[prop1], <span class="keyword">this</span>[prop2])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">user[prop3]();</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(user)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="Object新增的API"><a href="#Object新增的API" class="headerlink" title="Object新增的API"></a>Object新增的API</h2><ol>
<li><p>Object.is<br>用于判断两个数据是否相等，基本上跟严格相等（===）是一致的，除了以下两点：<br>1) NaN和NaN相等<br>2) +0和-0不相等</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="literal">NaN</span>===<span class="literal">NaN</span>)<span class="comment">//false</span></span><br><span class="line"><span class="built_in">console</span>.log(+<span class="number">0</span>===<span class="number">-0</span>)<span class="comment">//true</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.is(<span class="literal">NaN</span>,<span class="literal">NaN</span>))<span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.is(+<span class="number">0</span>,<span class="number">-0</span>))<span class="comment">//false</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>Object.assign<br>用于混合对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj1 = &#123;</span><br><span class="line">    a: <span class="number">123</span>,</span><br><span class="line">    b: <span class="number">456</span>,</span><br><span class="line">    c: <span class="string">"abc"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> obj2 = &#123;</span><br><span class="line">    a: <span class="number">789</span>,</span><br><span class="line">    d: <span class="string">"kkk"</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> obj = <span class="built_in">Object</span>.assign(&#123;&#125;, obj1, obj2);</span><br></pre></td></tr></table></figure>
</li>
<li><p>Object.getOwnPropertyNames</p>
</li>
</ol>
<p>Object.getOwnPropertyNames方法之前就存在，只不过，官方没有明确要求，对属性的顺序如何排序，如何排序，完全由浏览器厂商决定。</p>
<p>ES6规定了该方法返回的数组的排序方式如下：</p>
<ul>
<li>先排数字，并按照升序排序</li>
<li>再排其他，按照书写顺序排序</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    d: <span class="number">1</span>,</span><br><span class="line">    b: <span class="number">2</span>,</span><br><span class="line">    a: <span class="number">3</span>,</span><br><span class="line">    <span class="number">0</span>: <span class="number">6</span>,</span><br><span class="line">    <span class="number">5</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="number">4</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> props = <span class="built_in">Object</span>.getOwnPropertyNames(obj)</span><br><span class="line"><span class="built_in">console</span>.log(props)</span><br><span class="line"><span class="comment">//["0", "4", "5", "d", "b", "a"]</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>Object.setPrototypeOf<br>该函数用于设置某个对象的隐式原型<br>比如： Object.setPrototypeOf(obj1, obj2)，<br>相当于：  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">```js</span><br><span class="line">const obj1 = &#123;</span><br><span class="line">    a: 1</span><br><span class="line">&#125;</span><br><span class="line">const obj2 = &#123;</span><br><span class="line">    b: 2</span><br><span class="line">&#125;</span><br><span class="line">Object.setPrototypeOf(obj1, obj2)</span><br><span class="line">console.log(obj1)</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="面向对象简介"><a href="#面向对象简介" class="headerlink" title="面向对象简介"></a>面向对象简介</h2><p>面向对象：一种编程思想，跟具体的语言</p>
<p>对比面向过程：</p>
<ul>
<li><p>面向过程：思考的切入点是功能的步骤</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 冰箱门打开</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">openFrige</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">openFrige();</span><br><span class="line"></span><br><span class="line"><span class="comment">//2. 大象装进去</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">elephantIn</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">elephantIn();</span><br><span class="line"></span><br><span class="line"><span class="comment">//3. 冰箱门关上</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">closeFrige</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">closeFrige();</span><br></pre></td></tr></table></figure>
</li>
<li><p>面向对象：思考的切入点是对象的划分</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 大象</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Elephant</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 冰箱</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Frige</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Frige.prototype.openDoor = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Frige.prototype.closeDoor = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Frige.prototype.join = <span class="function"><span class="keyword">function</span>(<span class="params">something</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.openDoor();</span><br><span class="line">    <span class="comment">//装东西</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.closeDoor();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> frig = <span class="keyword">new</span> Frige();</span><br><span class="line"></span><br><span class="line">frig.join(<span class="keyword">new</span> Elephant());</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>【大象装冰箱】</p>
<h2 id="类"><a href="#类" class="headerlink" title="类"></a>类</h2><p>构造函数的语法糖</p>
<h3 id="传统的构造函数的问题"><a href="#传统的构造函数的问题" class="headerlink" title="传统的构造函数的问题"></a>传统的构造函数的问题</h3><ol>
<li><p>属性和原型方法定义分离，降低了可读性</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//面向对象中，将 下面对一个对象的所有成员的定义，统称为类</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//构造函数  构造器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Animal</span>(<span class="params">type, name, age, sex</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.type = type;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">    <span class="keyword">this</span>.sex = sex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//定义实例方法（原型方法）</span></span><br><span class="line">Animal.prototype.print = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【种类】：<span class="subst">$&#123;<span class="keyword">this</span>.type&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【名字】：<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【年龄】：<span class="subst">$&#123;<span class="keyword">this</span>.age&#125;</span>`</span>);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`【性别】：<span class="subst">$&#123;<span class="keyword">this</span>.sex&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>原型成员可以被枚举</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> Animal(<span class="string">"狗"</span>, <span class="string">"旺财"</span>, <span class="number">3</span>, <span class="string">"男"</span>);</span><br><span class="line">a.print();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> prop <span class="keyword">in</span> a) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(prop)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>默认情况下，构造函数仍然可以被当作普通函数使用</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Animal()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="类的特点"><a href="#类的特点" class="headerlink" title="类的特点"></a>类的特点</h3><ol>
<li>类声明不会被提升，与 let 和 const 一样，存在暂时性死区</li>
<li>类中的所有代码均在严格模式下执行</li>
<li>类的所有方法都是不可枚举的</li>
<li>类的所有方法都无法被当作构造函数使用</li>
<li>类的构造器必须使用 new 来调用<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(type,name,age,sex)&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line">    print()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【种类】：<span class="subst">$&#123;<span class="keyword">this</span>.type&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【名字】：<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【年龄】：<span class="subst">$&#123;<span class="keyword">this</span>.age&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【性别】：<span class="subst">$&#123;<span class="keyword">this</span>.sex&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> Animal(<span class="string">"狗"</span>, <span class="string">"旺财"</span>, <span class="number">3</span>, <span class="string">"男"</span>);</span><br><span class="line">a.print();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> prop <span class="keyword">in</span> a) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(prop)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="类的其他书写方式"><a href="#类的其他书写方式" class="headerlink" title="类的其他书写方式"></a>类的其他书写方式</h2><ol>
<li><p>可计算的成员名</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> printName = <span class="string">"print"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(type, name, age, sex) &#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [printName]() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【种类】：<span class="subst">$&#123;<span class="keyword">this</span>.type&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【名字】：<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【年龄】：<span class="subst">$&#123;<span class="keyword">this</span>.age&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【性别】：<span class="subst">$&#123;<span class="keyword">this</span>.sex&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> Animal(<span class="string">"狗"</span>, <span class="string">"旺财"</span>, <span class="number">3</span>, <span class="string">"男"</span>);</span><br><span class="line">a[printName]();</span><br></pre></td></tr></table></figure>
</li>
<li><p>getter和setter<br>Object.defineProperty 可定义某个对象成员属性的读取和设置<br>用getter和setter控制的属性，不在原型上</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> printName = <span class="string">"print"</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(type, name, age, sex) &#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//创建一个age属性，并给它加上getter，读取该属性时，会运行该函数</span></span><br><span class="line">    <span class="keyword">get</span> age() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._age + <span class="string">"岁"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建一个age属性，并给它加上setter，给该属性赋值时，会运行该函数</span></span><br><span class="line">    <span class="keyword">set</span> age(age) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> age !== <span class="string">"number"</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"age property must be a number"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (age &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            age = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (age &gt; <span class="number">1000</span>) &#123;</span><br><span class="line">            age = <span class="number">1000</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>._age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [printName]() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【种类】：<span class="subst">$&#123;<span class="keyword">this</span>.type&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【名字】：<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【年龄】：<span class="subst">$&#123;<span class="keyword">this</span>.age&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【性别】：<span class="subst">$&#123;<span class="keyword">this</span>.sex&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="keyword">new</span> Animal(<span class="string">"狗"</span>, <span class="string">"旺财"</span>, <span class="number">3</span>, <span class="string">"男"</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>静态成员<br>构造函数本身的成员<br>使用static关键字定义的成员即静态成员</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Chess</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name) &#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> width = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> height = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> method() &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(Chess.width)</span><br><span class="line"><span class="built_in">console</span>.log(Chess.height)</span><br><span class="line">Chess.method();</span><br></pre></td></tr></table></figure>
</li>
<li><p>字段初始化器（ES7）<br>注意：<br> 1). 使用static的字段初始化器，添加的是静态成员<br> 2). 没有使用static的字段初始化器，添加的成员位于对象上</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> a = <span class="number">1</span>;</span><br><span class="line">    b = <span class="number">2</span>;</span><br><span class="line">    c = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.d = <span class="keyword">this</span>.b + <span class="keyword">this</span>.c;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> t = <span class="keyword">new</span> Test();</span><br><span class="line"><span class="built_in">console</span>.log(t)</span><br></pre></td></tr></table></figure>
<p> 3). 箭头函数在字段初始化器位置上，指向当前对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">        <span class="keyword">this</span>.a = <span class="number">123</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    print = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.a)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> t1 = <span class="keyword">new</span> Test();</span><br><span class="line"><span class="keyword">const</span> t2 = <span class="keyword">new</span> Test();</span><br><span class="line">t1.print()</span><br><span class="line">t2.print()</span><br><span class="line"><span class="built_in">console</span>.log(t1.print === t2.print)</span><br></pre></td></tr></table></figure>
</li>
<li><p>类表达式<br>类本质上是一个函数,所以也可以写成一个表达式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> A = <span class="class"><span class="keyword">class</span> </span>&#123; <span class="comment">//匿名类，类表达式</span></span><br><span class="line">    a = <span class="number">1</span>;</span><br><span class="line">    b = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> A();</span><br><span class="line"><span class="built_in">console</span>.log(a)</span><br></pre></td></tr></table></figure>
</li>
<li><p>[扩展]装饰器（ES7）(Decorator)<br>装饰器的本质是一个函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    @Obsolete</span><br><span class="line">    print() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"print方法"</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Obsolete</span>(<span class="params">target, methodName, descriptor</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// function Test</span></span><br><span class="line">    <span class="comment">// print</span></span><br><span class="line">    <span class="comment">// &#123; value: function print()&#123;&#125;, ... &#125;</span></span><br><span class="line">    <span class="comment">// console.log(target, methodName, descriptor);</span></span><br><span class="line">    <span class="keyword">const</span> oldFunc = descriptor.value</span><br><span class="line">    descriptor.value = <span class="function"><span class="keyword">function</span> (<span class="params">...args</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.warn(<span class="string">`<span class="subst">$&#123;methodName&#125;</span>方法已过时`</span>);</span><br><span class="line">        oldFunc.apply(<span class="keyword">this</span>, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="类的继承"><a href="#类的继承" class="headerlink" title="类的继承"></a>类的继承</h2><p>如果两个类A和B，如果可以描述为：B 是 A，则，A和B形成继承关系</p>
<p>如果B是A，则：</p>
<ol>
<li>B继承自A</li>
<li>A派生B</li>
<li>B是A的子类</li>
<li>A是B的父类</li>
</ol>
<p>如果A是B的父类，则B会自动拥有A中的所有实例成员。</p>
<p>新的关键字：</p>
<ul>
<li>extends：继承，用于类的定义</li>
<li>super<ul>
<li>直接当作函数调用，表示父类构造函数</li>
<li>如果当作对象使用，则表示父类的原型</li>
</ul>
</li>
</ul>
<p>注意：ES6要求，如果定义了constructor，并且该类是子类，则必须在constructor的第一行手动调用父类的构造函数</p>
<p>如果子类不写constructor，则会有默认的构造器，该构造器需要的参数和父类一致，并且自动调用父类构造器</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(type, name, age, sex) &#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    print() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【种类】：<span class="subst">$&#123;<span class="keyword">this</span>.type&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【名字】：<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【年龄】：<span class="subst">$&#123;<span class="keyword">this</span>.age&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【性别】：<span class="subst">$&#123;<span class="keyword">this</span>.sex&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    jiao()&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"动物怎么叫的？"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(name, age, sex) &#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="string">"犬类"</span>, name, age, sex);</span><br><span class="line">        <span class="comment">// 子类特有的属性</span></span><br><span class="line">        <span class="keyword">this</span>.loves = <span class="string">"吃骨头"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    print()&#123;</span><br><span class="line">        <span class="comment">//调用父类的print</span></span><br><span class="line">        <span class="keyword">super</span>.print();</span><br><span class="line">        <span class="comment">//自己特有的代码</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【爱好】：<span class="subst">$&#123;<span class="keyword">this</span>.loves&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//同名方法，会覆盖父类</span></span><br><span class="line">    jiao()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"旺旺！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>【冷知识】</p>
<ul>
<li><p>用JS制作抽象类</p>
<ul>
<li>抽象类：一般是父类，不能通过该类创建对象<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(type, name, age, sex) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">new</span>.target === Animal) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"你不能直接创建Animal的对象，应该通过子类创建"</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.sex = sex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    print() &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【种类】：<span class="subst">$&#123;<span class="keyword">this</span>.type&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【名字】：<span class="subst">$&#123;<span class="keyword">this</span>.name&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【年龄】：<span class="subst">$&#123;<span class="keyword">this</span>.age&#125;</span>`</span>);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">`【性别】：<span class="subst">$&#123;<span class="keyword">this</span>.sex&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    jiao() &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"动物怎么叫的？"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//只能字类来创建，animal不可以直接创建</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>正常情况下，this的指向，this始终指向具体的类的对象</p>
</li>
</ul>
<h1 id="解构"><a href="#解构" class="headerlink" title="解构"></a>解构</h1><p>使用ES6的一种语法规则，将一个对象或数组的某个属性提取到某个变量中</p>
<p><strong>解构不会对被解构的目标造成任何影响</strong></p>
<h2 id="对象解构"><a href="#对象解构" class="headerlink" title="对象解构"></a>对象解构</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    name:<span class="string">'ge'</span>,</span><br><span class="line">    age:<span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> &#123;name,age&#125;=obj</span><br><span class="line"><span class="keyword">let</span> name,age;</span><br><span class="line">(&#123;name,age&#125;=obj)</span><br></pre></td></tr></table></figure>
<h3 id="在解构中使用默认值"><a href="#在解构中使用默认值" class="headerlink" title="在解构中使用默认值"></a>在解构中使用默认值</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    name:<span class="string">'ge'</span>,</span><br><span class="line">    age:<span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//当没有address的时候用默认值</span></span><br><span class="line"><span class="keyword">let</span> &#123;name,age,address=<span class="string">'北京'</span>&#125;=obj</span><br><span class="line"><span class="built_in">console</span>.log(name,age,address)</span><br></pre></td></tr></table></figure>
<h3 id="非同名属性解构"><a href="#非同名属性解构" class="headerlink" title="非同名属性解构"></a>非同名属性解构</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    name:<span class="string">'ge'</span>,</span><br><span class="line">    age:<span class="number">1</span>,</span><br><span class="line">  	sex:<span class="string">'男'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//声明了name,age,address,gender4个变量,并obj同名属性赋值,sex值赋给gender</span></span><br><span class="line"><span class="keyword">let</span> &#123;name,age,address=<span class="string">'北京'</span>,<span class="attr">sex</span>:gender&#125;=obj</span><br><span class="line"><span class="built_in">console</span>.log(name,age,address,gender)</span><br></pre></td></tr></table></figure>
<h3 id="深层次解构"><a href="#深层次解构" class="headerlink" title="深层次解构"></a>深层次解构</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    name:<span class="string">'ge'</span>,</span><br><span class="line">    age:<span class="number">1</span>,</span><br><span class="line">  	sex:<span class="string">'男'</span>,</span><br><span class="line">  	wife:&#123;</span><br><span class="line">    	wifename:<span class="string">'bea'</span>,</span><br><span class="line">      	wifesex:<span class="string">'女'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> &#123;name,<span class="attr">wife</span>:&#123; wifesex &#125;&#125;=obj;</span><br><span class="line"><span class="built_in">console</span>.log(name,wifesex);</span><br></pre></td></tr></table></figure>
<h3 id="剩余项解构"><a href="#剩余项解构" class="headerlink" title="剩余项解构"></a>剩余项解构</h3><p>只能是最后一项</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj=&#123;</span><br><span class="line">    name:<span class="string">'ge'</span>,</span><br><span class="line">    age:<span class="number">1</span>,</span><br><span class="line">    sex:<span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> &#123;name,...obj2&#125;=obj;</span><br><span class="line"><span class="comment">//obj中name放到name中,其余项组成obj2对象</span></span><br></pre></td></tr></table></figure>
<h2 id="数组解构"><a href="#数组解构" class="headerlink" title="数组解构"></a>数组解构</h2><p>其他用法参考对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr=[<span class="string">"a"</span>,<span class="string">"b"</span>,<span class="string">"c"</span>]</span><br><span class="line"><span class="keyword">const</span> &#123;<span class="number">0</span>:n1,<span class="number">1</span>:n2&#125;=arr;</span><br><span class="line"><span class="built_in">console</span>.log(n1,n2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr=[<span class="string">"a"</span>,<span class="string">"b"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//简便写法</span></span><br><span class="line"><span class="keyword">const</span> [n1,n2]=arr;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> n1,n2;</span><br><span class="line">([n1,n2]=arr);</span><br><span class="line"><span class="built_in">console</span>.log(n1,n2)</span><br><span class="line">(n1,,n2)=arr;</span><br></pre></td></tr></table></figure>
<p><strong>解构实现交换</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>, b=<span class="number">2</span>;</span><br><span class="line">[b,a]=[a,b]</span><br></pre></td></tr></table></figure>
<h2 id="参数解构"><a href="#参数解构" class="headerlink" title="参数解构"></a>参数解构</h2><ol>
<li><p>基本用法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params">&#123;name,age,sex,address:&#123;province,city&#125;&#125;</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`姓名:<span class="subst">$&#123;name&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> User=&#123;</span><br><span class="line">    name:<span class="string">'kevin'</span>,</span><br><span class="line">    age:<span class="number">11</span>,</span><br><span class="line">    sex:<span class="string">'0'</span>,</span><br><span class="line">    address:&#123;</span><br><span class="line">        province:<span class="string">'陕西'</span>,</span><br><span class="line">        city:<span class="string">'西安'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">print(User)</span><br></pre></td></tr></table></figure>
</li>
<li><p>不传参数的处理-参数解构不能从undefined解构,给默认值为{}</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax</span>(<span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    method = <span class="string">'get'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">    url = <span class="string">'/'</span></span></span></span><br><span class="line"><span class="function"><span class="params">&#125; = &#123;&#125;</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(method, url);</span><br><span class="line">&#125;</span><br><span class="line">ajax();</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="符号"><a href="#符号" class="headerlink" title="符号"></a>符号</h1><p>符号是ES6新增的一个数据类型，它通过使用函数 <figure class="highlight plain"><figcaption><span>来创建</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">符号设计的初衷，是为了给对象设置私有属性</span><br><span class="line">私有属性：只能在对象内部使用，外面无法使用</span><br><span class="line"></span><br><span class="line">符号具有以下特点:</span><br><span class="line">- 没有字面量</span><br><span class="line">- 使用 typeof 得到的类型是 symbol</span><br><span class="line">- **每次调用 Symbol 函数得到的符号永远不相等，无论符号名是否相同**</span><br><span class="line">```js</span><br><span class="line">const syb1=Symbol(&quot;abc&quot;);</span><br><span class="line">const syb2 = Symbol(&quot;abc&quot;);</span><br><span class="line"></span><br><span class="line">console.log(syb1,syb2);//Symbol(abc) Symbol(abc)</span><br><span class="line">console.log(typeof(syb1)=== &quot;symbol&quot;,typeof(syb2)===&quot;symbol&quot;)//true,true</span><br><span class="line">console.log(syb1 === syb2)//false</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p>符号可以作为对象的属性名存在，这种属性称之为符号属性</p>
<ul>
<li>开发者可以通过精心的设计，让这些属性无法通过常规方式被外界访问</li>
<li>符号属性是不能枚举的，因此在 for-in 循环中无法读取到符号属性，Object.keys 方法也无法读取到符号属性</li>
<li>Object.getOwnPropertyNames 尽管可以得到所有无法枚举的属性，但是仍然无法读取到符号属性</li>
<li>ES6 新增 Object.getOwnPropertySymbols 方法，可以读取符号<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> syb1 = <span class="built_in">Symbol</span>(<span class="string">"用于对象属性的符号"</span>)</span><br><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">a: <span class="number">1</span>,</span><br><span class="line">b: <span class="number">2</span>,</span><br><span class="line">[syb1]: <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(obj);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> prop <span class="keyword">in</span> obj)&#123;</span><br><span class="line"><span class="built_in">console</span>.log(prop);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.keys(obj));</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.getOwnPropertyNames(obj));</span><br><span class="line"><span class="comment">//得到的是一个符号属性的数组</span></span><br><span class="line"><span class="keyword">const</span> sybs = <span class="built_in">Object</span>.getOwnPropertySymbols(obj);</span><br><span class="line"><span class="built_in">console</span>.log(sybs);</span><br><span class="line"><span class="built_in">console</span>.log(sybs, sybs[<span class="number">0</span>] === syb1)</span><br><span class="line"><span class="comment">//类的方式声明 隐藏成员</span></span><br><span class="line"><span class="keyword">const</span> Hero = <span class="function">(<span class="params">(</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> getRandom = <span class="built_in">Symbol</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> </span>&#123;</span><br><span class="line">        <span class="keyword">constructor</span>(attack, hp, defence) &#123;</span><br><span class="line">            <span class="keyword">this</span>.attack = attack;</span><br><span class="line">            <span class="keyword">this</span>.hp = hp;</span><br><span class="line">            <span class="keyword">this</span>.defence = defence;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        gongji() &#123;</span><br><span class="line">            <span class="comment">//伤害：攻击力*随机数（0.8~1.1)</span></span><br><span class="line">            <span class="keyword">const</span> dmg = <span class="keyword">this</span>.attack * <span class="keyword">this</span>[getRandom](<span class="number">0.8</span>, <span class="number">1.1</span>);</span><br><span class="line">            <span class="built_in">console</span>.log(dmg);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        [getRandom](min, max) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Math</span>.random() * (max - min) + min;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"><span class="keyword">const</span> h = <span class="keyword">new</span> Hero(<span class="number">3</span>, <span class="number">6</span>, <span class="number">3</span>);</span><br><span class="line"><span class="built_in">console</span>.log(h);</span><br><span class="line"><span class="comment">//获取sym符号属性</span></span><br><span class="line"><span class="keyword">const</span> sybs= <span class="built_in">Object</span>.getOwnPropertySymbols(Hero.prototype);</span><br><span class="line"><span class="keyword">const</span> prop=sybs[<span class="number">0</span>];</span><br><span class="line"><span class="built_in">console</span>.log(h[prop](<span class="number">3</span>,<span class="number">5</span>));</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>符号无法被隐式转换，因此不能被用于数学运算、字符串拼接或其他隐式转换的场景，但符号可以显式的转换为字符串，通过 String 构造函数进行转换即可，console.log 之所以可以输出符号，是它在内部进行了显式转换</p>
</li>
</ul>
<h2 id="共享符号"><a href="#共享符号" class="headerlink" title="共享符号"></a>共享符号</h2><p>根据某个符号名称（符号描述）能够得到同一个符号</p>
<ol>
<li><p>基本用法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Symbol.for("符号名/符号描述")  //获取共享符号</span></span><br><span class="line"><span class="keyword">const</span> syb1 = <span class="built_in">Symbol</span>.for(<span class="string">'abc'</span>);</span><br><span class="line"><span class="keyword">const</span> syb2 = <span class="built_in">Symbol</span>.for(<span class="string">'abc'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(syb1 === syb2);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj1=&#123;</span><br><span class="line">    a:<span class="number">1</span>,</span><br><span class="line">    b:<span class="number">2</span>,</span><br><span class="line">    [syb1]:<span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> obj2=&#123;</span><br><span class="line">    a:<span class="number">1</span>,</span><br><span class="line">    b:<span class="number">2</span>,</span><br><span class="line">    [syb1]:<span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj1,obj2);</span><br></pre></td></tr></table></figure>
</li>
<li><p>语法糖</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    a: <span class="number">1</span>,</span><br><span class="line">    b: <span class="number">2</span>,</span><br><span class="line">    [<span class="built_in">Symbol</span>.for(<span class="string">"c"</span>)]: <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(obj[<span class="built_in">Symbol</span>.for(<span class="string">"c"</span>)]);</span><br></pre></td></tr></table></figure>
</li>
<li><p>自己实现一个共享符号</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> SymbolFor = <span class="function">(<span class="params">(</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> global = &#123;&#125;; <span class="comment">//用于记录有哪些共享符号</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(global);</span><br><span class="line">        <span class="keyword">if</span> (!global[name]) &#123;</span><br><span class="line">            global[name] = <span class="built_in">Symbol</span>[name];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(global);</span><br><span class="line">        <span class="keyword">return</span> global[name];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="keyword">const</span> syb1 = SymbolFor(<span class="string">"abc"</span>);</span><br><span class="line"><span class="keyword">const</span> syb2 = SymbolFor(<span class="string">"abc"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(syb1 === syb2);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="知名符号"><a href="#知名符号" class="headerlink" title="知名符号"></a>知名符号</h2><p>知名符号是一些具有特殊含义的共享符号，通过 Symbol 的静态属性得到</p>
<p>ES6 延续了 ES5 的思想：减少魔法，暴露内部实现！</p>
<p><strong>魔法:搞不清楚的实现,不能插手的事情以及一些内部的实现</strong></p>
<p>因此，ES6 用知名符号暴露了某些场景的内部实现</p>
<ol>
<li>Symbol.hasInstance</li>
</ol>
<p>该知名符号影响 instanceof 的判定,<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//以前我们无法改变instanceof的判断结果,现在我们就可以通过hasInstance符号来改变</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">A</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Object</span>.defineProperty(A, <span class="built_in">Symbol</span>.hasInstance, &#123;</span><br><span class="line">    value: <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> obj = <span class="keyword">new</span> A();</span><br><span class="line"><span class="built_in">console</span>.log(obj <span class="keyword">instanceof</span> A);<span class="comment">//返回false</span></span><br><span class="line"><span class="built_in">console</span>.log(A[<span class="built_in">Symbol</span>.hasInstance](obj));</span><br></pre></td></tr></table></figure></p>
<ol start="2">
<li>[扩展] Symbol.isConcatSpreadable</li>
</ol>
<p>该知名符号会影响数组的 concat 方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr=[<span class="number">3</span>];</span><br><span class="line"><span class="keyword">const</span> arr2=[<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>];</span><br><span class="line"></span><br><span class="line">arr2[<span class="built_in">Symbol</span>.isConcatSpreadable] = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result = arr.concat(<span class="number">56</span>,arr2);</span><br><span class="line"><span class="built_in">console</span>.log(result)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>];</span><br><span class="line"><span class="keyword">const</span> obj=&#123;</span><br><span class="line">    <span class="number">0</span>:<span class="number">3</span>,</span><br><span class="line">    <span class="number">1</span>:<span class="number">4</span>,</span><br><span class="line">    length:<span class="number">2</span>,</span><br><span class="line">    [<span class="built_in">Symbol</span>.isConcatSpreadable]:<span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result=arr.concat(<span class="number">2</span>,obj);</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br></pre></td></tr></table></figure>
<ol start="3">
<li>[扩展] Symbol.toPrimitive</li>
</ol>
<p>该知名符号会影响类型转换的结果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Temperature</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(degree) &#123;</span><br><span class="line">        <span class="keyword">this</span>.degree = degree;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [<span class="built_in">Symbol</span>.toPrimitive](type) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(type);</span><br><span class="line">        <span class="keyword">if</span> (type === <span class="string">'default'</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.degree + <span class="string">'摄氏度'</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'number'</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.degree</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">"string"</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.degree + <span class="string">"℃"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> t = <span class="keyword">new</span> Temperature(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(t + <span class="string">"!"</span>); <span class="comment">//先调用默认的转换行为  valueof  在tostring</span></span><br><span class="line"><span class="built_in">console</span>.log(t / <span class="number">2</span>); <span class="comment">//转换为数字</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">String</span>(t)); <span class="comment">//转换为string</span></span><br></pre></td></tr></table></figure>
<ol start="4">
<li>[扩展] Symbol.toStringTag</li>
</ol>
<p>该知名符号会影响 Object.prototype.toString 的返回值</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">    [<span class="built_in">Symbol</span>.toStringTag] = <span class="string">"Person"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> Person();</span><br><span class="line"><span class="keyword">const</span> arr=[<span class="number">3243</span>,<span class="number">432</span>,<span class="number">32</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.apply(p)); <span class="comment">//p.toString()//被重写了</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Object</span>.prototype.toString.apply(arr));<span class="comment">//arr.toString() //被重写了</span></span><br></pre></td></tr></table></figure>
<ol start="5">
<li>其他知名符号</li>
</ol>
<h1 id="异步处理"><a href="#异步处理" class="headerlink" title="异步处理"></a>异步处理</h1><h2 id="回顾-事件循环"><a href="#回顾-事件循环" class="headerlink" title="[回顾]事件循环"></a>[回顾]事件循环</h2><p>JS运行的环境称之为宿主环境。</p>
<p>执行栈：call stack，一个数据结构，用于存放各种函数的执行环境，每一个函数执行之前，它的相关信息会加入到执行栈。函数调用之前，创建执行环境，然后加入到执行栈；函数调用之后，销毁执行环境。</p>
<p>JS引擎永远执行的是执行栈的最顶部。</p>
<p>异步函数：某些函数不会立即执行，需要等到某个时机到达后才会执行，这样的函数称之为异步函数。比如事件处理函数。异步函数的执行时机，会被宿主环境控制。</p>
<p>浏览器宿主环境中包含5个线程：</p>
<ol>
<li>JS引擎：负责执行执行栈的最顶部代码</li>
<li>GUI线程：负责渲染页面 </li>
<li>事件监听线程：负责监听各种事件</li>
<li>计时线程：负责计时</li>
<li>网络线程：负责网络通信</li>
</ol>
<p>当上面的线程发生了某些事请，如果该线程发现，这件事情有处理程序，它会将该处理程序加入一个叫做事件队列的内存。当JS引擎发现，执行栈中已经没有了任何内容后，会将事件队列中的第一个函数加入到执行栈中执行。</p>
<p>JS引擎对事件队列的取出执行方式，以及与宿主环境的配合，称之为事件循环。</p>
<p>事件队列在不同的宿主环境中有所差异，大部分宿主环境会将事件队列进行细分。在浏览器中，事件队列分为两种：</p>
<ul>
<li>宏任务（队列）：macroTask，计时器结束的回调、事件回调、http回调等等绝大部分异步函数进入宏队列</li>
<li>微任务（队列）：MutationObserver，Promise产生的回调进入微队列</li>
</ul>
<blockquote>
<p>MutationObserver用于监听某个DOM对象的变化<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> count = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">const</span> ul = <span class="built_in">document</span>.getElementById(<span class="string">"container"</span>);</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">"btn"</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'添加了一个li'</span>);</span><br><span class="line">    &#125;, <span class="number">0</span>);<span class="comment">//宏队列</span></span><br><span class="line">    <span class="keyword">var</span> li = <span class="built_in">document</span>.createElement(<span class="string">"li"</span>);</span><br><span class="line">    li.innerText = count++;</span><br><span class="line">    ul.appendChild(li);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> MutationObserver(<span class="function"><span class="keyword">function</span> <span class="title">B</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'ul元素发生了变化'</span>);<span class="comment">//微队列</span></span><br><span class="line">&#125;);</span><br><span class="line">observer.observe(ul, &#123;</span><br><span class="line">    attributes: <span class="literal">true</span>,<span class="comment">//监听属性的变化</span></span><br><span class="line">    childList: <span class="literal">true</span>,<span class="comment">//监听子元素的变化</span></span><br><span class="line">    subtree: <span class="literal">true</span> <span class="comment">//监听子树的变化</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p>当执行栈清空时，JS引擎首先会将微任务中的所有任务依次执行结束，如果没有微任务，则执行宏任务。</p>
<h2 id="事件和回调函数的缺陷"><a href="#事件和回调函数的缺陷" class="headerlink" title="事件和回调函数的缺陷"></a>事件和回调函数的缺陷</h2><p>我们习惯于使用传统的回调或事件处理来解决异步问题</p>
<p>事件：某个对象的属性是一个函数，当发生某一件事时，运行该函数</p>
<p>回调：运行某个函数以实现某个功能的时候，传入一个函数作为参数，当发生某件事的时候，会运行该函数。</p>
<p>本质上，事件和回调并没有本质的区别，只是把函数放置的位置不同而已。</p>
<p>一直以来，该模式都运作良好。</p>
<p>直到前端工程越来越复杂…</p>
<p>目前，该模式主要面临以下两个问题：</p>
<ol>
<li>回调地狱：某个异步操作需要等待之前的异步操作完成，无论用回调还是事件，都会陷入不断的嵌套</li>
</ol>
<ul>
<li><p>事件产生回调地狱</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//html</span></span><br><span class="line">&lt;button id=<span class="string">"btn1"</span>&gt;按钮<span class="number">1</span>:给按钮<span class="number">2</span>注册点击事件&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">&lt;button id="btn2"&gt;按钮2:给按钮3注册点击事件&lt;/</span>button&gt;</span><br><span class="line">&lt;button id=<span class="string">"btn3"</span>&gt;按钮<span class="number">3</span>:点击后弹出hello&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/js</span></span><br><span class="line"><span class="regexp">const btn1 = document.getElementById("btn1"),</span></span><br><span class="line"><span class="regexp">      btn2 = document.getElementById("btn2"),</span></span><br><span class="line"><span class="regexp">      btn3 = document.getElementById("btn3");</span></span><br><span class="line"><span class="regexp">    btn1.addEventListener("click", function () &#123;</span></span><br><span class="line"><span class="regexp">    btn2.addEventListener("click", function () &#123;</span></span><br><span class="line"><span class="regexp">        btn3.addEventListener("click", function () &#123;</span></span><br><span class="line"><span class="regexp">            alert('hello');</span></span><br><span class="line"><span class="regexp">        &#125;)</span></span><br><span class="line"><span class="regexp">    &#125;)</span></span><br><span class="line"><span class="regexp">&#125;);</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>回调产生回调地狱</p>
<ul>
<li><p>回调函数在参数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">表白女神,王麻子跟女神表白,如果女神拒绝,则向第二个女神表白,直到所有的女神都拒绝,或有一个女神同意为止</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">biaobai</span>(<span class="params">god, callback</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`王麻子向女神<span class="subst">$&#123;god&#125;</span>发了表白短信`</span>);</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Math</span>.random() &lt; <span class="number">0.1</span>) &#123;</span><br><span class="line">            callback(<span class="literal">true</span>);<span class="comment">//同意</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            callback(<span class="literal">false</span>);<span class="comment">//拒绝</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line">biaobai(<span class="string">'女神1'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (result) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'女神1答应了'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        biaobai(<span class="string">'女神2'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (result) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'女神2答应了'</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                biaobai(<span class="string">"女神3"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">result</span>) </span>&#123;</span><br><span class="line">                    <span class="keyword">if</span> (result) &#123;</span><br><span class="line">                        <span class="built_in">console</span>.log(<span class="string">"女神3答应了"</span>);</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="built_in">console</span>.log(<span class="string">"邓哥表示生无可恋!!"</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>回调函数在对象参数中 ,ajax参考jquery实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">ajax(&#123;</span><br><span class="line">    url: <span class="string">'./data/students.json'</span>,</span><br><span class="line">    success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; data.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (data[i].name === <span class="string">'李华'</span>) &#123;</span><br><span class="line">                <span class="keyword">const</span> cid = data[i].classId;</span><br><span class="line">                ajax(&#123;</span><br><span class="line">                    url: <span class="string">'./data/classes.json'</span>,</span><br><span class="line">                    success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; data.length; i++) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (data[i].id === cid) &#123;</span><br><span class="line">                                <span class="keyword">const</span> tid = data[i].teacherId;</span><br><span class="line">                                ajax(&#123;</span><br><span class="line">                                    url: <span class="string">'./data/teachers.json'</span>,</span><br><span class="line">                                    success: <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                                        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; data.length; i++) &#123;</span><br><span class="line">                                            <span class="keyword">if</span> (data[i].id === tid) &#123;</span><br><span class="line">                                                <span class="built_in">console</span>.log(data[i]);</span><br><span class="line">                                            &#125;</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;)</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<ol start="2">
<li>异步之间的联系：某个异步操作要等待多个异步操作的结果，对这种联系的处理，会让代码的复杂度剧增<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    隔壁老王心中有二十个女神，他决定用更加高效的办法</span></span><br><span class="line"><span class="comment">    他同时给二十个女神表白，如果有女神同意，就拒绝其他的女神</span></span><br><span class="line"><span class="comment">    并且，当所有的女神回复完成后，他要把所有的回复都记录到日志进行分析</span></span><br><span class="line"><span class="comment">    用代码模拟上面的场景</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">biaobai</span>(<span class="params">god, callback</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">`隔壁老王向女神【<span class="subst">$&#123;god&#125;</span>】发出了表白短信`</span>);</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Math</span>.random() &lt; <span class="number">0.05</span>) &#123;</span><br><span class="line">            <span class="comment">//女神同意拉</span></span><br><span class="line">            callback(<span class="literal">true</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            callback(<span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * (<span class="number">3000</span> - <span class="number">1000</span>) + <span class="number">1000</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> agreeGod = <span class="literal">null</span>; <span class="comment">//第一个同意的女神</span></span><br><span class="line"><span class="keyword">const</span> results = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">    biaobai(<span class="string">`女神<span class="subst">$&#123;i&#125;</span>`</span>, result =&gt; &#123;</span><br><span class="line">        results.push(result);</span><br><span class="line">        <span class="keyword">if</span> (result) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`女神<span class="subst">$&#123;i&#125;</span>同意了`</span>)</span><br><span class="line">            <span class="keyword">if</span> (agreeGod) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">`隔壁老王回复女神<span class="subst">$&#123;i&#125;</span>: 滚蛋`</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                agreeGod = <span class="string">`女神<span class="subst">$&#123;i&#125;</span>`</span>;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">`隔壁老王终于找到了真爱`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">`女神<span class="subst">$&#123;i&#125;</span>拒绝了`</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (results.length === <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"日志记录"</span>, results)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="异步处理的通用模型"><a href="#异步处理的通用模型" class="headerlink" title="异步处理的通用模型"></a>异步处理的通用模型</h2><p>ES官方参考了大量的异步场景，总结出了一套异步的通用模型，该模型可以覆盖几乎所有的异步场景，甚至是同步场景。</p>
<p>值得注意的是，为了兼容旧系统，ES6 并不打算抛弃掉过去的做法，只是基于该模型推出一个全新的 API，使用该API，会让异步处理更加的简洁优雅。</p>
<p>理解该 API，最重要的，是理解它的异步模型</p>
<ol>
<li>ES6 将某一件可能发生异步操作的事情，分为两个阶段：<strong>unsettled</strong> 和 <strong>settled</strong></li>
</ol>
<p><img src="/2020/01/05/JavaScript-ES6/2019-10-18-17-28-30.png" alt></p>
<ul>
<li>unsettled： 未决阶段，表示事情还在进行前期的处理，并没有发生通向结果的那件事</li>
<li>settled：已决阶段，事情已经有了一个结果，不管这个结果是好是坏，整件事情无法逆转</li>
</ul>
<p>事情总是从 未决阶段 逐步发展到 已决阶段的。并且，未决阶段拥有控制何时通向已决阶段的能力。</p>
<ol start="2">
<li>ES6将事情划分为三种状态： pending、resolved、rejected</li>
</ol>
<ul>
<li>pending: 挂起，处于未决阶段，则表示这件事情还在挂起（最终的结果还没出来）</li>
<li>resolved：已处理，已决阶段的一种状态，表示整件事情已经出现结果，并是一个可以按照正常逻辑进行下去的结果</li>
<li>rejected：已拒绝，已决阶段的一种状态，表示整件事情已经出现结果，并是一个无法按照正常逻辑进行下去的结果，通常用于表示有一个错误</li>
</ul>
<p>既然未决阶段有权力决定事情的走向，因此，未决阶段可以决定事情最终的状态！</p>
<p>我们将 把事情变为resolved状态的过程叫做：<strong>resolve</strong>，推向该状态时，可能会传递一些数据</p>
<p>我们将 把事情变为rejected状态的过程叫做：<strong>reject</strong>，推向该状态时，同样可能会传递一些数据，通常为错误信息</p>
<p><strong>始终记住，无论是阶段，还是状态，是不可逆的！</strong></p>
<p><img src="/2020/01/05/JavaScript-ES6/2019-10-18-18-10-18.png" alt></p>
<ol start="3">
<li>当事情达到已决阶段后，通常需要进行后续处理，不同的已决状态，决定了不同的后续处理。</li>
</ol>
<ul>
<li>resolved状态：这是一个正常的已决状态，后续处理表示为 thenable</li>
<li>rejected状态：这是一个非正常的已决状态，后续处理表示为 catchable</li>
</ul>
<p>后续处理可能有多个，因此会形成作业队列，这些后续处理会按照顺序，当状态到达后依次执行</p>
<p><img src="/2020/01/05/JavaScript-ES6/2019-10-18-18-10-38.png" alt></p>
<ol start="4">
<li>整件事称之为Promise</li>
</ol>
<p><img src="/2020/01/05/JavaScript-ES6/2019-10-18-18-15-52.png" alt></p>
<p><strong>理解上面的概念，对学习Promise至关重要！</strong></p>
<h2 id="Promise的基本使用"><a href="#Promise的基本使用" class="headerlink" title="Promise的基本使用"></a>Promise的基本使用</h2><ol>
<li>基本语法<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve,reject</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// 未决阶段的处理</span></span><br><span class="line">    <span class="comment">// 通过调用resolve函数将Promise推向已决阶段的resolved状态</span></span><br><span class="line">    <span class="comment">// 通过调用reject函数将Promise推向已决阶段的rejected状态</span></span><br><span class="line">    <span class="comment">// resolve和reject均可以传递最多一个参数，表示推向状态的数据</span></span><br><span class="line">&#125;)</span><br><span class="line">pro.then(<span class="function"><span class="params">data</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//这是thenable函数，如果当前的Promise已经是resolved状态，该函数会立即执行</span></span><br><span class="line">    <span class="comment">//如果当前是未决阶段，则会加入到作业队列，等待到达resolved状态后执行</span></span><br><span class="line">    <span class="comment">//data为状态数据</span></span><br><span class="line">&#125;,err=&gt;&#123;</span><br><span class="line">    <span class="comment">//这是catchable函数，如果当前的Promise已经是rejected状态，该函数会立即执行</span></span><br><span class="line">    <span class="comment">//如果当前是未决阶段，则会加入到作业队列，等待到达rejected状态后执行</span></span><br><span class="line">    <span class="comment">//err为状态数据</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>细节</strong></p>
<ol>
<li>未决阶段的处理函数是同步的，会立即执行</li>
<li><p>thenable和catchable函数是异步的，就算是立即执行，也会加入到事件队列中等待执行，并且，加入的队列是微队列</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'a'</span>);</span><br><span class="line">    resolve(<span class="number">1</span>);</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'b'</span>);</span><br><span class="line">    &#125;, <span class="number">0</span>);<span class="comment">//宏队列</span></span><br><span class="line">&#125;)</span><br><span class="line">pro.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);<span class="comment">//微队列</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"c"</span>);</span><br><span class="line"><span class="comment">//ac1b</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>pro.then可以只添加thenable函数或添加thenable和catchable函数，pro.catch可以单独添加catchable函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一起添加</span></span><br><span class="line">ajax(&#123;</span><br><span class="line">    url: <span class="string">'./data/students.json?name=李华'</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(resp)</span><br><span class="line">&#125;, err =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//单独添加</span></span><br><span class="line">pro.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;)</span><br><span class="line">pro.catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>在未决阶段的处理函数中，如果发生<strong>未捕获</strong>的错误，会将状态推向rejected，并会被catchable捕获</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//未捕获的错误 </span></span><br><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//pro rejected</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'123'</span>);</span><br><span class="line">&#125;)</span><br><span class="line">pro.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;)</span><br><span class="line">pro.catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//捕获的错误</span></span><br><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//pro resolve</span></span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'123'</span>);</span><br><span class="line">    &#125;<span class="keyword">catch</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    resolve(<span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line">pro.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;)</span><br><span class="line">pro.catch(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>一旦状态推向了已决阶段，无法再对状态做任何更改</p>
</li>
<li><strong>Promise并没有消除回调，只是让回调变得可控</strong></li>
</ol>
<h2 id="Promise的串联"><a href="#Promise的串联" class="headerlink" title="Promise的串联"></a>Promise的串联</h2><p>当后续的Promise需要用到之前的Promise的处理结果时，需要Promise的串联</p>
<p>Promise对象中，无论是then方法还是catch方法，它们都具有返回值，返回的是一个全新的Promise对象，它的状态满足下面的规则：</p>
<ol>
<li>如果当前的Promise是未决的，得到的新的Promise是挂起状态</li>
<li>如果当前的Promise是已决的，会运行响应的后续处理函数，并将后续处理函数的结果（返回值）作为resolved状态数据，应用到新的Promise中；如果后续处理函数发生错误，则把返回值作为rejected状态数据，应用到新的Promise中。</li>
</ol>
<p><strong>后续的Promise一定会等到前面的Promise有了后续处理结果后，才会变成已决状态</strong></p>
<p>如果前面的Promise的后续处理，返回的是一个Promise，则返回的新的Promise状态和后续处理返回的Promise状态保持一致。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = ajax(&#123;</span><br><span class="line">    url: <span class="string">"./data/students.json"</span></span><br><span class="line">&#125;)</span><br><span class="line">pro.then(<span class="function"><span class="params">resp</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; resp.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (resp[i].name === <span class="string">"李华"</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> resp[i].classId; <span class="comment">//班级id</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).then(<span class="function"><span class="params">cid</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ajax(&#123;</span><br><span class="line">        url: <span class="string">"./data/classes.json?cid="</span> + cid</span><br><span class="line">    &#125;).then(<span class="function"><span class="params">cls</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; cls.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (cls[i].id === cid) &#123;</span><br><span class="line">                <span class="keyword">return</span> cls[i].teacherId;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">tid</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ajax(&#123;</span><br><span class="line">        url: <span class="string">"./data/teachers.json"</span></span><br><span class="line">    &#125;).then(<span class="function"><span class="params">ts</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; ts.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (ts[i].id === tid) &#123;</span><br><span class="line">                <span class="keyword">return</span> ts[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">teacher</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(teacher);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="Promise的其他api"><a href="#Promise的其他api" class="headerlink" title="Promise的其他api"></a>Promise的其他api</h2><h3 id="原型成员-实例成员"><a href="#原型成员-实例成员" class="headerlink" title="原型成员 (实例成员)"></a>原型成员 (实例成员)</h3><ul>
<li>then：注册一个后续处理函数，当Promise为resolved状态时运行该函数</li>
<li>catch：注册一个后续处理函数，当Promise为rejected状态时运行该函数</li>
<li>finally：[ES2018]注册一个后续处理函数（无参），当Promise为已决时运行该函数</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pro = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    reject(<span class="number">1</span>);</span><br><span class="line">&#125;);</span><br><span class="line">pro.finally(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"finally1"</span>))</span><br><span class="line">pro.finally(<span class="function"><span class="params">()</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"finally2"</span>))</span><br><span class="line">pro.then(<span class="function"><span class="params">resp</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"then1"</span>, resp * <span class="number">1</span>));</span><br><span class="line">pro.then(<span class="function"><span class="params">resp</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"then2"</span>, resp * <span class="number">2</span>));</span><br><span class="line">pro.catch(<span class="function"><span class="params">resp</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"catch1"</span>, resp * <span class="number">1</span>));</span><br><span class="line">pro.catch(<span class="function"><span class="params">resp</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="string">"catch2"</span>, resp * <span class="number">2</span>));</span><br></pre></td></tr></table></figure>
<h3 id="构造函数成员-（静态成员）"><a href="#构造函数成员-（静态成员）" class="headerlink" title="构造函数成员 （静态成员）"></a>构造函数成员 （静态成员）</h3><ul>
<li>resolve(数据)：该方法返回一个resolved状态的Promise，传递的数据作为状态数据<ul>
<li>特殊情况：如果传递的数据是Promise，则直接返回传递的Promise对象  </li>
</ul>
</li>
<li><p>reject(数据)：该方法返回一个rejected状态的Promise，传递的数据作为状态数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// const pro = new Promise((resolve, reject) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     resolve(1);</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">//等效于：</span></span><br><span class="line"><span class="comment">// const pro = Promise.resolve(1);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// const pro = new Promise((resolve, reject) =&gt; &#123;</span></span><br><span class="line"><span class="comment">//     reject(1);</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"><span class="comment">//等效于：</span></span><br><span class="line"><span class="comment">// const pro = Promise.reject(1);</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> p = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    resolve(<span class="number">3</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> pro = <span class="built_in">Promise</span>.resolve(p);</span><br><span class="line"><span class="comment">//等效于</span></span><br><span class="line"><span class="comment">//const pro = p;</span></span><br><span class="line"><span class="built_in">console</span>.log(pro === p)</span><br></pre></td></tr></table></figure>
</li>
<li><p>all(iterable)：这个方法返回一个新的promise对象，该promise对象在iterable参数对象里所有的promise对象都成功的时候才会触发成功，一旦有任何一个iterable里面的promise对象失败则立即触发该promise对象的失败。这个新的promise对象在触发成功状态以后，会把一个包含iterable里所有promise返回值的数组作为成功回调的返回值，顺序跟iterable的顺序保持一致；如果这个新的promise对象触发了失败状态，它会把iterable里第一个触发失败的promise对象的错误信息作为它的失败错误信息。Promise.all方法常被用于处理多个promise对象的状态集合。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandom</span>(<span class="params">min, max</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * (max - min) + min);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> proms = [];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">    proms.push(<span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">Math</span>.random() &lt; <span class="number">0.5</span>) &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(i, <span class="string">'完成'</span>);</span><br><span class="line">                resolve(i);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">console</span>.log(i, <span class="string">'失败'</span>)</span><br><span class="line">                reject(i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, getRandom(<span class="number">1000</span>, <span class="number">5000</span>));</span><br><span class="line">    &#125;))</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> pro = <span class="built_in">Promise</span>.all(proms);</span><br><span class="line">pro.then(<span class="function"><span class="params">datas</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'有人完成了'</span>, datas);</span><br><span class="line">&#125;)</span><br><span class="line">pro.catch(<span class="function"><span class="params">datas</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'有人失败了'</span>, datas);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>race(iterable)：当iterable参数里的任意一个子promise被成功或失败后，父promise马上也会用子promise的成功返回值或失败详情作为参数调用父promise绑定的相应句柄，并返回该promise对象</p>
</li>
</ul>
<h2 id="手写Promise"><a href="#手写Promise" class="headerlink" title="手写Promise"></a>手写Promise</h2><p>我们通过引入<code>MyPromise.js</code>来加载,通过<code>new MyPromise((reslove,reject)=&gt;{})</code>调用,下面分以下几步实现最终Promise的效果.</p>
<ol>
<li><p>状态改变的实现</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> MyPromise = <span class="function">(<span class="params">(</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> MyPromiseStatus = <span class="built_in">Symbol</span>(<span class="string">"MyPromiseStatus"</span>);</span><br><span class="line">    <span class="comment">//当前Promise状态</span></span><br><span class="line">    <span class="keyword">const</span> MyPromiseValue = <span class="built_in">Symbol</span>(<span class="string">"MyPromiseValue"</span>);</span><br><span class="line">    <span class="comment">//当前Promise传递的后续值</span></span><br><span class="line">    <span class="keyword">const</span> changeStatus = <span class="built_in">Symbol</span>(<span class="string">"changeStatus"</span>);</span><br><span class="line">    <span class="comment">//改变状态函数</span></span><br><span class="line">    <span class="keyword">const</span> PENDING = <span class="string">"pending"</span>;</span><br><span class="line">    <span class="comment">//挂起状态</span></span><br><span class="line">    <span class="keyword">const</span> RESOLVED = <span class="string">"resolved"</span>;</span><br><span class="line">    <span class="comment">//reslved状态</span></span><br><span class="line">    <span class="keyword">const</span> REJECTED = <span class="string">"rejected"</span>;</span><br><span class="line">    <span class="comment">//REJECTED状态        </span></span><br><span class="line">    <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">MyPromise</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 构造函数</span></span><br><span class="line"><span class="comment">         * @param &#123;*&#125; 实例化MyPromise的时候立刻执行的函数 </span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        [changeStatus](newstatus, data) &#123;</span><br><span class="line">            <span class="comment">//状态不可逆 防止resolve之后在调用rejecte或reject之后在调用resolve</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>[MyPromiseStatus] !== PENDING) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>[MyPromiseStatus] = newstatus;</span><br><span class="line">            <span class="keyword">this</span>[MyPromiseValue] = data;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">constructor</span>(handler) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> (handler) !== <span class="string">"function"</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"MyPromise params must be Function!"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>[MyPromiseStatus] = PENDING;</span><br><span class="line">            <span class="keyword">this</span>[MyPromiseValue] = <span class="literal">undefined</span>;</span><br><span class="line">            <span class="keyword">let</span> resolve = <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>[changeStatus](RESOLVED, data);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> reject = <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>[changeStatus](REJECTED, err);</span><br><span class="line">            &#125;</span><br><span class="line">            handler(resolve, reject);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
</li>
<li><p>后续处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//后续处理</span></span><br><span class="line"><span class="keyword">const</span> MyPromise = <span class="function">(<span class="params">(</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//......</span></span><br><span class="line">    <span class="comment">//REJECTED状态</span></span><br><span class="line">    <span class="keyword">const</span> thenables = <span class="built_in">Symbol</span>[<span class="string">"thenables"</span>];</span><br><span class="line">    <span class="comment">//resolved后续处理的队列</span></span><br><span class="line">    <span class="keyword">const</span> catchables = <span class="built_in">Symbol</span>(<span class="string">"catchables"</span>);</span><br><span class="line">    <span class="comment">//rejected后续处理的队列       </span></span><br><span class="line">    <span class="keyword">return</span> <span class="class"><span class="keyword">class</span> <span class="title">MyPromise</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 构造函数</span></span><br><span class="line"><span class="comment">         * @param &#123;*&#125; 实例化MyPromise的时候立刻执行的函数 </span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        [changeStatus](newstatus, data, queue) &#123;</span><br><span class="line">            <span class="comment">//状态不可逆 防止resolve之后在调用rejecte或reject之后在调用resolve</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>[MyPromiseStatus] !== PENDING) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>[MyPromiseStatus] = newstatus;</span><br><span class="line">            <span class="keyword">this</span>[MyPromiseValue] = data;</span><br><span class="line">            queue.forEach(<span class="function"><span class="params">handler</span> =&gt;</span> handler(data))</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">constructor</span>(handler) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> (handler) !== <span class="string">"function"</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"MyPromise params must be Function!"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>[MyPromiseStatus] = PENDING;</span><br><span class="line">            <span class="keyword">this</span>[MyPromiseValue] = <span class="literal">undefined</span>;</span><br><span class="line">            <span class="keyword">this</span>[thenables] = [];</span><br><span class="line">            <span class="keyword">this</span>[catchables] = [];</span><br><span class="line">            <span class="keyword">let</span> resolve = <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>[changeStatus](RESOLVED, data, <span class="keyword">this</span>[thenables]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">let</span> reject = <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>[changeStatus](REJECTED, err, <span class="keyword">this</span>[catchables]);</span><br><span class="line">            &#125;</span><br><span class="line">            handler(resolve, reject);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        then(thenable, catchable) &#123;</span><br><span class="line">            <span class="comment">//如果同步函数立即执行</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>[MyPromiseStatus] === RESOLVED) &#123;</span><br><span class="line">                <span class="comment">//此处仿造Promise的进入为队列</span></span><br><span class="line">                setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                    thenable(<span class="keyword">this</span>[MyPromiseValue]);</span><br><span class="line">                &#125;, <span class="number">0</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>[thenables].push(thenable);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">this</span>.catch(catchable);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">catch</span> (catchable) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> (catchable) !== <span class="string">"function"</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//如果同步函数立即执行</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>[MyPromiseStatus] === REJECTED) &#123;</span><br><span class="line">                <span class="comment">//此处仿造Promise的进入为队列</span></span><br><span class="line">                setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">                    catchable(<span class="keyword">this</span>[MyPromiseValue]);</span><br><span class="line">                &#125;, <span class="number">0</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>[catchables].push(catchable);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br></pre></td></tr></table></figure>
</li>
<li><p>后续代码提取处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">const</span> settleHandler = <span class="built_in">Symbol</span>(<span class="string">"settleHandler"</span>);</span><br><span class="line"><span class="comment">//后续处理函数提取</span></span><br><span class="line">[settleHandler](handler, immediatelyStatus, queue) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> (handler) !== <span class="string">"function"</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>[MyPromiseStatus] === immediatelyStatus) &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            handler(<span class="keyword">this</span>[MyPromiseValue]);</span><br><span class="line">        &#125;, <span class="number">0</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        queue.push(handler);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">then(thenable, catchable) &#123;</span><br><span class="line">    <span class="keyword">this</span>[settleHandler](thenable, RESOLVED, <span class="keyword">this</span>[thenables]);</span><br><span class="line">    <span class="keyword">this</span>.catch(catchable);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">catch</span> (catchable) &#123;</span><br><span class="line">    <span class="keyword">this</span>[settleHandler](catchable, REJECTED, <span class="keyword">this</span>[catchables]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Promise串联(链式编程)</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//...</span></span><br><span class="line"><span class="keyword">const</span> linkPromise = <span class="built_in">Symbol</span>(<span class="string">"linkPromise"</span>);</span><br><span class="line">[linkPromise](thenable, catchable) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>[settleHandler](<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> result = thenable(data);</span><br><span class="line">                resolve(result);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">                reject(err)</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;, RESOLVED, <span class="keyword">this</span>[thenables])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>[settleHandler](<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> result = catchable(err);</span><br><span class="line">                resolve(result);</span><br><span class="line">            &#125;<span class="keyword">catch</span>(err)&#123;</span><br><span class="line">                reject(err);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;, REJECTED, <span class="keyword">this</span>[catchables])</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">then(thenable, catchable) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>[linkPromise](thenable, catchable);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">catch</span> (catchable) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>[linkPromise](<span class="literal">undefined</span>, catchable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Promise串联优化和提取</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[linkPromise](thenable, catchable) &#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">exec</span>(<span class="params">data, handler, resolve, reject</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> result = handler(data);</span><br><span class="line">            <span class="keyword">if</span> (result <span class="keyword">instanceof</span> MyPromise) &#123;</span><br><span class="line">                result.then(<span class="function"><span class="params">d</span> =&gt;</span> &#123;</span><br><span class="line">                    resolve(d)</span><br><span class="line">                &#125;, err =&gt; &#123;</span><br><span class="line">                    reject(err);</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                resolve(result);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">            reject(err);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> MyPromise(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>[settleHandler](<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">            exec(data, thenable, resolve, reject);</span><br><span class="line"></span><br><span class="line">        &#125;, RESOLVED, <span class="keyword">this</span>[thenables])</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>[settleHandler](<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">            exec(err, catchable, resolve, reject);</span><br><span class="line"></span><br><span class="line">        &#125;, REJECTED, <span class="keyword">this</span>[catchables])</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="async-和-await"><a href="#async-和-await" class="headerlink" title="async 和 await"></a>async 和 await</h1><p>async 和 await 是 ES2016 新增两个关键字，它们借鉴了 ES2015 中生成器在实际开发中的应用，目的是简化 Promise api 的使用，并非是替代 Promise。</p>
<h2 id="async"><a href="#async" class="headerlink" title="async"></a>async</h2><p>目的是简化在函数的返回值中对Promise的创建</p>
<p>async 用于修饰函数（无论是函数字面量还是函数表达式），放置在函数最开始的位置，被修饰函数的返回结果一定是 Promise 对象。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//等效于</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">        resolve(<span class="number">2</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="awaits"><a href="#awaits" class="headerlink" title="awaits"></a>awaits</h2><p><strong>await关键字必须出现在async函数中！！！！</strong></p>
<p>await用在某个表达式之前，如果表达式是一个Promise，则得到的是thenable中的状态数据。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">test2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> test1();</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test2();</span><br></pre></td></tr></table></figure>
<p>等效于</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test1</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">        resolve(<span class="number">2</span>);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test2</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>)=&gt;</span>&#123;</span><br><span class="line">        test1().then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> result = data;</span><br><span class="line">            <span class="built_in">console</span>.log(result);</span><br><span class="line">            resolve();</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">test2();</span><br></pre></td></tr></table></figure>
<h2 id="示例demo"><a href="#示例demo" class="headerlink" title="示例demo"></a>示例demo</h2><ol>
<li>前面的获取老师信息改写<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getTeacher</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> stus = <span class="keyword">await</span> ajax(&#123;</span><br><span class="line">        url: <span class="string">"./data/students.json"</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> cid;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; stus.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (stus[i].name === <span class="string">"李华"</span>) &#123;</span><br><span class="line">            cid = stus[i].classId;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> cls = <span class="keyword">await</span> ajax(&#123;</span><br><span class="line">        url: <span class="string">"./data/classes.json"</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">let</span> tid;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; cls.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cls[i].id === cid) &#123;</span><br><span class="line">            tid = cls[i].teacherId;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> ts = <span class="keyword">await</span> ajax(&#123;</span><br><span class="line">        url: <span class="string">"./data/teachers.json"</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; ts.length; i++) &#123;</span><br><span class="line">        <span class="keyword">const</span> element = ts[i];</span><br><span class="line">        <span class="keyword">if</span> (element.id === tid) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(element);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">getTeacher();</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h1 id="FetchApi"><a href="#FetchApi" class="headerlink" title="FetchApi"></a>FetchApi</h1><h2 id="Fetch-Api-概述"><a href="#Fetch-Api-概述" class="headerlink" title="Fetch Api 概述"></a>Fetch Api 概述</h2><p><strong>XMLHttpRequest的问题</strong></p>
<ol>
<li>所有的功能全部集中在同一个对象上，容易书写出混乱不易维护的代码</li>
<li>采用传统的事件驱动模式，无法适配新的 Promise Api</li>
</ol>
<p><strong>Fetch Api 的特点</strong></p>
<ol>
<li>并非取代 AJAX，而是对 AJAX 传统 API 的改进</li>
<li>精细的功能分割：头部信息、请求信息、响应信息等均分布到不同的对象，更利于处理各种复杂的 AJAX 场景</li>
<li>使用 Promise Api，更利于异步代码的书写</li>
<li>Fetch Api 并非 ES6 的内容，属于 HTML5 新增的 Web Api</li>
<li>需要掌握网络通信的知识</li>
</ol>
<h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><p>使用 <figure class="highlight plain"><figcaption><span>函数即可立即向服务器发送网络请求</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">```js</span><br><span class="line">async function getProvinces() &#123;</span><br><span class="line">    const url = &apos;xxxxx&apos;;</span><br><span class="line">    const resp = await fetch(url);</span><br><span class="line">    const result = await resp.json();</span><br><span class="line">    console.log(result);</span><br><span class="line">&#125;</span><br><span class="line">getProvinces();</span><br></pre></td></tr></table></figure></p>
<h3 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h3><p>该函数有两个参数：</p>
<ol>
<li>必填，字符串，请求地址</li>
<li>选填，对象，请求配置</li>
</ol>
<p><strong>请求配置对象</strong></p>
<ul>
<li>method：字符串，请求方法，默认值GET</li>
<li>headers：对象，请求头信息</li>
<li>body: 请求体的内容，必须匹配请求头中的 Content-Type</li>
<li>mode：字符串，请求模式<ul>
<li>cors：默认值，配置为该值，会在请求头中加入 origin 和 referer</li>
<li>no-cors：配置为该值，不会在请求头中加入 origin 和 referer，跨域的时候可能会出现问题</li>
<li>same-origin：指示请求必须在同一个域中发生，如果请求其他域，则会报错</li>
</ul>
</li>
<li>credentials: 如何携带凭据（cookie）<ul>
<li>omit：默认值，不携带cookie</li>
<li>same-origin：请求同源地址时携带cookie</li>
<li>include：请求任何地址都携带cookie</li>
</ul>
</li>
<li>cache：配置缓存模式<ul>
<li>default: 表示fetch请求之前将检查下http的缓存.</li>
<li>no-store: 表示fetch请求将完全忽略http缓存的存在. 这意味着请求之前将不再检查下http的缓存, 拿到响应后, 它也不会更新http缓存.</li>
<li>no-cache: 如果存在缓存, 那么fetch将发送一个条件查询request和一个正常的request, 拿到响应后, 它会更新http缓存.</li>
<li>reload: 表示fetch请求之前将忽略http缓存的存在, 但是请求拿到响应后, 它将主动更新http缓存.</li>
<li>force-cache: 表示fetch请求不顾一切的依赖缓存, 即使缓存过期了, 它依然从缓存中读取. 除非没有任何缓存, 那么它将发送一个正常的request.</li>
<li>only-if-cached: 表示fetch请求不顾一切的依赖缓存, 即使缓存过期了, 它依然从缓存中读取. 如果没有缓存, 它将抛出网络错误(该设置只在mode为”same-origin”时有效).</li>
</ul>
</li>
</ul>
<h3 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h3><p>fetch 函数返回一个 Promise 对象</p>
<ul>
<li>当收到服务器的返回结果后，Promise 进入resolved状态，状态数据为 Response 对象</li>
<li>当网络发生错误（或其他导致无法完成交互的错误）时，Promise 进入 rejected 状态，状态数据为错误信息</li>
</ul>
<p><strong>Response对象</strong></p>
<ul>
<li>ok：boolean，当响应消息码在200~299之间时为true，其他为false</li>
<li>status：number，响应的状态码</li>
<li>text()：用于处理文本格式的 Ajax 响应。它从响应中获取文本流，将其读完，然后返回一个被解决为 string 对象的 Promise。</li>
<li>blob()：用于处理二进制文件格式（比如图片或者电子表格）的 Ajax 响应。它读取文件的原始数据，一旦读取完整个文件，就返回一个被解决为 blob 对象的 Promise。</li>
<li>json()：用于处理 JSON 格式的 Ajax 的响应。它将 JSON 数据流转换为一个被解决为 JavaScript 对象的promise。</li>
<li>redirect()：可以用于重定向到另一个 URL。它会创建一个新的 Promise，以解决来自重定向的 URL 的响应。</li>
</ul>
<h2 id="Request对象"><a href="#Request对象" class="headerlink" title="Request对象"></a>Request对象</h2><p>除了使用基本的fetch方法，还可以通过创建一个Request对象来完成请求（实际上，fetch的内部会帮你创建一个Request对象）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> Request(url地址, 配置)</span><br></pre></td></tr></table></figure>
<p>注意点：</p>
<p>尽量保证每次请求都是一个新的Request对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> req;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">GetRequestInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!req)&#123;</span><br><span class="line">        <span class="keyword">const</span> url=<span class="string">'xxxx'</span>;</span><br><span class="line">        req = <span class="keyword">new</span> Request(url,&#123;&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> req.clone();</span><br><span class="line">&#125;    </span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">GetProvinces</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> resp=<span class="keyword">await</span> fetch(GetRequestInfo());</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> resp.json();</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;</span><br><span class="line">GetProvinces();</span><br></pre></td></tr></table></figure>
<h2 id="Response对象"><a href="#Response对象" class="headerlink" title="Response对象"></a>Response对象</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> resp = <span class="keyword">new</span> Response(<span class="string">`[</span></span><br><span class="line"><span class="string">    &#123;"id":1, "name":"北京"&#125;,</span></span><br><span class="line"><span class="string">    &#123;"id":2, "name":"天津"&#125;</span></span><br><span class="line"><span class="string">]`</span>, &#123;</span><br><span class="line">    ok: <span class="literal">true</span>,</span><br><span class="line">    status: <span class="number">200</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> data = <span class="keyword">await</span> resp.json();</span><br><span class="line"><span class="built_in">console</span>.log(data);</span><br></pre></td></tr></table></figure>
<h2 id="Headers-对象"><a href="#Headers-对象" class="headerlink" title="Headers 对象"></a>Headers 对象</h2><p>在Request和Response对象内部，会将传递的请求头对象，转换为Headers</p>
<p>Headers对象中的方法：</p>
<ul>
<li>has(key)：检查请求头中是否存在指定的key值</li>
<li>get(key): 得到请求头中对应的key值</li>
<li>set(key, value)：修改对应的键值对</li>
<li>append(key, value)：添加对应的键值对</li>
<li>keys(): 得到所有的请求头键的集合</li>
<li>values(): 得到所有的请求头中的值的集合</li>
<li>entries(): 得到所有请求头中的键值对的集合</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> req;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getColumnHeaders</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Headers(&#123;</span><br><span class="line">        a:<span class="number">1</span>,</span><br><span class="line">        b:<span class="number">2</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRequestInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!req)&#123;</span><br><span class="line">        <span class="keyword">const</span> url = <span class="string">"http://101.132.72.36:5100/api/local"</span>;</span><br><span class="line">        <span class="keyword">const</span> headers = getColumnHeaders();</span><br><span class="line">        req = <span class="keyword">new</span> Request(url,&#123;</span><br><span class="line">            headers</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> req.clone();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getProvinces</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> resp = <span class="keyword">await</span> fetch(getRequestInfo());</span><br><span class="line">    <span class="keyword">const</span> data = <span class="keyword">await</span> resp.json();</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;</span><br><span class="line">getProvinces();</span><br></pre></td></tr></table></figure>
<h2 id="示例文件上传"><a href="#示例文件上传" class="headerlink" title="示例文件上传"></a>示例文件上传</h2><p>流程：</p>
<ol>
<li>客户端将文件数据发送给服务器</li>
<li>服务器保存上传的文件数据到服务器端</li>
<li>服务器响应给客户端一个文件访问地址</li>
</ol>
<p>请求方法：POST<br>请求的表单格式：multipart/form-data<br>请求体中必须包含一个键值对，键的名称是服务器要求的名称，值是文件数据</p>
<blockquote>
<p>HTML5中，JS仍然无法随意的获取文件数据，但是可以获取到input元素中，被用户选中的文件数据<br>可以利用HTML5提供的FormData构造函数来创建请求体</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> inp = <span class="built_in">document</span>.getElementById(<span class="string">"avatar"</span>);</span><br><span class="line">    <span class="keyword">if</span> (inp.files.length === <span class="number">0</span>) &#123;</span><br><span class="line">        alert(<span class="string">"请选择要上传的文件"</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> formData = <span class="keyword">new</span> FormData();</span><br><span class="line">    formData.append(<span class="string">"imagefile"</span>, inp.files[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">const</span> url = <span class="string">"http://101.132.72.36:5100/api/upload"</span>;</span><br><span class="line">    <span class="keyword">const</span> resp = <span class="keyword">await</span> fetch(url, &#123;</span><br><span class="line">        method: <span class="string">"post"</span>,</span><br><span class="line">        body: formData</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> resp.json();</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">"button"</span>).onclick = <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">await</span> upload();</span><br><span class="line">    <span class="keyword">const</span> img = <span class="built_in">document</span>.getElementById(<span class="string">"imgAvatar"</span>)</span><br><span class="line">    img.src = result.path;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="迭代器和生成器"><a href="#迭代器和生成器" class="headerlink" title="迭代器和生成器"></a>迭代器和生成器</h1><h2 id="迭代器"><a href="#迭代器" class="headerlink" title="迭代器"></a>迭代器</h2><ol>
<li>什么是迭代？</li>
</ol>
<p>从一个数据集合中按照一定的顺序，不断取出数据的过程</p>
<ol start="2">
<li>迭代和遍历的区别？</li>
</ol>
<p>迭代强调的是依次取数据，并不保证取多少，也不保证把所有的数据取完</p>
<p>遍历强调的是要把整个数据依次全部取出</p>
<ol start="3">
<li>迭代器</li>
</ol>
<p>对迭代过程的封装，在不同的语言中有不同的表现形式，通常为对象</p>
<ol start="4">
<li>迭代模式</li>
</ol>
<p>一种设计模式，用于统一迭代过程，并规范了迭代器规格：</p>
<ul>
<li>迭代器应该具有得到下一个数据的能力</li>
<li>迭代器应该具有判断是否还有后续数据的能力</li>
</ul>
<h2 id="JS中的迭代器"><a href="#JS中的迭代器" class="headerlink" title="JS中的迭代器"></a>JS中的迭代器</h2><p>JS规定，如果一个对象具有next方法，并且该方法返回一个对象，该对象的格式如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">value</span>: 值, <span class="attr">done</span>: 是否迭代完成&#125;</span><br></pre></td></tr></table></figure></p>
<p>则认为该对象是一个迭代器</p>
<p>含义：</p>
<ul>
<li>next方法：用于得到下一个数据</li>
<li>返回的对象<ul>
<li>value：下一个数据的值</li>
<li>done：boolean，是否迭代完成</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//斐波拉且数列</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFeiBoIterator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> prev1 = <span class="number">1</span>,</span><br><span class="line">        prev2 = <span class="number">2</span>,<span class="comment">//当前位置的前1位和前2位</span></span><br><span class="line">        n = <span class="number">1</span>;<span class="comment">//当前是第几位</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        next() &#123;</span><br><span class="line">            <span class="keyword">let</span> value;</span><br><span class="line">            <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">                value = <span class="number">1</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                value = prev1 + prev2;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">const</span> result = &#123;</span><br><span class="line">                value,</span><br><span class="line">                done: <span class="literal">false</span></span><br><span class="line">            &#125;;</span><br><span class="line">            prev2 = prev1;</span><br><span class="line">            prev1 = result.value;</span><br><span class="line">            n++;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> iterator = createFeiBoIterator();</span><br></pre></td></tr></table></figure>
<h2 id="可迭代协议与for-of循环"><a href="#可迭代协议与for-of循环" class="headerlink" title="可迭代协议与for-of循环"></a>可迭代协议与for-of循环</h2><h3 id="可迭代协议"><a href="#可迭代协议" class="headerlink" title="可迭代协议"></a>可迭代协议</h3><p><strong>概念回顾</strong></p>
<ul>
<li>迭代器(iterator)：一个具有next方法的对象，next方法返回下一个数据并且能指示是否迭代完成</li>
<li>迭代器创建函数（iterator creator）：一个返回迭代器的函数</li>
</ul>
<p><strong>可迭代协议</strong></p>
<p>ES6规定，如果一个对象具有知名符号属性<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; 思考：如何知晓一个对象是否是可迭代的？</span><br><span class="line">&gt; 思考：如何遍历一个可迭代对象？</span><br><span class="line"></span><br><span class="line">**数组和NodeList(dom对象集合)本身也是可迭代对象**</span><br><span class="line"></span><br><span class="line">### for-of 循环</span><br><span class="line"></span><br><span class="line">for-of 循环用于遍历可迭代对象，格式如下</span><br><span class="line"></span><br><span class="line">```js</span><br><span class="line">//迭代完成后循环结束</span><br><span class="line">for(const item in iterable)&#123;</span><br><span class="line">    //iterable：可迭代对象</span><br><span class="line">    //item：每次迭代得到的数据</span><br><span class="line">&#125;</span><br><span class="line">var obj = &#123;</span><br><span class="line">    a: 1,</span><br><span class="line">    b: 2,</span><br><span class="line">    [Symbol.iterator]() &#123;</span><br><span class="line">        const keys = Object.keys(this);</span><br><span class="line">        let i = 0;</span><br><span class="line">        return &#123;</span><br><span class="line">            next: () =&gt; &#123;</span><br><span class="line">                const propName = keys[i];</span><br><span class="line">                const propValue = this[propName];</span><br><span class="line">                const result = &#123;</span><br><span class="line">                    value: &#123;</span><br><span class="line">                        propName,</span><br><span class="line">                        propValue</span><br><span class="line">                    &#125;,</span><br><span class="line">                    done: i &gt;= keys.length</span><br><span class="line">                &#125;</span><br><span class="line">                i++;</span><br><span class="line">                return result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">for (const item of obj) &#123;</span><br><span class="line">    console.log(item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="展开运算符与可迭代对象"><a href="#展开运算符与可迭代对象" class="headerlink" title="展开运算符与可迭代对象"></a>展开运算符与可迭代对象</h3><p>展开运算符可以作用于可迭代对象，这样，就可以轻松的将可迭代对象转换为数组。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr = [<span class="number">5</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">const</span> arr1 = [...arr];</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params">...p</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(p);</span><br><span class="line">&#125;</span><br><span class="line">test(...arr)</span><br></pre></td></tr></table></figure>
<h2 id="生成器"><a href="#生成器" class="headerlink" title="生成器"></a>生成器</h2><ol>
<li>什么是生成器？</li>
</ol>
<p>生成器是一个通过构造函数Generator(js内部引擎调用)创建的对象，生成器既是一个迭代器，同时又是一个可迭代对象</p>
<ol start="2">
<li>如何创建生成器？</li>
</ol>
<p>生成器的创建，必须使用生成器函数（Generator Function）</p>
<ol start="3">
<li>如何书写一个生成器函数呢？</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这是一个生成器函数，该函数一定返回一个生成器</span></span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">method</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>生成器函数内部是如何执行的？</li>
</ol>
<p>生成器函数内部是为了给生成器的每次迭代提供的数据</p>
<p>每次调用生成器的next方法，将导致生成器函数运行到下一个yield关键字位置</p>
<p>yield是一个关键字，该关键字只能在生成器函数内部使用，表达“产生”一个迭代数据。</p>
<ul>
<li><p>示例一,基本的生成器函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'第一次运行'</span>);</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'第二次运行'</span>);</span><br><span class="line">    <span class="keyword">yield</span> <span class="number">2</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'第三次运行'</span>)</span><br><span class="line">&#125;    </span><br><span class="line"><span class="keyword">const</span> generator = test();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> item <span class="keyword">of</span> generator)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>示例二,数组生成器创建</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> *<span class="title">createIterator</span>(<span class="params">arr</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">const</span> item <span class="keyword">of</span> arr)&#123;</span><br><span class="line">        <span class="keyword">yield</span> item;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> arr1 = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">const</span> iter1 = createIterator(arr1);</span><br></pre></td></tr></table></figure>
</li>
<li><p>示例三,斐波拉且数列生成器创建</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">createFeiboIterator</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> prev1 = <span class="number">1</span>,</span><br><span class="line">        prev2 = <span class="number">1</span>,</span><br><span class="line">        n = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (n &lt;= <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="keyword">yield</span> <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> newValue = prev1 + prev2;</span><br><span class="line">            <span class="keyword">yield</span> newValue;</span><br><span class="line">            prev2 = prev1;</span><br><span class="line">            prev1 = newValue;</span><br><span class="line">        &#125;</span><br><span class="line">        n++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> iterator = createFeiboIterator();</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol start="5">
<li>有哪些需要注意的细节？<br>1). 生成器函数可以有返回值，返回值出现在第一次done为true时的value属性中<br>2). 调用生成器的next方法时，可以传递参数，传递的参数会交给yield表达式的返回值<br>3). 第一次调用next方法时，传参没有任何意义<br>4). 在生成器函数内部，可以调用其他生成器函数，但是要注意加上*号</li>
</ol>
<ol start="6">
<li>生成器的其他API</li>
</ol>
<ul>
<li>return方法：调用该方法，可以提前结束生成器函数，从而提前让整个迭代过程结束</li>
<li>throw方法：调用该方法，可以在生成器中产生一个错误</li>
</ul>
<h2 id="生成器应用-异步任务控制"><a href="#生成器应用-异步任务控制" class="headerlink" title="生成器应用-异步任务控制"></a>生成器应用-异步任务控制</h2><p>在async(es7的东西)没出来之前,通过生成器到达异步的效果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">task</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> resp = <span class="keyword">yield</span> fetch(<span class="string">"http://101.132.72.36:5100/api/local"</span>)</span><br><span class="line">    <span class="keyword">const</span> result = <span class="keyword">yield</span> resp.json();</span><br><span class="line">    <span class="built_in">console</span>.log(result);</span><br><span class="line">&#125;</span><br><span class="line">run(task);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span>(<span class="params">generatorFunc</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> generator = generatorFunc();</span><br><span class="line">    <span class="keyword">let</span> result = generator.next();<span class="comment">//开始迭代</span></span><br><span class="line"></span><br><span class="line">    handlerResult();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">handlerResult</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (result.done) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> (result.value.then) === <span class="string">'function'</span>) &#123;</span><br><span class="line">            result.value.then(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">                result = generator.next(data);</span><br><span class="line">                handlerResult();</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            result = generator.next(result.value);</span><br><span class="line">            handlerResult();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="更多的集合类型"><a href="#更多的集合类型" class="headerlink" title="更多的集合类型"></a>更多的集合类型</h1><h2 id="set集合"><a href="#set集合" class="headerlink" title="set集合"></a>set集合</h2><blockquote>
<p>一直以来，JS只能使用数组和对象来保存多个数据，缺乏像其他语言那样拥有丰富的集合类型。因此，ES6新增了两种集合类型（set 和 map），用于在不同的场景中发挥作用。</p>
</blockquote>
<p><strong>set用于存放不重复的数据</strong></p>
<ol>
<li>如何创建set集合</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Set</span>(); <span class="comment">//创建一个没有任何内容的set集合</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Set</span>(iterable); <span class="comment">//创建一个具有初始内容的set集合，内容来自于可迭代对象每一次迭代的结果</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>如何对set集合进行后续操作</li>
</ol>
<ul>
<li>add(数据): 添加一个数据到set集合末尾，如果数据已存在，则不进行任何操作<ul>
<li>set使用Object.is的方式判断两个数据是否相同，但是，针对+0和-0，set认为是相等</li>
</ul>
</li>
<li>has(数据): 判断set中是否存在对应的数据</li>
<li>delete(数据)：删除匹配的数据，返回是否删除成功</li>
<li>clear()：清空整个set集合</li>
<li>size: 获取set集合中的元素数量，只读属性，无法重新赋值</li>
</ul>
<ol start="3">
<li>如何与数组进行相互转换</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> s = <span class="keyword">new</span> <span class="built_in">Set</span>([x,x,x,x,x]);</span><br><span class="line"><span class="comment">// set本身也是一个可迭代对象，每次迭代的结果就是每一项的值</span></span><br><span class="line"><span class="keyword">const</span> arr = [...s];</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>如何遍历</li>
</ol>
<p>1). 使用for-of循环<br>2). 使用set中的实例方法forEach</p>
<p>注意：set集合中不存在下标，因此forEach中的回调的第二个参数和第一个参数是一致的，均表示set中的每一项</p>
<h2 id="set应用"><a href="#set应用" class="headerlink" title="set应用"></a>set应用</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> arr1 = [<span class="number">33</span>, <span class="number">22</span>, <span class="number">55</span>, <span class="number">33</span>, <span class="number">11</span>, <span class="number">33</span>, <span class="number">5</span>];</span><br><span class="line"><span class="keyword">const</span> arr2 = [<span class="number">22</span>, <span class="number">55</span>, <span class="number">77</span>, <span class="number">88</span>, <span class="number">88</span>, <span class="number">99</span>, <span class="number">99</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'并集'</span>, [...new <span class="built_in">Set</span>([...arr1, ...arr2])]);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'交集'</span>, [...new <span class="built_in">Set</span>(arr1)]).filter(<span class="function"><span class="params">item</span> =&gt;</span> arr2.indexOf(item) &gt;= <span class="number">0</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"差集"</span>, [...new <span class="built_in">Set</span>([...arr1, ...arr2])].filter(<span class="function"><span class="params">item</span> =&gt;</span> cross.indexOf(item) &lt; <span class="number">0</span>))</span><br></pre></td></tr></table></figure>
<h2 id="手写set"><a href="#手写set" class="headerlink" title="手写set"></a>手写set</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySet</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(iterator = []) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> (iterator[<span class="built_in">Symbol</span>.iterator]) !== <span class="string">'function'</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">`你提供的<span class="subst">$&#123;iterator&#125;</span>不是一个可迭代的对象`</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>._datas = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> iterator) &#123;</span><br><span class="line">            <span class="keyword">this</span>.add(item);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">get</span> size() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._datas.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    add(data) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">this</span>.has(data)) &#123;</span><br><span class="line">            <span class="keyword">this</span>._datas.push(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    has(data) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> <span class="keyword">this</span>._datas) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.isEqual(data, item)) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">delete</span>(data) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>._datas.length; i++) &#123;</span><br><span class="line">            <span class="keyword">const</span> element = <span class="keyword">this</span>._datas[i];</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.isEqual(element, data)) &#123;</span><br><span class="line">                <span class="keyword">this</span>._datas.slice(i, <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    clear() &#123;</span><br><span class="line">        <span class="keyword">this</span>._datas.length = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    *[<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> <span class="keyword">this</span>._datas) &#123;</span><br><span class="line">            <span class="keyword">yield</span> item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    forEach(callback) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> <span class="keyword">this</span>._datas) &#123;</span><br><span class="line">            callback(item, item, <span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    isEqual(data1, data2) &#123;</span><br><span class="line">        <span class="keyword">if</span> (data1 == <span class="number">0</span> &amp;&amp; data2 == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Object</span>.is(data1, data2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="map集合"><a href="#map集合" class="headerlink" title="map集合"></a>map集合</h2><p>键值对（key value pair）数据集合的特点：键不可重复<br>map集合专门用于存储多个键值对数据。</p>
<p>在map出现之前，我们使用的是对象的方式来存储键值对，键是属性名，值是属性值。</p>
<p>使用对象存储有以下问题：</p>
<ol>
<li>键名只能是字符串</li>
<li>获取数据的数量不方便</li>
<li><p>键名容易跟原型上的名称冲突</p>
</li>
<li><p>如何创建map</p>
</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="built_in">Map</span>(); <span class="comment">//创建一个空的map</span></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">Map</span>(iterable); <span class="comment">//创建一个具有初始内容的map，初始内容来自于可迭代对象每一次迭代的结果，但是，它要求每一次迭代的结果必须是一个长度为2的数组，数组第一项表示键，数组的第二项表示值</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>如何进行后续操作</li>
</ol>
<ul>
<li>size：只读属性，获取当前map中键的数量</li>
<li>set(键, 值)：设置一个键值对，键和值可以是任何类型<ul>
<li>如果键不存在，则添加一项</li>
<li>如果键已存在，则修改它的值</li>
<li>比较键的方式和set相同</li>
</ul>
</li>
<li>get(键): 根据一个键得到对应的值</li>
<li>has(键)：判断某个键是否存在</li>
<li>delete(键)：删除指定的键</li>
<li>clear(): 清空map</li>
</ul>
<ol start="3">
<li><p>和数组互相转换</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mp = <span class="keyword">new</span> <span class="built_in">Map</span>([[<span class="string">"a"</span>, <span class="number">3</span>], [<span class="string">"b"</span>, <span class="number">4</span>], [<span class="string">"c"</span>, <span class="number">5</span>]]);</span><br><span class="line"><span class="keyword">const</span> result = [...mp];</span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br></pre></td></tr></table></figure>
</li>
<li><p>遍历</p>
</li>
</ol>
<ul>
<li>for-of，每次迭代得到的是一个长度为2的数组</li>
<li>forEach，通过回调函数遍历<ul>
<li>参数1：每一项的值</li>
<li>参数2：每一项的键</li>
<li>参数3：map本身</li>
</ul>
</li>
</ul>
<h2 id="手写map"><a href="#手写map" class="headerlink" title="手写map"></a>手写map</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyMap</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(iterable = []) &#123;</span><br><span class="line">        <span class="comment">//验证是否是可迭代的对象</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> iterable[<span class="built_in">Symbol</span>.iterator] !== <span class="string">"function"</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">`你提供的<span class="subst">$&#123;iterable&#125;</span>不是一个可迭代的对象`</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">this</span>._datas = [];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> iterable) &#123;</span><br><span class="line">            <span class="comment">// item 也得是一个可迭代对象</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> item[<span class="built_in">Symbol</span>.iterator] !== <span class="string">"function"</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">`你提供的<span class="subst">$&#123;item&#125;</span>不是一个可迭代的对象`</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">const</span> iterator = item[<span class="built_in">Symbol</span>.iterator]();</span><br><span class="line">            <span class="keyword">const</span> key = iterator.next().value;</span><br><span class="line">            <span class="keyword">const</span> value = iterator.next().value;</span><br><span class="line">            <span class="keyword">this</span>.set(key, value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">set</span>(key, value) &#123;</span><br><span class="line">        <span class="keyword">const</span> obj = <span class="keyword">this</span>._getObj(key);</span><br><span class="line">        <span class="keyword">if</span> (obj) &#123;</span><br><span class="line">            obj.value = value;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">this</span>._datas.push(&#123;</span><br><span class="line">                key,</span><br><span class="line">                value</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span>(key) &#123;</span><br><span class="line">        <span class="keyword">const</span> item = <span class="keyword">this</span>._getObj(key);</span><br><span class="line">        <span class="keyword">if</span> (item) &#123;</span><br><span class="line">            <span class="keyword">return</span> item.value;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">get</span> size() &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._datas.length;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span>(key) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>._datas.length; i++) &#123;</span><br><span class="line">            <span class="keyword">const</span> element = <span class="keyword">this</span>._datas[i];</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.isEqual(element.key, key)) &#123;</span><br><span class="line">                <span class="keyword">this</span>._datas.splice(i, <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    clear() &#123;</span><br><span class="line">        <span class="keyword">this</span>._datas.length = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    has(key) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>._getObj(key) !== <span class="literal">undefined</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    _getObj(key) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> <span class="keyword">this</span>._datas) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.isEqual(item.key, key)) &#123;</span><br><span class="line">                <span class="keyword">return</span> item;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    isEqual(data1, data2) &#123;</span><br><span class="line">        <span class="keyword">if</span> (data1 === <span class="number">0</span> &amp;&amp; data2 === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Object</span>.is(data1, data2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    *[<span class="built_in">Symbol</span>.iterator]() &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> <span class="keyword">this</span>._datas) &#123;</span><br><span class="line">            <span class="keyword">yield</span> [item, key, item, value];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    forEach(callback) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">const</span> item <span class="keyword">of</span> <span class="keyword">this</span>._datas) &#123;</span><br><span class="line">            callback(item.value, item.key, <span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="WeakSet和WeakMap"><a href="#WeakSet和WeakMap" class="headerlink" title="WeakSet和WeakMap"></a>WeakSet和WeakMap</h2><h3 id="WeakSet"><a href="#WeakSet" class="headerlink" title="WeakSet"></a>WeakSet</h3><p>使用该集合，可以实现和set一样的功能，不同的是：</p>
<ol>
<li><strong>它内部存储的对象地址不会影响垃圾回收</strong></li>
<li>只能添加对象</li>
<li>不能遍历（不是可迭代的对象）、没有size属性、没有forEach方法</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    name: <span class="string">"yj"</span>,</span><br><span class="line">    age: <span class="number">18</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> obj2 = obj;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">set</span> = new WeakSet();</span><br><span class="line"><span class="keyword">set</span>.add(obj);</span><br><span class="line"></span><br><span class="line">obj = null;</span><br><span class="line">obj2 = null;</span><br><span class="line">console.log(<span class="keyword">set</span>)</span><br></pre></td></tr></table></figure>
<h3 id="WeakMap"><a href="#WeakMap" class="headerlink" title="WeakMap"></a>WeakMap</h3><p>类似于map的集合，不同的是：</p>
<ol>
<li><strong>它的键存储的地址不会影响垃圾回收</strong></li>
<li>它的键只能是对象</li>
<li>不能遍历（不是可迭代的对象）、没有size属性、没有forEach方法</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wmap = <span class="keyword">new</span> <span class="built_in">WeakMap</span>();</span><br><span class="line"><span class="keyword">let</span> lis = <span class="built_in">document</span>.querySelectorAll(<span class="string">"li"</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> li <span class="keyword">of</span> lis) &#123;</span><br><span class="line">    wmap.set(li, &#123;</span><br><span class="line">        id: li.innerText,</span><br><span class="line">        name: <span class="string">`姓名<span class="subst">$&#123;li.innerHTML&#125;</span>`</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">lis[<span class="number">0</span>].remove();</span><br><span class="line">lis = <span class="literal">null</span>;</span><br><span class="line"><span class="built_in">console</span>.log(wmap);</span><br></pre></td></tr></table></figure>
<h1 id="代理与反射"><a href="#代理与反射" class="headerlink" title="代理与反射"></a>代理与反射</h1><h2 id="回顾属性描述符"><a href="#回顾属性描述符" class="headerlink" title="回顾属性描述符"></a>回顾属性描述符</h2><p>Property Descriptor 属性描述符  是一个普通对象，用于描述一个属性的相关信息</p>
<p>通过<figure class="highlight plain"><figcaption><span>属性名)```可以得到一个对象的某个属性的属性描述符</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- value：属性值</span><br><span class="line">- configurable：该属性的描述符是否可以修改</span><br><span class="line">- enumerable：该属性是否可以被枚举</span><br><span class="line">- writable：该属性是否可以被重新赋值</span><br><span class="line"></span><br><span class="line">&gt; ```Object.getOwnPropertyDescriptors(对象)```可以得到某个对象的所有属性描述符</span><br><span class="line"></span><br><span class="line">如果需要为某个对象添加属性时 或 修改属性时， 配置其属性描述符，可以使用下面的代码:</span><br><span class="line"></span><br><span class="line">```js</span><br><span class="line">Object.defineProperty(对象, 属性名, 描述符);</span><br><span class="line">Object.defineProperties(对象, 多个属性的描述符)</span><br></pre></td></tr></table></figure></p>
<h3 id="存取器属性"><a href="#存取器属性" class="headerlink" title="存取器属性"></a>存取器属性</h3><p>属性描述符中，如果配置了 get 和 set 中的任何一个，则该属性，不再是一个普通属性，而变成了存取器属性。</p>
<p>get 和 set配置均为函数，如果一个属性是存取器属性，则读取该属性时，会运行get方法，将get方法得到的返回值作为属性值；如果给该属性赋值，则会运行set方法。</p>
<p>存取器属性最大的意义，在于可以控制属性的读取和赋值。</p>
<h2 id="Reflect"><a href="#Reflect" class="headerlink" title="Reflect"></a>Reflect</h2><ol>
<li>Reflect是什么？</li>
</ol>
<p>Reflect是一个内置的JS对象，它提供了一系列方法，可以让开发者通过调用这些方法，访问一些JS底层功能</p>
<p>由于它类似于其他语言的<strong>反射</strong>，因此取名为Reflect</p>
<ol start="2">
<li>它可以做什么？</li>
</ol>
<p>使用Reflect可以实现诸如 属性的赋值与取值、调用普通函数、调用构造函数、判断属性是否存在与对象中  等等功能</p>
<ol start="3">
<li>这些功能不是已经存在了吗？为什么还需要用Reflect实现一次？</li>
</ol>
<p>有一个重要的理念，在ES5就被提出：减少魔法、让代码更加纯粹</p>
<p>这种理念很大程度上是受到函数式编程的影响</p>
<p>ES6进一步贯彻了这种理念，它认为，对属性内存的控制、原型链的修改、函数的调用等等，这些都属于底层实现，属于一种魔法，因此，需要将它们提取出来，形成一个正常的API，并高度聚合到某个对象中，于是，就造就了Reflect对象</p>
<p>因此，你可以看到Reflect对象中有很多的API都可以使用过去的某种语法或其他API实现。</p>
<ol start="4">
<li>它里面到底提供了哪些API呢？</li>
</ol>
<ul>
<li>Reflect.set(target, propertyKey, value): 设置对象target的属性propertyKey的值为value，等同于给对象的属性赋值</li>
<li>Reflect.get(target, propertyKey): 读取对象target的属性propertyKey，等同于读取对象的属性值</li>
<li>Reflect.apply(target, thisArgument, argumentsList)：调用一个指定的函数，并绑定this和参数列表。等同于函数调用</li>
<li>Reflect.deleteProperty(target, propertyKey)：删除一个对象的属性</li>
<li>Reflect.defineProperty(target, propertyKey, attributes)：类似于Object.defineProperty，不同的是如果配置出现问题，返回false而不是报错</li>
<li>Reflect.construct(target, argumentsList)：用构造函数的方式创建一个对象</li>
<li>Reflect.has(target, propertyKey): 判断一个对象是否拥有一个属性</li>
<li>其他API：<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect" target="_blank" rel="noopener">https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Reflect</a></li>
</ul>
<h2 id="Proxy-代理"><a href="#Proxy-代理" class="headerlink" title="Proxy 代理"></a>Proxy 代理</h2><p>代理：提供了修改底层实现的方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    a: <span class="number">1</span>,</span><br><span class="line">    b: <span class="number">2</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> proxy = <span class="keyword">new</span> <span class="built_in">Proxy</span>(obj, &#123;</span><br><span class="line">    <span class="keyword">set</span>(target, propertyKey, value) &#123;</span><br><span class="line">        <span class="comment">// console.log(target, propertyKey, value);</span></span><br><span class="line">        <span class="comment">// target[propertyKey] = value;</span></span><br><span class="line">        <span class="built_in">Reflect</span>.set(target, propertyKey, value);</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="keyword">get</span>(target, propertyKey) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">Reflect</span>.has(target, propertyKey)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Reflect</span>.get(target, propertyKey);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    has(target, propertyKey) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// console.log(proxy);</span></span><br><span class="line"><span class="comment">// proxy.a = 10;</span></span><br><span class="line"><span class="comment">// console.log(proxy.a);</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(proxy.d);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"a"</span> <span class="keyword">in</span> proxy);</span><br></pre></td></tr></table></figure>
<h2 id="应用-观察者模式"><a href="#应用-观察者模式" class="headerlink" title="应用-观察者模式"></a>应用-观察者模式</h2><p>有一个对象，是观察者，它用于观察另外一个对象的属性值变化，当属性值变化后会收到一个通知，可能会做一些事。</p>
<h2 id="应用-偷懒的构造函数"><a href="#应用-偷懒的构造函数" class="headerlink" title="应用-偷懒的构造函数"></a>应用-偷懒的构造函数</h2><h2 id="应用-可验证的函数参数"><a href="#应用-可验证的函数参数" class="headerlink" title="应用-可验证的函数参数"></a>应用-可验证的函数参数</h2><h1 id="增强的数组功能"><a href="#增强的数组功能" class="headerlink" title="增强的数组功能"></a>增强的数组功能</h1><h2 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h2><ul>
<li>Array.of(…args): 使用指定的数组项创建一个新数组</li>
<li>Array.from(arg): 通过给定的类数组 或 可迭代对象 创建一个新的数组。</li>
</ul>
<h2 id="实例方法"><a href="#实例方法" class="headerlink" title="实例方法"></a>实例方法</h2><ul>
<li>find(callback): 用于查找满足条件的第一个元素</li>
<li>findIndex(callback)：用于查找满足条件的第一个元素的下标</li>
<li>fill(data)：用指定的数据填充满数组所有的内容</li>
<li>copyWithin(target, start?, end?): 在数组内部完成复制</li>
<li>includes(data)：判断数组中是否包含某个值，使用Object.is匹配</li>
</ul>
<h2 id="扩展-类型化数组"><a href="#扩展-类型化数组" class="headerlink" title="[扩展]类型化数组"></a>[扩展]类型化数组</h2><h3 id="数字存储的前置知识"><a href="#数字存储的前置知识" class="headerlink" title="数字存储的前置知识"></a>数字存储的前置知识</h3><ol>
<li><p>计算机必须使用固定的位数来存储数字，无论存储的数字是大是小，在内存中占用的空间是固定的。</p>
</li>
<li><p>n位的无符号整数能表示的数字是2^n个，取值范围是：0 ~ 2^n - 1</p>
</li>
<li><p>n位的有符号整数能表示的数字是2^n个，取值范围是：-2^(n-1) ~ 2^(n-1) - 1</p>
</li>
<li><p>浮点数表示法可以用于表示整数和小数，目前分为两种标准：</p>
<ol>
<li>32位浮点数：又称为单精度浮点数，它用1位表示符号，8位表示阶码，23位表示尾数</li>
<li>64位浮点数：又称为双精度浮点数，它用1位表示符号，11位表示阶码，52位表示尾数</li>
</ol>
</li>
<li><p>JS中的所有数字，均使用双精度浮点数保存</p>
</li>
</ol>
<h3 id="类型化数组"><a href="#类型化数组" class="headerlink" title="类型化数组"></a>类型化数组</h3><p>类型化数组：用于优化多个数字的存储</p>
<p>具体分为：</p>
<ul>
<li>Int8Array： 8位有符号整数（-128 ~ 127）</li>
<li>Uint8Array： 8位无符号整数（0 ~ 255）</li>
<li>Int16Array: …</li>
<li>Uint16Array: …</li>
<li>Int32Array: …</li>
<li>Uint32Array: …</li>
<li>Float32Array:</li>
<li>Float64Array</li>
</ul>
<ol>
<li>如何创建数组</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">new</span> 数组构造函数(长度)</span><br><span class="line"></span><br><span class="line">数组构造函数.of(元素...)</span><br><span class="line"></span><br><span class="line">数组构造函数.from(可迭代对象)</span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> 数组构造函数(其他类型化数组)</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>得到长度</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">数组.length   <span class="comment">//得到元素数量</span></span><br><span class="line">数组.byteLength <span class="comment">//得到占用的字节数</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>其他的用法跟普通数组一致，但是：</li>
</ol>
<ul>
<li>不能增加和删除数据，类型化数组的长度固定</li>
<li>一些返回数组的方法，返回的数组是同类型化的新数组</li>
</ul>
<h2 id="ArrayBuffer"><a href="#ArrayBuffer" class="headerlink" title="ArrayBuffer"></a>ArrayBuffer</h2><p>ArrayBuffer：一个对象，用于存储一块固定内存大小的数据。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="built_in">ArrayBuffer</span>(字节数)</span><br></pre></td></tr></table></figure>
<p>可以通过属性<code>byteLength</code>得到字节数，可以通过方法<code>slice</code>得到新的ArrayBuffer</p>
<h3 id="读写ArrayBuffer"><a href="#读写ArrayBuffer" class="headerlink" title="读写ArrayBuffer"></a>读写ArrayBuffer</h3><ol>
<li>使用DataView</li>
</ol>
<p>通常会在需要混用多种存储格式时使用DataView</p>
<ol start="2">
<li>使用类型化数组</li>
</ol>
<p>实际上，每一个类型化数组都对应一个ArrayBuffer，如果没有手动指定ArrayBuffer，类型化数组创建时，会新建一个ArrayBuffer</p>
<h2 id="制作黑白图片"><a href="#制作黑白图片" class="headerlink" title="制作黑白图片"></a>制作黑白图片</h2>  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/JavaScript/">JavaScript</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://yoursite.com/2020/01/05/JavaScript-ES6/" data-title="JavaScript-ES6 | 110laile" data-tsina class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev">
 <a href="/2020/01/07/less-基础知识/" title="less-基础知识">
  <strong>上一篇：</strong><br>
  <span>
  less-基础知识</span>
</a>
</div>


<div class="next">
<a href="/2019/12/10/Node-基础知识/" title="Node-基础知识">
 <strong>下一篇：</strong><br> 
 <span>Node-基础知识
</span>
</a>
</div>

</nav>

	



</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ES6-课程概述"><span class="toc-number">1.</span> <span class="toc-text">ES6 课程概述</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#块级绑定"><span class="toc-number">2.</span> <span class="toc-text">块级绑定</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#申明变量的问题"><span class="toc-number">2.1.</span> <span class="toc-text">申明变量的问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用let申明变量"><span class="toc-number">2.1.1.</span> <span class="toc-text">使用let申明变量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用const申明变量"><span class="toc-number">2.1.2.</span> <span class="toc-text">使用const申明变量</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#字符串和正则表达式"><span class="toc-number">3.</span> <span class="toc-text">字符串和正则表达式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#更好的unicode支持"><span class="toc-number">3.1.</span> <span class="toc-text">更好的unicode支持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#更多的字符串API"><span class="toc-number">3.2.</span> <span class="toc-text">更多的字符串API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#正则中的粘连标记"><span class="toc-number">3.3.</span> <span class="toc-text">正则中的粘连标记</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模板字符串"><span class="toc-number">3.4.</span> <span class="toc-text">模板字符串</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模板字符串标记"><span class="toc-number">3.5.</span> <span class="toc-text">模板字符串标记</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#函数"><span class="toc-number">4.</span> <span class="toc-text">函数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#参数默认值"><span class="toc-number">4.1.</span> <span class="toc-text">参数默认值</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用"><span class="toc-number">4.1.1.</span> <span class="toc-text">使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#对arguments的影响"><span class="toc-number">4.1.2.</span> <span class="toc-text">对arguments的影响</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#留意暂时性死区"><span class="toc-number">4.1.3.</span> <span class="toc-text">留意暂时性死区</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#剩余参数"><span class="toc-number">4.2.</span> <span class="toc-text">剩余参数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#展开运算符"><span class="toc-number">4.3.</span> <span class="toc-text">展开运算符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#对对象展开-ES7"><span class="toc-number">4.3.1.</span> <span class="toc-text">对对象展开 ES7</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#剩余参数和展开运算符练习"><span class="toc-number">4.4.</span> <span class="toc-text">剩余参数和展开运算符练习</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#明确函数的双重用途"><span class="toc-number">4.5.</span> <span class="toc-text">明确函数的双重用途</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#箭头函数"><span class="toc-number">4.6.</span> <span class="toc-text">箭头函数</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#使用语法"><span class="toc-number">4.6.1.</span> <span class="toc-text">使用语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#注意细节"><span class="toc-number">4.6.2.</span> <span class="toc-text">注意细节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#应用场景"><span class="toc-number">4.6.3.</span> <span class="toc-text">应用场景</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#对象"><span class="toc-number">5.</span> <span class="toc-text">对象</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#对象字面量写法"><span class="toc-number">5.1.</span> <span class="toc-text">对象字面量写法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Object新增的API"><span class="toc-number">5.2.</span> <span class="toc-text">Object新增的API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#面向对象简介"><span class="toc-number">5.3.</span> <span class="toc-text">面向对象简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#类"><span class="toc-number">5.4.</span> <span class="toc-text">类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#传统的构造函数的问题"><span class="toc-number">5.4.1.</span> <span class="toc-text">传统的构造函数的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#类的特点"><span class="toc-number">5.4.2.</span> <span class="toc-text">类的特点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#类的其他书写方式"><span class="toc-number">5.5.</span> <span class="toc-text">类的其他书写方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#类的继承"><span class="toc-number">5.6.</span> <span class="toc-text">类的继承</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#解构"><span class="toc-number">6.</span> <span class="toc-text">解构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#对象解构"><span class="toc-number">6.1.</span> <span class="toc-text">对象解构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#在解构中使用默认值"><span class="toc-number">6.1.1.</span> <span class="toc-text">在解构中使用默认值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#非同名属性解构"><span class="toc-number">6.1.2.</span> <span class="toc-text">非同名属性解构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#深层次解构"><span class="toc-number">6.1.3.</span> <span class="toc-text">深层次解构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#剩余项解构"><span class="toc-number">6.1.4.</span> <span class="toc-text">剩余项解构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#数组解构"><span class="toc-number">6.2.</span> <span class="toc-text">数组解构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#参数解构"><span class="toc-number">6.3.</span> <span class="toc-text">参数解构</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#符号"><span class="toc-number">7.</span> <span class="toc-text">符号</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#共享符号"><span class="toc-number">7.1.</span> <span class="toc-text">共享符号</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#知名符号"><span class="toc-number">7.2.</span> <span class="toc-text">知名符号</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#异步处理"><span class="toc-number">8.</span> <span class="toc-text">异步处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#回顾-事件循环"><span class="toc-number">8.1.</span> <span class="toc-text">[回顾]事件循环</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#事件和回调函数的缺陷"><span class="toc-number">8.2.</span> <span class="toc-text">事件和回调函数的缺陷</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#异步处理的通用模型"><span class="toc-number">8.3.</span> <span class="toc-text">异步处理的通用模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Promise的基本使用"><span class="toc-number">8.4.</span> <span class="toc-text">Promise的基本使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Promise的串联"><span class="toc-number">8.5.</span> <span class="toc-text">Promise的串联</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Promise的其他api"><span class="toc-number">8.6.</span> <span class="toc-text">Promise的其他api</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#原型成员-实例成员"><span class="toc-number">8.6.1.</span> <span class="toc-text">原型成员 (实例成员)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#构造函数成员-（静态成员）"><span class="toc-number">8.6.2.</span> <span class="toc-text">构造函数成员 （静态成员）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#手写Promise"><span class="toc-number">8.7.</span> <span class="toc-text">手写Promise</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#async-和-await"><span class="toc-number">9.</span> <span class="toc-text">async 和 await</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#async"><span class="toc-number">9.1.</span> <span class="toc-text">async</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#awaits"><span class="toc-number">9.2.</span> <span class="toc-text">awaits</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例demo"><span class="toc-number">9.3.</span> <span class="toc-text">示例demo</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#FetchApi"><span class="toc-number">10.</span> <span class="toc-text">FetchApi</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Fetch-Api-概述"><span class="toc-number">10.1.</span> <span class="toc-text">Fetch Api 概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#基本使用"><span class="toc-number">10.2.</span> <span class="toc-text">基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#参数"><span class="toc-number">10.2.1.</span> <span class="toc-text">参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#返回值"><span class="toc-number">10.2.2.</span> <span class="toc-text">返回值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Request对象"><span class="toc-number">10.3.</span> <span class="toc-text">Request对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Response对象"><span class="toc-number">10.4.</span> <span class="toc-text">Response对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Headers-对象"><span class="toc-number">10.5.</span> <span class="toc-text">Headers 对象</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#示例文件上传"><span class="toc-number">10.6.</span> <span class="toc-text">示例文件上传</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#迭代器和生成器"><span class="toc-number">11.</span> <span class="toc-text">迭代器和生成器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#迭代器"><span class="toc-number">11.1.</span> <span class="toc-text">迭代器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#JS中的迭代器"><span class="toc-number">11.2.</span> <span class="toc-text">JS中的迭代器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#可迭代协议与for-of循环"><span class="toc-number">11.3.</span> <span class="toc-text">可迭代协议与for-of循环</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#可迭代协议"><span class="toc-number">11.3.1.</span> <span class="toc-text">可迭代协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#展开运算符与可迭代对象"><span class="toc-number">11.3.2.</span> <span class="toc-text">展开运算符与可迭代对象</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#生成器"><span class="toc-number">11.4.</span> <span class="toc-text">生成器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#生成器应用-异步任务控制"><span class="toc-number">11.5.</span> <span class="toc-text">生成器应用-异步任务控制</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#更多的集合类型"><span class="toc-number">12.</span> <span class="toc-text">更多的集合类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#set集合"><span class="toc-number">12.1.</span> <span class="toc-text">set集合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#set应用"><span class="toc-number">12.2.</span> <span class="toc-text">set应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#手写set"><span class="toc-number">12.3.</span> <span class="toc-text">手写set</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#map集合"><span class="toc-number">12.4.</span> <span class="toc-text">map集合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#手写map"><span class="toc-number">12.5.</span> <span class="toc-text">手写map</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WeakSet和WeakMap"><span class="toc-number">12.6.</span> <span class="toc-text">WeakSet和WeakMap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#WeakSet"><span class="toc-number">12.6.1.</span> <span class="toc-text">WeakSet</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WeakMap"><span class="toc-number">12.6.2.</span> <span class="toc-text">WeakMap</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#代理与反射"><span class="toc-number">13.</span> <span class="toc-text">代理与反射</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#回顾属性描述符"><span class="toc-number">13.1.</span> <span class="toc-text">回顾属性描述符</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#存取器属性"><span class="toc-number">13.1.1.</span> <span class="toc-text">存取器属性</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reflect"><span class="toc-number">13.2.</span> <span class="toc-text">Reflect</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Proxy-代理"><span class="toc-number">13.3.</span> <span class="toc-text">Proxy 代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#应用-观察者模式"><span class="toc-number">13.4.</span> <span class="toc-text">应用-观察者模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#应用-偷懒的构造函数"><span class="toc-number">13.5.</span> <span class="toc-text">应用-偷懒的构造函数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#应用-可验证的函数参数"><span class="toc-number">13.6.</span> <span class="toc-text">应用-可验证的函数参数</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#增强的数组功能"><span class="toc-number">14.</span> <span class="toc-text">增强的数组功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#静态方法"><span class="toc-number">14.1.</span> <span class="toc-text">静态方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#实例方法"><span class="toc-number">14.2.</span> <span class="toc-text">实例方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#扩展-类型化数组"><span class="toc-number">14.3.</span> <span class="toc-text">[扩展]类型化数组</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#数字存储的前置知识"><span class="toc-number">14.3.1.</span> <span class="toc-text">数字存储的前置知识</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#类型化数组"><span class="toc-number">14.3.2.</span> <span class="toc-text">类型化数组</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ArrayBuffer"><span class="toc-number">14.4.</span> <span class="toc-text">ArrayBuffer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#读写ArrayBuffer"><span class="toc-number">14.4.1.</span> <span class="toc-text">读写ArrayBuffer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#制作黑白图片"><span class="toc-number">14.5.</span> <span class="toc-text">制作黑白图片</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/NET/" title=".NET">.NET<sup>10</sup></a></li>
		  
		
		  
			<li><a href="/categories/NETCore/" title=".NETCore">.NETCore<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Cmd/" title="Cmd">Cmd<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Css/" title="Css">Css<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Docker/" title="Docker">Docker<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Emmet/" title="Emmet">Emmet<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Git/" title="Git">Git<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/HTML/" title="HTML">HTML<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/JQuery/" title="JQuery">JQuery<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/JavaScript/" title="JavaScript">JavaScript<sup>41</sup></a></li>
		  
		
		  
			<li><a href="/categories/Linux/" title="Linux">Linux<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/MongoDB/" title="MongoDB">MongoDB<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Mysql/" title="Mysql">Mysql<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Python/" title="Python">Python<sup>13</sup></a></li>
		  
		
		  
			<li><a href="/categories/Regex/" title="Regex">Regex<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/VisualStudio2017/" title="VisualStudio2017">VisualStudio2017<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Vmware/" title="Vmware">Vmware<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Wpf/" title="Wpf">Wpf<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/css/" title="css">css<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/前端框架/" title="前端框架">前端框架<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/算法/" title="算法">算法<sup>2</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/JavaScript/" title="JavaScript">JavaScript<sup>40</sup></a></li>
			
		
			
				<li><a href="/tags/Python-django/" title="Python django">Python django<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/Html/" title="Html">Html<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Python/" title="Python">Python<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/NET-Core简易入门/" title=".NET Core简易入门">.NET Core简易入门<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/C/" title="C#">C#<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Docker/" title="Docker">Docker<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Mysql/" title="Mysql">Mysql<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/Git/" title="Git">Git<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/DevExpress/" title="DevExpress">DevExpress<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Css/" title="Css">Css<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/算法/" title="算法">算法<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Vue/" title="Vue">Vue<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/React/" title="React">React<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Html5/" title="Html5">Html5<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/JQuery/" title="JQuery">JQuery<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/模块化/" title="模块化">模块化<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/包管理/" title="包管理">包管理<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/MongoDB/" title="MongoDB">MongoDB<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/NET-FrameWork基础知识/" title=".NET FrameWork基础知识">.NET FrameWork基础知识<sup>1</sup></a></li>
			
		
		</ul>
</div>


</aside>
</div>
    </div>
    <footer><div id="footer">
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,110laile. <br>
			This is my blog,believe it or not.</p>
	</section>
	 
	<div class="social-font">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2020 
		
		<a href="/about" target="_blank" title="110laile">110laile</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>











<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?e6d1f421bbc9962127a50488f9ed37d1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
